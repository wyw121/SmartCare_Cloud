<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¾§è¾¹æ èœå•è°ƒè¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        .debug-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        .debug-section h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 14px;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin: 2px;
        }
        .status.success { background: #d5f4e6; color: #27ae60; }
        .status.error { background: #fdf2f2; color: #e74c3c; }
        .status.warning { background: #fef9e7; color: #f39c12; }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        button:hover {
            background: #2980b9;
        }
        .menu-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border: 1px solid #ddd;
            background: white;
        }
        .menu-item.allowed {
            border-left: 4px solid #27ae60;
            background: #d5f4e6;
        }
        .menu-item.denied {
            border-left: 4px solid #e74c3c;
            background: #fdf2f2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ä¾§è¾¹æ èœå•æ˜¾ç¤ºè°ƒè¯•</h1>
        
        <div class="debug-section">
            <h3>ğŸ“Š é¢„å®šä¹‰èœå•é…ç½®</h3>
            <div id="menuConfig"></div>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ‘¤ å½“å‰ç”¨æˆ·ä¿¡æ¯</h3>
            <div id="userInfo"></div>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ” æƒé™æ£€æŸ¥ç»“æœ</h3>
            <div id="permissionCheck"></div>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ“‹ æœ€ç»ˆèœå•åˆ—è¡¨</h3>
            <div id="finalMenu"></div>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ”§ æ“ä½œå·¥å…·</h3>
            <button onclick="debugMenus()">è°ƒè¯•èœå•æ˜¾ç¤º</button>
            <button onclick="clearStorage()">æ¸…é™¤æœ¬åœ°å­˜å‚¨</button>
            <button onclick="simulateAdminLogin()">æ¨¡æ‹Ÿç®¡ç†å‘˜ç™»å½•</button>
            <button onclick="window.open('http://localhost:3001', '_blank')">æ‰“å¼€å‰ç«¯é¡µé¢</button>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿå‰ç«¯çš„èœå•é…ç½®
        const menuItems = [
            {
                path: '/dashboard',
                name: 'dashboard',
                meta: { title: 'é¦–é¡µä»ªè¡¨æ¿', icon: 'DataBoard' },
                roles: ['admin', 'doctor', 'family']
            },
            {
                path: '/elderly',
                name: 'elderly',
                meta: { title: 'è€äººæ¡£æ¡ˆç®¡ç†', icon: 'User' },
                roles: ['admin', 'doctor', 'family']
            },
            {
                path: '/doctor',
                name: 'doctor',
                meta: { title: 'åŒ»ç”Ÿç®¡ç†', icon: 'Avatar' },
                roles: ['admin', 'doctor']
            },
            {
                path: '/health-warning',
                name: 'health-warning',
                meta: { title: 'å¥åº·é¢„è­¦', icon: 'Warning' },
                roles: ['admin', 'doctor', 'family']
            },
            {
                path: '/equipment',
                name: 'equipment',
                meta: { title: 'è®¾å¤‡ç®¡ç†', icon: 'Monitor' },
                roles: ['admin', 'doctor', 'family']
            },
            {
                path: '/reports',
                name: 'reports',
                meta: { title: 'æŠ¥è¡¨ç»Ÿè®¡', icon: 'DataAnalysis' },
                roles: ['admin', 'doctor', 'family']
            },
            {
                path: '/system',
                name: 'system',
                meta: { title: 'ç³»ç»Ÿç®¡ç†', icon: 'Setting' },
                roles: ['admin']
            }
        ];

        function getCurrentUser() {
            try {
                const userInfo = localStorage.getItem('userInfo');
                if (userInfo) {
                    return JSON.parse(userInfo);
                }
                // æ¨¡æ‹Ÿå¼€å‘ç¯å¢ƒè‡ªåŠ¨ç™»å½•
                return {
                    id: 1,
                    username: 'admin',
                    name: 'ç³»ç»Ÿç®¡ç†å‘˜',
                    role: 'admin',
                    roleText: 'ç³»ç»Ÿç®¡ç†å‘˜',
                    permissions: ['*']
                };
            } catch (error) {
                console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
                return null;
            }
        }

        function filterMenusByRole(menus, userRole) {
            return menus.filter(menu => {
                if (menu.roles && Array.isArray(menu.roles)) {
                    return menu.roles.includes(userRole);
                }
                return true;
            });
        }

        function debugMenus() {
            const currentUser = getCurrentUser();
            
            // æ˜¾ç¤ºèœå•é…ç½®
            document.getElementById('menuConfig').innerHTML = `
                <pre>${JSON.stringify(menuItems, null, 2)}</pre>
            `;
            
            // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
            if (currentUser) {
                document.getElementById('userInfo').innerHTML = `
                    <div class="status success">ç”¨æˆ·å·²ç™»å½•</div>
                    <pre>${JSON.stringify(currentUser, null, 2)}</pre>
                `;
            } else {
                document.getElementById('userInfo').innerHTML = `
                    <div class="status error">ç”¨æˆ·æœªç™»å½•</div>
                `;
                return;
            }
            
            // æ£€æŸ¥æ¯ä¸ªèœå•çš„æƒé™
            let permissionHtml = '';
            menuItems.forEach(menu => {
                const hasAccess = menu.roles ? menu.roles.includes(currentUser.role) : true;
                const statusClass = hasAccess ? 'success' : 'error';
                const statusText = hasAccess ? 'å…è®¸è®¿é—®' : 'æ‹’ç»è®¿é—®';
                
                permissionHtml += `
                    <div class="menu-item ${hasAccess ? 'allowed' : 'denied'}">
                        <strong>${menu.meta.title}</strong> (${menu.path})
                        <span class="status ${statusClass}">${statusText}</span>
                        <br>
                        <small>è¦æ±‚è§’è‰²: ${menu.roles ? menu.roles.join(', ') : 'æ— é™åˆ¶'} | å½“å‰è§’è‰²: ${currentUser.role}</small>
                    </div>
                `;
            });
            document.getElementById('permissionCheck').innerHTML = permissionHtml;
            
            // æ˜¾ç¤ºæœ€ç»ˆèœå•
            const finalMenus = filterMenusByRole(menuItems, currentUser.role);
            document.getElementById('finalMenu').innerHTML = `
                <p><strong>åº”è¯¥æ˜¾ç¤ºçš„èœå•æ•°é‡:</strong> ${finalMenus.length} / ${menuItems.length}</p>
                <div class="status ${finalMenus.some(m => m.name === 'equipment') ? 'success' : 'error'}">
                    è®¾å¤‡ç®¡ç†èœå•: ${finalMenus.some(m => m.name === 'equipment') ? 'åº”è¯¥æ˜¾ç¤º' : 'ä¸åº”è¯¥æ˜¾ç¤º'}
                </div>
                <pre>${JSON.stringify(finalMenus, null, 2)}</pre>
            `;
        }

        function clearStorage() {
            localStorage.clear();
            sessionStorage.clear();
            alert('æœ¬åœ°å­˜å‚¨å·²æ¸…é™¤ï¼Œè¯·åˆ·æ–°é¡µé¢é‡æ–°ç™»å½•');
        }

        function simulateAdminLogin() {
            const adminData = {
                id: 1,
                username: 'admin',
                name: 'ç³»ç»Ÿç®¡ç†å‘˜',
                role: 'admin',
                roleText: 'ç³»ç»Ÿç®¡ç†å‘˜',
                permissions: ['*']
            };
            
            localStorage.setItem('token', `mock_token_admin_${Date.now()}`);
            localStorage.setItem('userInfo', JSON.stringify(adminData));
            
            alert('å·²æ¨¡æ‹Ÿç®¡ç†å‘˜ç™»å½•ï¼Œè¯·åˆ·æ–°å‰ç«¯é¡µé¢æŸ¥çœ‹èœå•');
            debugMenus();
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è°ƒè¯•
        window.onload = function() {
            debugMenus();
        };
    </script>
</body>
</html>
