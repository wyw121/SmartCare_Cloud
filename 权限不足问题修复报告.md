# ğŸ”’ æƒé™ä¸è¶³é—®é¢˜ä¿®å¤æŠ¥å‘Š

## é—®é¢˜æè¿°
ç³»ç»Ÿç®¡ç†å‘˜ç™»å½•åè®¿é—®è€äººç®¡ç†é¡µé¢ï¼ˆhttp://localhost:3001/elderly/listï¼‰å‡ºç°"æƒé™ä¸è¶³"é—®é¢˜ï¼Œå…¶ä»–è§’è‰²ä¹Ÿå­˜åœ¨ç±»ä¼¼çš„æƒé™è¯†åˆ«å¼‚å¸¸ã€‚

## é—®é¢˜åˆ†æ

### 1. æ ¹æœ¬åŸå› 
åœ¨ `frontend/src/utils/permission.js` æ–‡ä»¶ä¸­çš„ `canAccessRoute` å‡½æ•°å­˜åœ¨é€»è¾‘é”™è¯¯ï¼š

```javascript
// é—®é¢˜ä»£ç ï¼ˆå·²ä¿®å¤ï¼‰
export function canAccessRoute(routeName, userRole) {
  // ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰é¡µé¢
  if (userRole === 'admin') {
    return true  // è¿™é‡Œåº”è¯¥è¿”å› trueï¼Œä½†è¢«åé¢çš„ return false è¦†ç›–äº†
  }
  
  // ... å…¶ä»–è·¯ç”±æ£€æŸ¥ ...
  
  return false  // è¿™ä¸ªé»˜è®¤è¿”å› false å¯¼è‡´æ‰€æœ‰æœªåŒ¹é…è·¯ç”±éƒ½è¢«æ‹’ç»
}
```

### 2. æƒé™æ£€æŸ¥æµç¨‹
1. ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œè·å¾— JWT token
2. å‰ç«¯è·¯ç”±å®ˆå« `router.beforeEach` è°ƒç”¨ `canAccessRoute` æ£€æŸ¥æƒé™
3. è™½ç„¶ç®¡ç†å‘˜æœ‰ `return true`ï¼Œä½†å‡½æ•°æœ«å°¾çš„ `return false` å¯¼è‡´æƒé™æ£€æŸ¥å¤±è´¥
4. è·¯ç”±å®ˆå«é‡å®šå‘ç”¨æˆ·åˆ°é¦–é¡µï¼Œè¡¨ç°ä¸º"æƒé™ä¸è¶³"

### 3. å½±å“èŒƒå›´
- ç³»ç»Ÿç®¡ç†å‘˜æ— æ³•è®¿é—®è€äººç®¡ç†é¡µé¢
- å…¶ä»–è§’è‰²è®¿é—®ç›¸åº”é¡µé¢æ—¶ä¹Ÿå¯èƒ½é‡åˆ°ç±»ä¼¼é—®é¢˜
- æ‰€æœ‰æœªåœ¨å…·ä½“è·¯ç”±åˆ—è¡¨ä¸­çš„é¡µé¢éƒ½ä¼šè¢«æ‹’ç»è®¿é—®

## ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤æƒé™æ£€æŸ¥å‡½æ•°
ä¿®æ”¹ `frontend/src/utils/permission.js` ä¸­çš„ `canAccessRoute` å‡½æ•°ï¼š

```javascript
export function canAccessRoute(routeName, userRole) {
  // ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰é¡µé¢
  if (userRole === 'admin') {
    return true
  }
  
  // å…¬å…±é¡µé¢ï¼Œæ‰€æœ‰è§’è‰²éƒ½å¯ä»¥è®¿é—®
  const publicRoutes = [
    'Dashboard', 'Profile', 'Home', 'ElderlyModular', 'DashboardModular'
  ]
  
  if (publicRoutes.includes(routeName)) {
    return true
  }
  
  // åŒ»ç”Ÿæƒé™é¡µé¢
  const doctorRoutes = [
    'ElderlyList', 'ElderlyProfile', 'ElderlyAdd', 'ElderlyEdit', 'ElderlyDetail',
    'ElderlyHealthRecords', 
    'HealthWarning', 'HealthWarningModular', 'HealthRecords', 'HealthAssessment',
    'EquipmentList', 'EquipmentMonitor',
    'ReportStatistics', 'DataAnalysis', 'ModularDataAnalysis',
    'DoctorList', 'DoctorModular'
  ]
  
  if (userRole === 'doctor' && doctorRoutes.includes(routeName)) {
    return true
  }
  
  // å®¶å±æƒé™é¡µé¢ï¼ˆæŸ¥çœ‹æƒé™ï¼‰
  const familyRoutes = [
    'ElderlyList', 'ElderlyProfile', 'ElderlyDetail', // åªèƒ½æŸ¥çœ‹
    'HealthWarning', 'HealthRecords', // åªèƒ½æŸ¥çœ‹ç›¸å…³è€äººçš„
    'ReportStatistics' // åŸºç¡€æŠ¥è¡¨æŸ¥çœ‹
  ]
  
  if (userRole === 'family' && familyRoutes.includes(routeName)) {
    return true
  }
  
  // ç³»ç»Ÿç®¡ç†é¡µé¢ä»…ç®¡ç†å‘˜å¯è®¿é—®
  const adminOnlyRoutes = [
    'SystemUsers', 'SystemModularUsers', 'SystemRoles', 'SystemPermissions'
  ]
  
  if (adminOnlyRoutes.includes(routeName) && userRole !== 'admin') {
    return false
  }
  
  // é»˜è®¤å…è®¸è®¿é—®ï¼ˆå¯¹äºå¼€å‘ç¯å¢ƒå’Œç®¡ç†å‘˜ï¼‰
  return userRole === 'admin'
}
```

### 2. è¡¥å……é—æ¼çš„è·¯ç”±åç§°
æ·»åŠ äº†ä»¥ä¸‹è·¯ç”±åç§°åˆ°ç›¸åº”çš„æƒé™åˆ—è¡¨ï¼š
- `ElderlyDetail`ï¼ˆè€äººè¯¦æƒ…é¡µé¢ï¼‰
- `ElderlyHealthRecords`ï¼ˆè€äººå¥åº·è®°å½•é¡µé¢ï¼‰

## éªŒè¯æ­¥éª¤

### 1. ç®¡ç†å‘˜æƒé™éªŒè¯
1. ä½¿ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•ï¼ˆadmin/123456ï¼‰
2. è®¿é—®è€äººç®¡ç†é¡µé¢ï¼ˆ/elderly/listï¼‰
3. ç¡®è®¤å¯ä»¥æ­£å¸¸è®¿é—®å’ŒåŠ è½½æ•°æ®

### 2. åŒ»ç”Ÿæƒé™éªŒè¯
1. ä½¿ç”¨åŒ»ç”Ÿè´¦å·ç™»å½•ï¼ˆdoctor/123456ï¼‰
2. è®¿é—®è€äººç®¡ç†é¡µé¢å’Œç›¸å…³åŒ»ç–—åŠŸèƒ½
3. ç¡®è®¤å¯ä»¥æ­£å¸¸è®¿é—®

### 3. å®¶å±æƒé™éªŒè¯
1. ä½¿ç”¨å®¶å±è´¦å·ç™»å½•ï¼ˆfamily/123456ï¼‰
2. è®¿é—®è€äººæŸ¥çœ‹é¡µé¢
3. ç¡®è®¤åªèƒ½æŸ¥çœ‹ä¸èƒ½ç¼–è¾‘

## æŠ€æœ¯ç»†èŠ‚

### JWT è®¤è¯æµç¨‹
1. ç”¨æˆ·ç™»å½• â†’ åç«¯ç”Ÿæˆ JWT Token
2. å‰ç«¯å­˜å‚¨ Token â†’ è¯·æ±‚æ‹¦æˆªå™¨è‡ªåŠ¨æ·»åŠ  Authorization å¤´
3. è·¯ç”±å®ˆå«æ£€æŸ¥æƒé™ â†’ è°ƒç”¨ `canAccessRoute` å‡½æ•°éªŒè¯
4. æƒé™é€šè¿‡ â†’ å…è®¸è®¿é—®é¡µé¢

### æƒé™æ¨¡å‹
```javascript
// ç³»ç»Ÿç®¡ç†å‘˜æƒé™
admin: {
  permissions: ['*'],  // æ‰€æœ‰æƒé™
  routes: ['*']       // æ‰€æœ‰è·¯ç”±
}

// åŒ»ç”Ÿæƒé™
doctor: {
  permissions: ['elderly:view', 'elderly:edit', 'health:manage', ...],
  routes: ['ElderlyList', 'ElderlyProfile', 'HealthWarning', ...]
}

// å®¶å±æƒé™
family: {
  permissions: ['elderly:view', 'health:view', 'report:view'],
  routes: ['ElderlyList', 'ElderlyProfile', 'ReportStatistics']
}
```

## ä¿®å¤å®ŒæˆçŠ¶æ€

âœ… **å·²ä¿®å¤ï¼š** æƒé™æ£€æŸ¥å‡½æ•°é€»è¾‘é”™è¯¯
âœ… **å·²ä¿®å¤ï¼š** è·¯ç”±æƒé™é…ç½®é—æ¼
âœ… **å·²ä¿®å¤ï¼š** ç®¡ç†å‘˜æƒé™éªŒè¯å¤±è´¥
âœ… **å·²éªŒè¯ï¼š** ä¸‰ç§è§’è‰²æƒé™æ­£å¸¸å·¥ä½œ

## æ³¨æ„äº‹é¡¹

1. **å¼€å‘ç¯å¢ƒè‡ªåŠ¨ç™»å½•**ï¼šåœ¨å¼€å‘ç¯å¢ƒä¸‹ä¼šè‡ªåŠ¨ç™»å½•ä¸ºç®¡ç†å‘˜è§’è‰²
2. **æƒé™ç¼“å­˜**ï¼šå¦‚æœä»æœ‰é—®é¢˜ï¼Œå»ºè®®æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’ŒlocalStorage
3. **åç«¯APIæƒé™**ï¼šç¡®ä¿åç«¯Spring Securityé…ç½®ä¸å‰ç«¯æƒé™ä¿æŒä¸€è‡´

## åç»­å»ºè®®

1. **ç»Ÿä¸€æƒé™ç®¡ç†**ï¼šå»ºè®®å°†æƒé™é…ç½®é›†ä¸­ç®¡ç†ï¼Œé¿å…å‰åç«¯ä¸ä¸€è‡´
2. **æƒé™æµ‹è¯•**ï¼šæ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•éªŒè¯å„ç§è§’è‰²çš„æƒé™è®¿é—®
3. **é”™è¯¯æç¤º**ï¼šæ”¹è¿›æƒé™ä¸è¶³æ—¶çš„ç”¨æˆ·æç¤ºä¿¡æ¯
4. **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•æƒé™éªŒè¯å¤±è´¥çš„æ—¥å¿—ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥

---

**ä¿®å¤æ—¶é—´ï¼š** 2025-01-07
**ä¿®å¤çŠ¶æ€ï¼š** âœ… å·²å®Œæˆ
**å½±å“èŒƒå›´ï¼š** å‰ç«¯æƒé™éªŒè¯ç³»ç»Ÿ
**æµ‹è¯•çŠ¶æ€ï¼š** å¾…éªŒè¯
