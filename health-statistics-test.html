<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥åº·ç»Ÿè®¡æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
        }
        .test-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        .button {
            background: #409eff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .button:hover {
            background: #66b1ff;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
        }
        .status-success {
            color: #67c23a;
        }
        .status-error {
            color: #f56c6c;
        }
        .loading {
            color: #409eff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥ æ™ºæ…§åŒ»å…»å¹³å° - å¥åº·ç»Ÿè®¡åŠŸèƒ½æµ‹è¯•</h1>
            <p>æµ‹è¯•åç«¯å¥åº·ç»Ÿè®¡APIæ¥å£å’Œå‰ç«¯HealthStatisticsDialogç»„ä»¶</p>
        </div>

        <!-- åç«¯APIæµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ“Š åç«¯APIæ¥å£æµ‹è¯•</h3>
            <button class="button" onclick="testHealthStatistics()">è·å–å®Œæ•´å¥åº·ç»Ÿè®¡</button>
            <button class="button" onclick="testHealthStatusDistribution()">å¥åº·çŠ¶æ€åˆ†å¸ƒ</button>
            <button class="button" onclick="testAgeHealthDistribution()">å¹´é¾„æ®µå¥åº·åˆ†å¸ƒ</button>
            <button class="button" onclick="testHealthRiskAssessment()">å¥åº·é£é™©è¯„ä¼°</button>
            <div id="api-result" class="result"></div>
        </div>

        <!-- å‰ç«¯ç»„ä»¶æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ¨ å‰ç«¯ç»„ä»¶æµ‹è¯•</h3>
            <button class="button" onclick="openElderlyManagement()">æ‰“å¼€è€äººç®¡ç†é¡µé¢</button>
            <button class="button" onclick="testEchartsComponent()">æµ‹è¯•EChartså›¾è¡¨</button>
            <div id="component-result" class="result"></div>
        </div>

        <!-- æ•°æ®åº“è¿æ¥æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ”— æ•°æ®åº“è¿æ¥æµ‹è¯•</h3>
            <button class="button" onclick="testDatabaseConnection()">æµ‹è¯•æ•°æ®åº“è¿æ¥</button>
            <button class="button" onclick="testElderlyData()">è·å–è€äººæ•°æ®</button>
            <div id="db-result" class="result"></div>
        </div>

        <!-- ç³»ç»ŸçŠ¶æ€ -->
        <div class="test-section">
            <h3>âš¡ ç³»ç»ŸçŠ¶æ€</h3>
            <div id="system-status">
                <p>ğŸ”„ ç³»ç»Ÿæ£€æŸ¥ä¸­...</p>
            </div>
        </div>
    </div>

    <script>
        // APIåŸºç¡€URL
        const API_BASE_URL = 'http://localhost:8080';

        // æ˜¾ç¤ºç»“æœçš„è¾…åŠ©å‡½æ•°
        function showResult(elementId, content, isError = false) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <div class="${isError ? 'status-error' : 'status-success'}">
                    <strong>${isError ? 'âŒ é”™è¯¯:' : 'âœ… æˆåŠŸ:'}</strong>
                    <pre style="margin-top: 10px; white-space: pre-wrap;">${content}</pre>
                </div>
            `;
        }

        function showLoading(elementId, message) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="loading">ğŸ”„ ${message}...</div>`;
        }

        // é€šç”¨APIè¯·æ±‚å‡½æ•°
        async function apiRequest(url, method = 'GET', data = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }

                const response = await fetch(url, options);
                const result = await response.json();
                return { success: true, data: result };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // å¥åº·ç»Ÿè®¡APIæµ‹è¯•
        async function testHealthStatistics() {
            showLoading('api-result', 'è·å–å¥åº·ç»Ÿè®¡æ•°æ®');
            const result = await apiRequest(`${API_BASE_URL}/elderly/health-statistics`);
            
            if (result.success) {
                showResult('api-result', JSON.stringify(result.data, null, 2));
            } else {
                showResult('api-result', result.error, true);
            }
        }

        async function testHealthStatusDistribution() {
            showLoading('api-result', 'è·å–å¥åº·çŠ¶æ€åˆ†å¸ƒ');
            const result = await apiRequest(`${API_BASE_URL}/elderly/health-status-distribution`);
            
            if (result.success) {
                showResult('api-result', JSON.stringify(result.data, null, 2));
            } else {
                showResult('api-result', result.error, true);
            }
        }

        async function testAgeHealthDistribution() {
            showLoading('api-result', 'è·å–å¹´é¾„æ®µå¥åº·åˆ†å¸ƒ');
            const result = await apiRequest(`${API_BASE_URL}/elderly/age-health-distribution`);
            
            if (result.success) {
                showResult('api-result', JSON.stringify(result.data, null, 2));
            } else {
                showResult('api-result', result.error, true);
            }
        }

        async function testHealthRiskAssessment() {
            showLoading('api-result', 'è·å–å¥åº·é£é™©è¯„ä¼°');
            const result = await apiRequest(`${API_BASE_URL}/elderly/health-risk-assessment`);
            
            if (result.success) {
                showResult('api-result', JSON.stringify(result.data, null, 2));
            } else {
                showResult('api-result', result.error, true);
            }
        }

        // å‰ç«¯ç»„ä»¶æµ‹è¯•
        function openElderlyManagement() {
            window.open('http://localhost:3000/#/elderly/list', '_blank');
            showResult('component-result', 'å·²åœ¨æ–°çª—å£æ‰“å¼€è€äººç®¡ç†é¡µé¢ï¼Œè¯·æµ‹è¯•å¥åº·ç»Ÿè®¡æŒ‰é’®åŠŸèƒ½');
        }

        function testEchartsComponent() {
            showResult('component-result', 
                'ğŸ“ˆ EChartsç»„ä»¶æµ‹è¯•ä¿¡æ¯:\n' +
                '- é¥¼å›¾: å¥åº·çŠ¶æ€åˆ†å¸ƒ\n' +
                '- æŸ±çŠ¶å›¾: å¹´é¾„æ®µå¥åº·åˆ†å¸ƒ\n' +
                '- é›·è¾¾å›¾: å¥åº·é£é™©è¯„ä¼°\n' +
                '- æŠ˜çº¿å›¾: å¥åº·è¶‹åŠ¿åˆ†æ\n' +
                'è¯·åœ¨è€äººç®¡ç†é¡µé¢ç‚¹å‡»"å¥åº·ç»Ÿè®¡"æŒ‰é’®æŸ¥çœ‹å›¾è¡¨æ•ˆæœ'
            );
        }

        // æ•°æ®åº“è¿æ¥æµ‹è¯•
        async function testDatabaseConnection() {
            showLoading('db-result', 'æµ‹è¯•æ•°æ®åº“è¿æ¥');
            const result = await apiRequest(`${API_BASE_URL}/elderly/test`);
            
            if (result.success) {
                showResult('db-result', JSON.stringify(result.data, null, 2));
            } else {
                showResult('db-result', result.error, true);
            }
        }

        async function testElderlyData() {
            showLoading('db-result', 'è·å–è€äººæ•°æ®');
            const result = await apiRequest(`${API_BASE_URL}/elderly/page?pageNum=1&pageSize=5`);
            
            if (result.success) {
                showResult('db-result', JSON.stringify(result.data, null, 2));
            } else {
                showResult('db-result', result.error, true);
            }
        }

        // ç³»ç»ŸçŠ¶æ€æ£€æŸ¥
        async function checkSystemStatus() {
            const statusElement = document.getElementById('system-status');
            let statusInfo = '';

            // æ£€æŸ¥å‰ç«¯æœåŠ¡
            try {
                const frontendResponse = await fetch('http://localhost:3000');
                statusInfo += frontendResponse.ok ? 
                    'âœ… å‰ç«¯æœåŠ¡ (localhost:3000): æ­£å¸¸è¿è¡Œ\n' : 
                    'âŒ å‰ç«¯æœåŠ¡ (localhost:3000): å“åº”å¼‚å¸¸\n';
            } catch (error) {
                statusInfo += 'âŒ å‰ç«¯æœåŠ¡ (localhost:3000): æ— æ³•è¿æ¥\n';
            }

            // æ£€æŸ¥åç«¯æœåŠ¡
            try {
                const backendResult = await apiRequest(`${API_BASE_URL}/elderly/health`);
                statusInfo += backendResult.success ? 
                    'âœ… åç«¯æœåŠ¡ (localhost:8080): æ­£å¸¸è¿è¡Œ\n' : 
                    'âŒ åç«¯æœåŠ¡ (localhost:8080): å“åº”å¼‚å¸¸\n';
            } catch (error) {
                statusInfo += 'âŒ åç«¯æœåŠ¡ (localhost:8080): æ— æ³•è¿æ¥\n';
            }

            statusInfo += '\nğŸ“‹ æµ‹è¯•ç¯å¢ƒä¿¡æ¯:\n';
            statusInfo += `- æµè§ˆå™¨: ${navigator.userAgent}\n`;
            statusInfo += `- å½“å‰æ—¶é—´: ${new Date().toLocaleString()}\n`;
            statusInfo += '- é¡¹ç›®: æ™ºæ…§åŒ»å…»å¤§æ•°æ®å…¬å…±æœåŠ¡å¹³å°\n';
            statusInfo += '- ç‰ˆæœ¬: 1.0.0 (å¼€å‘ç‰ˆæœ¬)\n';

            statusElement.innerHTML = `<pre style="white-space: pre-wrap;">${statusInfo}</pre>`;
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            checkSystemStatus();
        });
    </script>
</body>
</html>
