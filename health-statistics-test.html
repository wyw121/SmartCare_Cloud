<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>健康统计测试页面</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
        }
        .test-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        .button {
            background: #409eff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .button:hover {
            background: #66b1ff;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
        }
        .status-success {
            color: #67c23a;
        }
        .status-error {
            color: #f56c6c;
        }
        .loading {
            color: #409eff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏥 智慧医养平台 - 健康统计功能测试</h1>
            <p>测试后端健康统计API接口和前端HealthStatisticsDialog组件</p>
        </div>

        <!-- 后端API测试 -->
        <div class="test-section">
            <h3>📊 后端API接口测试</h3>
            <button class="button" onclick="testHealthStatistics()">获取完整健康统计</button>
            <button class="button" onclick="testHealthStatusDistribution()">健康状态分布</button>
            <button class="button" onclick="testAgeHealthDistribution()">年龄段健康分布</button>
            <button class="button" onclick="testHealthRiskAssessment()">健康风险评估</button>
            <div id="api-result" class="result"></div>
        </div>

        <!-- 前端组件测试 -->
        <div class="test-section">
            <h3>🎨 前端组件测试</h3>
            <button class="button" onclick="openElderlyManagement()">打开老人管理页面</button>
            <button class="button" onclick="testEchartsComponent()">测试ECharts图表</button>
            <div id="component-result" class="result"></div>
        </div>

        <!-- 数据库连接测试 -->
        <div class="test-section">
            <h3>🔗 数据库连接测试</h3>
            <button class="button" onclick="testDatabaseConnection()">测试数据库连接</button>
            <button class="button" onclick="testElderlyData()">获取老人数据</button>
            <div id="db-result" class="result"></div>
        </div>

        <!-- 系统状态 -->
        <div class="test-section">
            <h3>⚡ 系统状态</h3>
            <div id="system-status">
                <p>🔄 系统检查中...</p>
            </div>
        </div>
    </div>

    <script>
        // API基础URL
        const API_BASE_URL = 'http://localhost:8080';

        // 显示结果的辅助函数
        function showResult(elementId, content, isError = false) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <div class="${isError ? 'status-error' : 'status-success'}">
                    <strong>${isError ? '❌ 错误:' : '✅ 成功:'}</strong>
                    <pre style="margin-top: 10px; white-space: pre-wrap;">${content}</pre>
                </div>
            `;
        }

        function showLoading(elementId, message) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="loading">🔄 ${message}...</div>`;
        }

        // 通用API请求函数
        async function apiRequest(url, method = 'GET', data = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }

                const response = await fetch(url, options);
                const result = await response.json();
                return { success: true, data: result };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // 健康统计API测试
        async function testHealthStatistics() {
            showLoading('api-result', '获取健康统计数据');
            const result = await apiRequest(`${API_BASE_URL}/elderly/health-statistics`);
            
            if (result.success) {
                showResult('api-result', JSON.stringify(result.data, null, 2));
            } else {
                showResult('api-result', result.error, true);
            }
        }

        async function testHealthStatusDistribution() {
            showLoading('api-result', '获取健康状态分布');
            const result = await apiRequest(`${API_BASE_URL}/elderly/health-status-distribution`);
            
            if (result.success) {
                showResult('api-result', JSON.stringify(result.data, null, 2));
            } else {
                showResult('api-result', result.error, true);
            }
        }

        async function testAgeHealthDistribution() {
            showLoading('api-result', '获取年龄段健康分布');
            const result = await apiRequest(`${API_BASE_URL}/elderly/age-health-distribution`);
            
            if (result.success) {
                showResult('api-result', JSON.stringify(result.data, null, 2));
            } else {
                showResult('api-result', result.error, true);
            }
        }

        async function testHealthRiskAssessment() {
            showLoading('api-result', '获取健康风险评估');
            const result = await apiRequest(`${API_BASE_URL}/elderly/health-risk-assessment`);
            
            if (result.success) {
                showResult('api-result', JSON.stringify(result.data, null, 2));
            } else {
                showResult('api-result', result.error, true);
            }
        }

        // 前端组件测试
        function openElderlyManagement() {
            window.open('http://localhost:3000/#/elderly/list', '_blank');
            showResult('component-result', '已在新窗口打开老人管理页面，请测试健康统计按钮功能');
        }

        function testEchartsComponent() {
            showResult('component-result', 
                '📈 ECharts组件测试信息:\n' +
                '- 饼图: 健康状态分布\n' +
                '- 柱状图: 年龄段健康分布\n' +
                '- 雷达图: 健康风险评估\n' +
                '- 折线图: 健康趋势分析\n' +
                '请在老人管理页面点击"健康统计"按钮查看图表效果'
            );
        }

        // 数据库连接测试
        async function testDatabaseConnection() {
            showLoading('db-result', '测试数据库连接');
            const result = await apiRequest(`${API_BASE_URL}/elderly/test`);
            
            if (result.success) {
                showResult('db-result', JSON.stringify(result.data, null, 2));
            } else {
                showResult('db-result', result.error, true);
            }
        }

        async function testElderlyData() {
            showLoading('db-result', '获取老人数据');
            const result = await apiRequest(`${API_BASE_URL}/elderly/page?pageNum=1&pageSize=5`);
            
            if (result.success) {
                showResult('db-result', JSON.stringify(result.data, null, 2));
            } else {
                showResult('db-result', result.error, true);
            }
        }

        // 系统状态检查
        async function checkSystemStatus() {
            const statusElement = document.getElementById('system-status');
            let statusInfo = '';

            // 检查前端服务
            try {
                const frontendResponse = await fetch('http://localhost:3000');
                statusInfo += frontendResponse.ok ? 
                    '✅ 前端服务 (localhost:3000): 正常运行\n' : 
                    '❌ 前端服务 (localhost:3000): 响应异常\n';
            } catch (error) {
                statusInfo += '❌ 前端服务 (localhost:3000): 无法连接\n';
            }

            // 检查后端服务
            try {
                const backendResult = await apiRequest(`${API_BASE_URL}/elderly/health`);
                statusInfo += backendResult.success ? 
                    '✅ 后端服务 (localhost:8080): 正常运行\n' : 
                    '❌ 后端服务 (localhost:8080): 响应异常\n';
            } catch (error) {
                statusInfo += '❌ 后端服务 (localhost:8080): 无法连接\n';
            }

            statusInfo += '\n📋 测试环境信息:\n';
            statusInfo += `- 浏览器: ${navigator.userAgent}\n`;
            statusInfo += `- 当前时间: ${new Date().toLocaleString()}\n`;
            statusInfo += '- 项目: 智慧医养大数据公共服务平台\n';
            statusInfo += '- 版本: 1.0.0 (开发版本)\n';

            statusElement.innerHTML = `<pre style="white-space: pre-wrap;">${statusInfo}</pre>`;
        }

        // 页面加载完成后检查系统状态
        document.addEventListener('DOMContentLoaded', function() {
            checkSystemStatus();
        });
    </script>
</body>
</html>
