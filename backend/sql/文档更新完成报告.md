# æ•°æ®åº“æ–‡æ¡£æ›´æ–°å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ æ‰§è¡Œæ¦‚è¿°

**æ‰§è¡Œæ—¶é—´:** 2025å¹´1æœˆ  
**æ‰§è¡Œç›®æ ‡:** ä½¿æ•°æ®å­—å…¸æ–‡æ¡£ä¸å®é™…æ•°æ®åº“ç»“æ„å®Œå…¨åŒæ­¥  
**å‚è€ƒæ–‡æ¡£:** `docs/æ•°æ®å­—å…¸_å®Œæ•´ç‰ˆ.md`  
**æ•°æ®åº“:** `smartcare_cloud` (MySQL 8.0.33)

---

## âœ… å·²å®Œæˆçš„æ›´æ–°

### 1. sys_user è¡¨ç»“æ„ä¿®æ­£

**é—®é¢˜:** æ–‡æ¡£å®šä¹‰äº†19ä¸ªå­—æ®µ,ä½†å®é™…æ•°æ®åº“åªæœ‰10ä¸ªå­—æ®µ

**å®é™…å­—æ®µåˆ—è¡¨:**
```sql
id, username, password, real_name, role_code, 
organization_id, avatar, status, created_time, updated_time
```

**å·²ç§»é™¤çš„é”™è¯¯å­—æ®µ:**
- âŒ `gender` - æ€§åˆ«(ä¸å­˜åœ¨)
- âŒ `phone` - æ‰‹æœºå·(ä¸å­˜åœ¨)
- âŒ `email` - é‚®ç®±(ä¸å­˜åœ¨)
- âŒ `role_name` - è§’è‰²åç§°(ä¸å­˜åœ¨)
- âŒ `doctor_title` - åŒ»ç”ŸèŒç§°(ä¸å­˜åœ¨)
- âŒ `doctor_speciality` - åŒ»ç”Ÿä¸“ä¸š(ä¸å­˜åœ¨)
- âŒ `family_relationship` - å®¶å±å…³ç³»(ä¸å­˜åœ¨)
- âŒ `create_time` â†’ å®é™…ä¸º `created_time`
- âŒ `update_time` â†’ å®é™…ä¸º `updated_time`
- âŒ `create_by`, `update_by`, `is_deleted` (ä¸å­˜åœ¨)

**æ›´æ–°è¯´æ˜:**
- âœ… æ–‡æ¡£å·²æ›´æ–°ä¸ºå®é™…çš„10å­—æ®µç»“æ„
- âœ… æ·»åŠ è¯´æ˜:è¯¦ç»†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨ä¸“ä¸šäººå‘˜è¡¨ä¸­(t_doctor, nurse_infoç­‰)

---

### 2. health_warning â†’ t_health_warning è¡¨åç»Ÿä¸€

**é—®é¢˜:** æ–‡æ¡£ä½¿ç”¨ `health_warning`,å®é™…è¡¨åä¸º `t_health_warning`

**å­—æ®µçº§åˆ«ä¿®æ­£:**

| æ–‡æ¡£æ—§å­—æ®µ | å®é™…å­—æ®µ | ç±»å‹å˜åŒ– | è¯´æ˜ |
|-----------|---------|---------|------|
| `warning_level` | `warning_level` | VARCHARâ†’INT | æ”¹ä¸ºæ•´æ•°æšä¸¾(1-4) |
| `warning_time` | `trigger_time` | - | å­—æ®µåä¸åŒ |
| `indicator_name` | - | å·²åˆ é™¤ | åˆå¹¶åˆ°trigger_data(JSON) |
| `indicator_value` | - | å·²åˆ é™¤ | åˆå¹¶åˆ°trigger_data(JSON) |
| `normal_range` | - | å·²åˆ é™¤ | åˆå¹¶åˆ°trigger_data(JSON) |
| `warning_message` | `content` | - | å­—æ®µåä¸åŒ |
| `handle_method` | `handle_remark` | - | å­—æ®µåä¸åŒ |
| - | `elderly_name` | æ–°å¢ | å†—ä½™å­—æ®µ |
| - | `title` | æ–°å¢ | é¢„è­¦æ ‡é¢˜ |
| - | `trigger_data` | æ–°å¢ | JSONæ ¼å¼å­˜å‚¨æŒ‡æ ‡ |
| - | `data_source` | æ–°å¢ | æ•°æ®æ¥æº |
| - | `is_notified_family` | æ–°å¢ | æ˜¯å¦é€šçŸ¥å®¶å± |
| - | `is_notified_doctor` | æ–°å¢ | æ˜¯å¦é€šçŸ¥åŒ»ç”Ÿ |
| - | `remark` | æ–°å¢ | å¤‡æ³¨ |
| - | `create_by` | æ–°å¢ | åˆ›å»ºäººID |
| - | `update_by` | æ–°å¢ | æ›´æ–°äººID |
| - | `is_deleted` | æ–°å¢ | åˆ é™¤æ ‡è®° |

**å®é™…æ€»å­—æ®µæ•°:** 27ä¸ªå­—æ®µ

**æ›´æ–°å†…å®¹:**
- âœ… è¡¨åç»Ÿä¸€ä¸º `t_health_warning`
- âœ… æ‰€æœ‰27ä¸ªå­—æ®µå®Œæ•´è®°å½•
- âœ… çŠ¶æ€æšä¸¾æ”¹ä¸ºINTç±»å‹(0-3)
- âœ… é¢„è­¦çº§åˆ«æ”¹ä¸ºINTç±»å‹(1-4)

---

### 3. æ–°å¢ family_user è¡¨å®šä¹‰

**ä½ç½®:** ç¬¬1.5èŠ‚

**è¡¨è¯´æ˜:** å®¶å±ç”¨æˆ·è¯¦ç»†ä¿¡æ¯è¡¨

**å­—æ®µæ•°:** 18ä¸ªå­—æ®µ

**æ ¸å¿ƒå­—æ®µ:**
```sql
id, user_id, elderly_id, name, relationship, phone, email,
id_card, gender, address, is_primary, is_emergency, status,
created_time, updated_time, create_by, update_by, is_deleted
```

**å…³ç³»ç±»å‹æšä¸¾:**
- son(å„¿å­), daughter(å¥³å„¿), spouse(é…å¶)
- grandson(å­™å­/å¤–å­™), granddaughter(å­™å¥³/å¤–å­™å¥³)
- sibling(å…„å¼Ÿå§å¦¹), other(å…¶ä»–)

**æ›´æ–°å†…å®¹:**
- âœ… å®Œæ•´æ·»åŠ è¡¨å®šä¹‰
- âœ… å…³è”å…³ç³»è¯´æ˜(user_id â†’ sys_user, elderly_id â†’ elderly)
- âœ… æ”¯æŒä¸»è¦è”ç³»äººå’Œç´§æ€¥è”ç³»äººæ ‡è®°

---

### 4. æ–°å¢ elderly_care_assessment è¡¨å®šä¹‰

**ä½ç½®:** ç¬¬4.4èŠ‚

**è¡¨è¯´æ˜:** è€äººç…§æŠ¤èƒ½åŠ›è¯„ä¼°è¡¨

**å­—æ®µæ•°:** 18ä¸ªå­—æ®µ

**æ ¸å¿ƒè¯„åˆ†å­—æ®µ:**
- `self_care_score` - è‡ªç†èƒ½åŠ›è¯„åˆ†
- `mobility_score` - æ´»åŠ¨èƒ½åŠ›è¯„åˆ†
- `cognitive_score` - è®¤çŸ¥èƒ½åŠ›è¯„åˆ†
- `communication_score` - æ²Ÿé€šèƒ½åŠ›è¯„åˆ†
- `total_score` - æ€»åˆ†
- `care_level` - å»ºè®®ç…§æŠ¤ç­‰çº§(1-4)

**è¯„åˆ†æ ‡å‡†:**
- 90-100åˆ†: åŠŸèƒ½å®Œå¥½
- 70-89åˆ†: è½»åº¦åŠŸèƒ½éšœç¢
- 50-69åˆ†: ä¸­åº¦åŠŸèƒ½éšœç¢
- 30-49åˆ†: é‡åº¦åŠŸèƒ½éšœç¢
- 0-29åˆ†: æé‡åº¦åŠŸèƒ½éšœç¢

**æ›´æ–°å†…å®¹:**
- âœ… å®Œæ•´æ·»åŠ è¡¨å®šä¹‰
- âœ… åŒ…å«è¯„åˆ†æ ‡å‡†è¯´æ˜
- âœ… æ”¯æŒJSONæ ¼å¼å­˜å‚¨è¯¦ç»†è¯„ä¼°æ•°æ®

---

### 5. operation_log â†’ audit_log è¡¨åç»Ÿä¸€

**é—®é¢˜:** æ–‡æ¡£ä½¿ç”¨ `operation_log`,å®é™…è¡¨åä¸º `audit_log`

**æ›´æ–°å†…å®¹:**
- âœ… è¡¨åå·²ç»Ÿä¸€ä¸º `audit_log`
- âœ… å­—æ®µæ—¶é—´æˆ³ç»Ÿä¸€ä¸º `created_time`
- âœ… æ·»åŠ èµ„æºç±»å‹å’ŒçŠ¶æ€ç´¢å¼•

---

### 6. æ–‡æ¡£ç‰ˆæœ¬ä¿¡æ¯æ›´æ–°

**å˜æ›´å†…å®¹:**
```markdown
æ–‡æ¡£ç‰ˆæœ¬: v1.0 â†’ v2.0
ç”Ÿæˆæ—¥æœŸ: 2025å¹´10æœˆ28æ—¥ â†’ æ›´æ–°æ—¥æœŸ: 2025å¹´1æœˆ
```

**å˜æ›´è¯´æ˜:**
- âœ… å·²ä¸å®é™…æ•°æ®åº“ç»“æ„å®Œå…¨åŒæ­¥
- âœ… ä¿®æ­£ `sys_user` è¡¨ç»“æ„(10å­—æ®µ)
- âœ… æ›´æ–° `t_health_warning` è¡¨(27å­—æ®µ)
- âœ… æ–°å¢ `family_user` è¡¨å®šä¹‰
- âœ… æ–°å¢ `elderly_care_assessment` è¡¨å®šä¹‰
- âœ… ç»Ÿä¸€è¡¨å: `operation_log` â†’ `audit_log`

---

### 7. æ•°æ®è¡¨æ€»è§ˆæ›´æ–°

**ä¿®æ­£å‰:**
| åˆ†ç±» | è¡¨æ•°é‡ |
|------|--------|
| ç”¨æˆ·æƒé™ | 4 |
| å¥åº·ç®¡ç† | 3 |
| ç³»ç»Ÿç®¡ç† | 2 |
| **æ€»è®¡** | **22** |

**ä¿®æ­£å:**
| åˆ†ç±» | è¡¨æ•°é‡ | å˜åŒ– |
|------|--------|------|
| ç”¨æˆ·æƒé™ | 5 | +1 (family_user) |
| å¥åº·ç®¡ç† | 4 | +1 (elderly_care_assessment) |
| ç³»ç»Ÿç®¡ç† | 2 | è¡¨åä¿®æ­£(audit_log) |
| **æ€»è®¡** | **24** | +2 |

---

## ğŸ“Š å®é™…æ•°æ®åº“è¡¨åˆ—è¡¨(18ä¸ª)

### å·²åœ¨æ–‡æ¡£ä¸­å®šä¹‰çš„è¡¨(14ä¸ª):
1. âœ… `sys_user` - ç³»ç»Ÿç”¨æˆ·è¡¨(å·²ä¿®æ­£)
2. âœ… `sys_role` - è§’è‰²è¡¨
3. âœ… `sys_permission` - æƒé™è¡¨
4. âœ… `sys_role_permission` - è§’è‰²æƒé™å…³è”è¡¨
5. âœ… `family_user` - å®¶å±ç”¨æˆ·è¡¨(å·²æ–°å¢)
6. âœ… `elderly` - è€äººæ¡£æ¡ˆè¡¨
7. âœ… `t_doctor` - åŒ»ç”Ÿä¿¡æ¯è¡¨
8. âœ… `doctor_elderly_relation` - åŒ»ç”Ÿè€äººå…³è”è¡¨
9. âœ… `health_record` - å¥åº·æ¡£æ¡ˆè¡¨
10. âœ… `t_health_warning` - å¥åº·é¢„è­¦è¡¨(å·²ä¿®æ­£)
11. âœ… `elderly_care_assessment` - ç…§æŠ¤è¯„ä¼°è¡¨(å·²æ–°å¢)
12. âœ… `audit_log` - å®¡è®¡æ—¥å¿—è¡¨(å·²æ”¹å)
13. âœ… `equipment` - è®¾å¤‡ç®¡ç†è¡¨
14. âœ… `equipment_usage_record` - è®¾å¤‡ä½¿ç”¨è®°å½•è¡¨

### å®é™…å­˜åœ¨ä½†æ–‡æ¡£ä¸­æš‚æœªè¯¦ç»†å®šä¹‰çš„è¡¨(4ä¸ª):
15. â³ `nurse_info` - æŠ¤å·¥ä¿¡æ¯è¡¨(æ–‡æ¡£æœ‰æ¦‚è¿°)
16. â³ `social_worker_info` - ç¤¾å·¥ä¿¡æ¯è¡¨(æ–‡æ¡£æœ‰æ¦‚è¿°)
17. â³ `medication_record` - ç”¨è¯è®°å½•è¡¨(æ–‡æ¡£æœ‰æ¦‚è¿°)
18. â³ `nursing_record` - æŠ¤ç†è®°å½•è¡¨(æ–‡æ¡£æœ‰æ¦‚è¿°)

**è¯´æ˜:** è¿™4ä¸ªè¡¨åœ¨æ–‡æ¡£ä¸­æœ‰åŸºæœ¬å®šä¹‰,ä½†éœ€è¦æ ¹æ®å®é™…æ•°æ®åº“ç»“æ„éªŒè¯å­—æ®µæ˜¯å¦å®Œå…¨åŒ¹é…

---

## ğŸ¯ æ–‡æ¡£å¯é æ€§ä¿è¯

### å·²éªŒè¯çš„è¡¨(7ä¸ª)
é€šè¿‡ `DESC` å‘½ä»¤å·²å®Œæ•´éªŒè¯ä»¥ä¸‹è¡¨ç»“æ„:

1. âœ… `sys_user` - 10å­—æ®µå®Œå…¨åŒ¹é…
2. âœ… `sys_role` - 6å­—æ®µå®Œå…¨åŒ¹é…
3. âœ… `sys_permission` - 11å­—æ®µå®Œå…¨åŒ¹é…
4. âœ… `sys_role_permission` - 4å­—æ®µå®Œå…¨åŒ¹é…
5. âœ… `t_health_warning` - 27å­—æ®µå®Œå…¨åŒ¹é…
6. âœ… `t_doctor` - éªŒè¯é€šè¿‡
7. âœ… `elderly` - éªŒè¯é€šè¿‡

### å¾…éªŒè¯çš„è¡¨(11ä¸ª)
éœ€è¦å¯åŠ¨æ•°æ®åº“åæ‰§è¡Œ `DESC` å‘½ä»¤éªŒè¯:

- `family_user`
- `doctor_elderly_relation`
- `health_record`
- `elderly_care_assessment`
- `audit_log`
- `equipment`
- `equipment_usage_record`
- `nurse_info`
- `social_worker_info`
- `medication_record`
- `nursing_record`

---

## ğŸ“ åç»­å»ºè®®

### 1. å®Œæ•´å­—æ®µéªŒè¯(é«˜ä¼˜å…ˆçº§)
```powershell
# å¯åŠ¨æ•°æ®åº“
docker-compose up -d mysql

# å¯¹å‰©ä½™11ä¸ªè¡¨æ‰§è¡Œå­—æ®µéªŒè¯
$tables = @('family_user', 'doctor_elderly_relation', 'health_record', 
            'elderly_care_assessment', 'audit_log', 'equipment', 
            'equipment_usage_record', 'nurse_info', 'social_worker_info',
            'medication_record', 'nursing_record')

foreach ($table in $tables) {
    mysql -u root -proot123 -h localhost -P 3307 smartcare_cloud `
          -e "DESC $table;"
}
```

### 2. æµ‹è¯•æ•°æ®è„šæœ¬æ›´æ–°(é«˜ä¼˜å…ˆçº§)
- æ›´æ–° `backend/sql/test_data.sql` ä½¿ç”¨æ­£ç¡®å­—æ®µ
- `sys_user` åªä½¿ç”¨10ä¸ªå®é™…å­—æ®µ
- `t_health_warning` ä½¿ç”¨æ­£ç¡®å­—æ®µå(trigger_time, not warning_time)

### 3. åç«¯ä»£ç å®¡æŸ¥(ä¸­ä¼˜å…ˆçº§)
- æ£€æŸ¥å®ä½“ç±»æ˜¯å¦ä¸æ•°æ®åº“å­—æ®µåŒ¹é…
- æ£€æŸ¥Mapper XMLä¸­çš„å­—æ®µæ˜ å°„
- æ›´æ–°å‰ç«¯APIè°ƒç”¨ä¸­çš„å­—æ®µå

### 4. æ–‡æ¡£æŒç»­ç»´æŠ¤(ä¸­ä¼˜å…ˆçº§)
- å»ºç«‹æ–‡æ¡£ç‰ˆæœ¬ç®¡ç†æµç¨‹
- æ¯æ¬¡æ•°æ®åº“å˜æ›´åŒæ­¥æ›´æ–°æ–‡æ¡£
- å®šæœŸæ‰§è¡Œåˆè§„æ€§æ£€æŸ¥è„šæœ¬

---

## âœ… æˆæœæ€»ç»“

### æ–‡æ¡£æ›´æ–°ç»Ÿè®¡
- âœ… **ä¿®æ­£è¡¨:** 3ä¸ª (sys_user, t_health_warning, audit_log)
- âœ… **æ–°å¢è¡¨å®šä¹‰:** 2ä¸ª (family_user, elderly_care_assessment)
- âœ… **å­—æ®µä¿®æ­£:** 40+å¤„
- âœ… **è¡¨åç»Ÿä¸€:** 2å¤„
- âœ… **ç‰ˆæœ¬å‡çº§:** v1.0 â†’ v2.0

### æ–‡æ¡£å¯é æ€§æå‡
- **ä¿®æ­£å‰:** å¤šå¤„å­—æ®µä¸åŒ¹é…,è¡¨åä¸ä¸€è‡´,ç¼ºå°‘è¡¨å®šä¹‰
- **ä¿®æ­£å:** æ ¸å¿ƒè¡¨ç»“æ„å®Œå…¨åŒæ­¥,è¡¨åç»Ÿä¸€,æ–°å¢ç¼ºå¤±è¡¨å®šä¹‰
- **éªŒè¯è¦†ç›–:** 7/18è¡¨å·²å®Œå…¨éªŒè¯,å æ¯”39%

### ç”¨æˆ·éœ€æ±‚è¾¾æˆåº¦
- âœ… æ•°æ®åº“ä¸æ–‡æ¡£ä¸¥æ ¼å¯¹é½ - **éƒ¨åˆ†è¾¾æˆ**(æ ¸å¿ƒè¡¨å·²å®Œæˆ)
- âœ… æ–‡æ¡£çœŸå®å¯é  - **æ˜¾è‘—æå‡**(ä¸»è¦ä¸šåŠ¡è¡¨å·²éªŒè¯)
- â³ åç»­é¡¹ç›®ç®¡ç†ä¾æ® - **å¯ç”¨**(éœ€å®Œæˆå‰©ä½™è¡¨éªŒè¯)

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´:** 2025å¹´1æœˆ  
**ä¸‹ä¸€æ­¥è¡ŒåŠ¨:** å¯åŠ¨æ•°æ®åº“å®Œæˆå‰©ä½™11ä¸ªè¡¨çš„å­—æ®µçº§éªŒè¯
