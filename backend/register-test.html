<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>注册API测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-form {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .response {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>智慧医养平台 - 注册API测试</h1>
    
    <div class="test-form">
        <h3>用户注册测试</h3>
        <div class="form-group">
            <label>用户名:</label>
            <input type="text" id="username" value="testuser123" placeholder="3-50个字符，只能包含字母、数字和下划线">
        </div>
        <div class="form-group">
            <label>密码:</label>
            <input type="password" id="password" value="123456" placeholder="6-20个字符">
        </div>
        <div class="form-group">
            <label>确认密码:</label>
            <input type="password" id="confirmPassword" value="123456" placeholder="需与密码一致">
        </div>
        <div class="form-group">
            <label>真实姓名:</label>
            <input type="text" id="realName" value="测试用户" placeholder="真实姓名">
        </div>
        <div class="form-group">
            <label>性别:</label>
            <select id="gender">
                <option value="1">男</option>
                <option value="0">女</option>
            </select>
        </div>
        <div class="form-group">
            <label>手机号:</label>
            <input type="text" id="phone" value="13800138000" placeholder="11位手机号">
        </div>
        <div class="form-group">
            <label>邮箱:</label>
            <input type="email" id="email" value="test@example.com" placeholder="邮箱地址（可选）">
        </div>
        <div class="form-group">
            <label>角色:</label>
            <select id="roleCode">
                <option value="family">家属</option>
                <option value="doctor">医生</option>
                <option value="admin">管理员</option>
            </select>
        </div>
        <div class="form-group">
            <label>家属关系（仅家属角色）:</label>
            <input type="text" id="familyRelationship" value="子女" placeholder="与老人的关系">
        </div>
        <div class="form-group">
            <label>医生职称（仅医生角色）:</label>
            <input type="text" id="doctorTitle" value="" placeholder="如：主治医师">
        </div>
        <div class="form-group">
            <label>专业特长（仅医生角色）:</label>
            <input type="text" id="doctorSpeciality" value="" placeholder="专业特长">
        </div>
        <button onclick="testRegister()">测试注册</button>
        <button onclick="clearResponse()">清空结果</button>
    </div>

    <div class="test-form">
        <h3>其他API测试</h3>
        <button onclick="testCheckUsername()">检查用户名可用性</button>
        <button onclick="testCheckPhone()">检查手机号可用性</button>
        <button onclick="testCheckEmail()">检查邮箱可用性</button>
    </div>

    <div id="response" class="response" style="display: none;"></div>

    <script>
        const API_BASE = 'http://localhost:8080/api/auth';

        function showResponse(data, isSuccess = true) {
            const responseDiv = document.getElementById('response');
            responseDiv.style.display = 'block';
            responseDiv.className = 'response ' + (isSuccess ? 'success' : 'error');
            responseDiv.textContent = JSON.stringify(data, null, 2);
        }

        function clearResponse() {
            document.getElementById('response').style.display = 'none';
        }

        async function testRegister() {
            const data = {
                username: document.getElementById('username').value,
                password: document.getElementById('password').value,
                confirmPassword: document.getElementById('confirmPassword').value,
                realName: document.getElementById('realName').value,
                gender: parseInt(document.getElementById('gender').value),
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                roleCode: document.getElementById('roleCode').value
            };

            // 根据角色添加专属字段
            if (data.roleCode === 'family') {
                const familyRelationship = document.getElementById('familyRelationship').value;
                if (familyRelationship) {
                    data.familyRelationship = familyRelationship;
                }
            } else if (data.roleCode === 'doctor') {
                const doctorTitle = document.getElementById('doctorTitle').value;
                const doctorSpeciality = document.getElementById('doctorSpeciality').value;
                if (doctorTitle) data.doctorTitle = doctorTitle;
                if (doctorSpeciality) data.doctorSpeciality = doctorSpeciality;
            }

            try {
                const response = await fetch(`${API_BASE}/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                showResponse(result, response.ok);
            } catch (error) {
                showResponse({ error: error.message }, false);
            }
        }

        async function testCheckUsername() {
            const username = document.getElementById('username').value;
            if (!username) {
                alert('请先输入用户名');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/check-username?username=${username}`);
                const result = await response.json();
                showResponse(result, response.ok);
            } catch (error) {
                showResponse({ error: error.message }, false);
            }
        }

        async function testCheckPhone() {
            const phone = document.getElementById('phone').value;
            if (!phone) {
                alert('请先输入手机号');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/check-phone?phone=${phone}`);
                const result = await response.json();
                showResponse(result, response.ok);
            } catch (error) {
                showResponse({ error: error.message }, false);
            }
        }

        async function testCheckEmail() {
            const email = document.getElementById('email').value;
            if (!email) {
                alert('请先输入邮箱');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/check-email?email=${email}`);
                const result = await response.json();
                showResponse(result, response.ok);
            } catch (error) {
                showResponse({ error: error.message }, false);
            }
        }

        // 角色改变时显示/隐藏对应字段
        document.getElementById('roleCode').addEventListener('change', function() {
            const role = this.value;
            const familyFields = document.getElementById('familyRelationship').parentElement;
            const doctorTitle = document.getElementById('doctorTitle').parentElement;
            const doctorSpeciality = document.getElementById('doctorSpeciality').parentElement;
            
            // 重置所有字段显示
            familyFields.style.display = role === 'family' ? 'block' : 'none';
            doctorTitle.style.display = role === 'doctor' ? 'block' : 'none';
            doctorSpeciality.style.display = role === 'doctor' ? 'block' : 'none';
        });

        // 初始化显示
        document.getElementById('roleCode').dispatchEvent(new Event('change'));
    </script>
</body>
</html>
