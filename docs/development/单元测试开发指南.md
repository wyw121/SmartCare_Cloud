# å•å…ƒæµ‹è¯•å¼€å‘æŒ‡å—

## ğŸ“‹ æµ‹è¯•æ¡†æ¶

### åç«¯æµ‹è¯• (Java)
- **JUnit 5** - æµ‹è¯•æ¡†æ¶
- **Mockito** - Mockæ¡†æ¶
- **Spring Boot Test** - Springé›†æˆæµ‹è¯•
- **H2** - å†…å­˜æ•°æ®åº“(å¯é€‰)

### å‰ç«¯æµ‹è¯• (Vue)
- **Vitest** - æµ‹è¯•è¿è¡Œå™¨
- **Vue Test Utils** - Vueç»„ä»¶æµ‹è¯•å·¥å…·
- **@testing-library/vue** - DOMæµ‹è¯•å·¥å…·(å¯é€‰)

---

## ğŸ§ª åç«¯Serviceå±‚å•å…ƒæµ‹è¯•

### æµ‹è¯•æ¨¡æ¿

```java
package com.smartcare.cloud.service;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.*;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;

/**
 * XXXService å•å…ƒæµ‹è¯•
 */
@ExtendWith(MockitoExtension.class)
public class XXXServiceTest {

    @Mock
    private XXXMapper xxxMapper;  // Mockä¾èµ–çš„Mapper

    @InjectMocks
    private XXXServiceImpl xxxService;  // è¢«æµ‹è¯•çš„Serviceå®ç°ç±»

    private XXX testData;  // æµ‹è¯•æ•°æ®

    @BeforeEach
    void setUp() {
        // åˆå§‹åŒ–æµ‹è¯•æ•°æ®
        testData = new XXX();
        testData.setId(1L);
        // ... è®¾ç½®å…¶ä»–å­—æ®µ
    }

    @Test
    void testGetById_Success() {
        // Given - å‡†å¤‡æµ‹è¯•æ•°æ®
        Long id = 1L;
        when(xxxMapper.selectById(id)).thenReturn(testData);

        // When - æ‰§è¡Œæµ‹è¯•æ–¹æ³•
        XXX result = xxxService.getById(id);

        // Then - éªŒè¯ç»“æœ
        assertNotNull(result);
        assertEquals(testData.getId(), result.getId());
        verify(xxxMapper, times(1)).selectById(id);
    }

    @Test
    void testGetById_NotFound() {
        // Given
        Long id = 999L;
        when(xxxMapper.selectById(id)).thenReturn(null);

        // When
        XXX result = xxxService.getById(id);

        // Then
        assertNull(result);
        verify(xxxMapper, times(1)).selectById(id);
    }

    @Test
    void testSave_Success() {
        // Given
        when(xxxMapper.insert(any(XXX.class))).thenReturn(1);

        // When
        boolean result = xxxService.save(testData);

        // Then
        assertTrue(result);
        verify(xxxMapper, times(1)).insert(testData);
    }

    @Test
    void testUpdate_Success() {
        // Given
        when(xxxMapper.updateById(any(XXX.class))).thenReturn(1);

        // When
        boolean result = xxxService.updateById(testData);

        // Then
        assertTrue(result);
        verify(xxxMapper, times(1)).updateById(testData);
    }

    @Test
    void testDelete_Success() {
        // Given
        Long id = 1L;
        when(xxxMapper.deleteById(id)).thenReturn(1);

        // When
        boolean result = xxxService.removeById(id);

        // Then
        assertTrue(result);
        verify(xxxMapper, times(1)).deleteById(id);
    }
}
```

---

## ğŸ“ ElderlyServiceæµ‹è¯•ç¤ºä¾‹

### åˆ›å»ºæµ‹è¯•æ–‡ä»¶
`backend/src/test/java/com/smartcare/cloud/service/ElderlyServiceTest.java`

```java
package com.smartcare.cloud.service;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.ArgumentMatchers.*;
import static org.mockito.Mockito.*;

import java.util.Arrays;
import java.util.List;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;

import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import com.smartcare.cloud.dto.ElderlyPageDTO;
import com.smartcare.cloud.entity.Elderly;
import com.smartcare.cloud.mapper.ElderlyMapper;
import com.smartcare.cloud.service.impl.ElderlyServiceImpl;

/**
 * è€äººæœåŠ¡å•å…ƒæµ‹è¯•
 */
@ExtendWith(MockitoExtension.class)
@DisplayName("è€äººæœåŠ¡å•å…ƒæµ‹è¯•")
public class ElderlyServiceTest {

    @Mock
    private ElderlyMapper elderlyMapper;

    @InjectMocks
    private ElderlyServiceImpl elderlyService;

    private Elderly testElderly;

    @BeforeEach
    void setUp() {
        testElderly = new Elderly();
        testElderly.setId(1L);
        testElderly.setName("å¼ ä¸‰");
        testElderly.setGender(1);
        testElderly.setAge(75);
        testElderly.setIdCard("110101195001011234");
        testElderly.setPhone("13800138000");
        testElderly.setHealthStatus("HEALTHY");
    }

    @Test
    @DisplayName("æ ¹æ®IDæŸ¥è¯¢è€äºº - æˆåŠŸ")
    void testGetById_Success() {
        // Given
        when(elderlyMapper.selectById(1L)).thenReturn(testElderly);

        // When
        Elderly result = elderlyService.getById(1L);

        // Then
        assertNotNull(result);
        assertEquals("å¼ ä¸‰", result.getName());
        assertEquals(75, result.getAge());
        verify(elderlyMapper, times(1)).selectById(1L);
    }

    @Test
    @DisplayName("æ ¹æ®IDæŸ¥è¯¢è€äºº - ä¸å­˜åœ¨")
    void testGetById_NotFound() {
        // Given
        when(elderlyMapper.selectById(999L)).thenReturn(null);

        // When
        Elderly result = elderlyService.getById(999L);

        // Then
        assertNull(result);
        verify(elderlyMapper, times(1)).selectById(999L);
    }

    @Test
    @DisplayName("ä¿å­˜è€äººä¿¡æ¯ - æˆåŠŸ")
    void testSave_Success() {
        // Given
        when(elderlyMapper.insert(any(Elderly.class))).thenReturn(1);

        // When
        boolean result = elderlyService.save(testElderly);

        // Then
        assertTrue(result);
        verify(elderlyMapper, times(1)).insert(testElderly);
    }

    @Test
    @DisplayName("æ›´æ–°è€äººä¿¡æ¯ - æˆåŠŸ")
    void testUpdate_Success() {
        // Given
        when(elderlyMapper.updateById(any(Elderly.class))).thenReturn(1);

        // When
        boolean result = elderlyService.updateById(testElderly);

        // Then
        assertTrue(result);
        verify(elderlyMapper, times(1)).updateById(testElderly);
    }

    @Test
    @DisplayName("åˆ é™¤è€äººä¿¡æ¯ - æˆåŠŸ")
    void testDelete_Success() {
        // Given
        when(elderlyMapper.deleteById(1L)).thenReturn(1);

        // When
        boolean result = elderlyService.removeById(1L);

        // Then
        assertTrue(result);
        verify(elderlyMapper, times(1)).deleteById(1L);
    }

    @Test
    @DisplayName("æ‰¹é‡åˆ é™¤è€äºº - æˆåŠŸ")
    void testBatchDelete_Success() {
        // Given
        List<Long> ids = Arrays.asList(1L, 2L, 3L);
        when(elderlyMapper.deleteBatchIds(ids)).thenReturn(3);

        // When
        boolean result = elderlyService.removeByIds(ids);

        // Then
        assertTrue(result);
        verify(elderlyMapper, times(1)).deleteBatchIds(ids);
    }
}
```

---

## ğŸ¨ å‰ç«¯ç»„ä»¶æµ‹è¯•

### Vitesté…ç½®
`frontend/vitest.config.js`

```javascript
import { defineConfig } from 'vitest/config'
import vue from '@vitejs/plugin-vue'
import path from 'path'

export default defineConfig({
  plugins: [vue()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./tests/setup.js']
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src')
    }
  }
})
```

### æµ‹è¯•è®¾ç½®æ–‡ä»¶
`frontend/tests/setup.js`

```javascript
import { config } from '@vue/test-utils'
import ElementPlus from 'element-plus'

// å…¨å±€é…ç½®Vue Test Utils
config.global.plugins = [ElementPlus]
```

### ç»„ä»¶æµ‹è¯•ç¤ºä¾‹
`frontend/tests/components/ElderlyList.spec.js`

```javascript
import { describe, it, expect, beforeEach, vi } from 'vitest'
import { mount } from '@vue/test-utils'
import ElderlyList from '@/views/elderly/list.vue'
import ElementPlus from 'element-plus'

describe('ElderlyList.vue', () => {
  let wrapper

  beforeEach(() => {
    // Mock APIè°ƒç”¨
    vi.mock('@/api/elderly', () => ({
      getElderlyPage: vi.fn(() => Promise.resolve({
        code: 200,
        data: {
          records: [
            { id: 1, name: 'å¼ ä¸‰', age: 75, gender: 1 },
            { id: 2, name: 'æå››', age: 80, gender: 0 }
          ],
          total: 2
        }
      }))
    }))

    wrapper = mount(ElderlyList, {
      global: {
        plugins: [ElementPlus]
      }
    })
  })

  it('åº”è¯¥æ­£ç¡®æ¸²æŸ“ç»„ä»¶', () => {
    expect(wrapper.exists()).toBe(true)
    expect(wrapper.find('.elderly-management').exists()).toBe(true)
  })

  it('åº”è¯¥æ˜¾ç¤ºé¡µé¢æ ‡é¢˜', () => {
    expect(wrapper.find('h2').text()).toBe('è€äººæ¡£æ¡ˆç®¡ç†')
  })

  it('åº”è¯¥åŒ…å«æœç´¢è¡¨å•', () => {
    expect(wrapper.find('.search-form').exists()).toBe(true)
    expect(wrapper.find('el-input').exists()).toBe(true)
  })

  it('åº”è¯¥åŒ…å«æ“ä½œæŒ‰é’®', () => {
    const buttons = wrapper.findAll('el-button')
    expect(buttons.length).toBeGreaterThan(0)
  })

  it('åº”è¯¥æ­£ç¡®å¤„ç†æœç´¢', async () => {
    const nameInput = wrapper.find('input[placeholder="è¾“å…¥å§“åè‡ªåŠ¨æœç´¢"]')
    await nameInput.setValue('å¼ ä¸‰')
    
    // ç­‰å¾…é˜²æŠ–
    await new Promise(resolve => setTimeout(resolve, 600))
    
    // éªŒè¯APIè¢«è°ƒç”¨
    // expect(getElderlyPage).toHaveBeenCalled()
  })

  it('åº”è¯¥æ­£ç¡®æ˜¾ç¤ºåˆ—è¡¨æ•°æ®', async () => {
    await wrapper.vm.$nextTick()
    
    const table = wrapper.find('el-table')
    expect(table.exists()).toBe(true)
  })
})
```

### å·¥å…·å‡½æ•°æµ‹è¯•ç¤ºä¾‹
`frontend/tests/utils/request-optimize.spec.js`

```javascript
import { describe, it, expect, beforeEach, vi } from 'vitest'
import { debounce, throttle, createCancelableRequest } from '@/utils/request-optimize'

describe('request-optimize.js', () => {
  describe('debounce', () => {
    it('åº”è¯¥å»¶è¿Ÿæ‰§è¡Œå‡½æ•°', async () => {
      const fn = vi.fn()
      const debouncedFn = debounce(fn, 300)

      debouncedFn()
      expect(fn).not.toHaveBeenCalled()

      await new Promise(resolve => setTimeout(resolve, 400))
      expect(fn).toHaveBeenCalledTimes(1)
    })

    it('åº”è¯¥åªæ‰§è¡Œæœ€åä¸€æ¬¡è°ƒç”¨', async () => {
      const fn = vi.fn()
      const debouncedFn = debounce(fn, 300)

      debouncedFn('call1')
      debouncedFn('call2')
      debouncedFn('call3')

      await new Promise(resolve => setTimeout(resolve, 400))
      expect(fn).toHaveBeenCalledTimes(1)
      expect(fn).toHaveBeenCalledWith('call3')
    })
  })

  describe('throttle', () => {
    it('åº”è¯¥é™åˆ¶å‡½æ•°æ‰§è¡Œé¢‘ç‡', async () => {
      const fn = vi.fn()
      const throttledFn = throttle(fn, 1000)

      throttledFn()
      throttledFn()
      throttledFn()

      expect(fn).toHaveBeenCalledTimes(1)

      await new Promise(resolve => setTimeout(resolve, 1100))
      throttledFn()
      expect(fn).toHaveBeenCalledTimes(2)
    })
  })

  describe('createCancelableRequest', () => {
    it('åº”è¯¥åˆ›å»ºå¯å–æ¶ˆçš„è¯·æ±‚', () => {
      const { request, cancel } = createCancelableRequest()

      expect(typeof request).toBe('function')
      expect(typeof cancel).toBe('function')
    })

    it('åº”è¯¥èƒ½å¤Ÿå–æ¶ˆpendingè¯·æ±‚', async () => {
      const { request, cancel } = createCancelableRequest()
      const mockApi = vi.fn(() => new Promise(resolve => setTimeout(resolve, 1000)))

      const requestPromise = request(mockApi)
      cancel('æµ‹è¯•å–æ¶ˆ')

      await expect(requestPromise).rejects.toThrow()
    })
  })
})
```

---

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

### åç«¯æµ‹è¯•è¦†ç›–ç‡
- **Serviceå±‚**: â‰¥ 80%
- **Controllerå±‚**: â‰¥ 60% (åŸºç¡€æµ‹è¯•)
- **Utilå·¥å…·ç±»**: â‰¥ 90%

### å‰ç«¯æµ‹è¯•è¦†ç›–ç‡
- **å·¥å…·å‡½æ•°**: â‰¥ 90%
- **æ ¸å¿ƒç»„ä»¶**: â‰¥ 70%
- **é¡µé¢ç»„ä»¶**: â‰¥ 50%

---

## ğŸš€ è¿è¡Œæµ‹è¯•

### åç«¯æµ‹è¯•
```bash
cd backend

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test

# è¿è¡ŒæŒ‡å®šæµ‹è¯•ç±»
mvn test -Dtest=ElderlyServiceTest

# ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
mvn test jacoco:report
```

### å‰ç«¯æµ‹è¯•
```bash
cd frontend

# å®‰è£…æµ‹è¯•ä¾èµ–
npm install -D vitest @vue/test-utils jsdom

# è¿è¡Œæµ‹è¯•
npm run test

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# ç›‘å¬æ¨¡å¼
npm run test:watch
```

---

## ğŸ“‹ å¾…è¡¥å……çš„æµ‹è¯•ç”¨ä¾‹

### é«˜ä¼˜å…ˆçº§
- [x] ElderlyServiceTest (å·²æœ‰ç¤ºä¾‹)
- [ ] HealthWarningServiceTest
- [ ] DoctorServiceTest
- [ ] UserAuthServiceTest

### ä¸­ä¼˜å…ˆçº§
- [ ] FamilyServiceTest
- [ ] EquipmentServiceTest
- [ ] AuditLogServiceTest

### ä½ä¼˜å…ˆçº§
- [ ] FileStorageServiceTest
- [ ] MessagePushServiceTest

---

## ğŸ’¡ æµ‹è¯•æœ€ä½³å®è·µ

### 1. éµå¾ªAAAæ¨¡å¼
- **Arrange (å‡†å¤‡)**: è®¾ç½®æµ‹è¯•æ•°æ®å’ŒMock
- **Act (æ‰§è¡Œ)**: è°ƒç”¨è¢«æµ‹æ–¹æ³•
- **Assert (æ–­è¨€)**: éªŒè¯ç»“æœ

### 2. æµ‹è¯•å‘½åè§„èŒƒ
```java
void test<MethodName>_<Scenario>() {
    // æ–¹æ³•å_æµ‹è¯•åœºæ™¯
    // ä¾‹: testGetById_Success()
}
```

### 3. ä½¿ç”¨@DisplayName
```java
@DisplayName("æ ¹æ®IDæŸ¥è¯¢è€äºº - æˆåŠŸ")
void testGetById_Success() { }
```

### 4. éš”ç¦»æµ‹è¯•
- æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹è¿è¡Œ
- ä¸ä¾èµ–å…¶ä»–æµ‹è¯•çš„ç»“æœ
- ä½¿ç”¨@BeforeEachåˆå§‹åŒ–æ•°æ®

### 5. Mockå¤–éƒ¨ä¾èµ–
- æ•°æ®åº“è®¿é—®ä½¿ç”¨Mock
- å¤–éƒ¨APIè°ƒç”¨ä½¿ç”¨Mock
- æ—¶é—´ç›¸å…³ä½¿ç”¨å›ºå®šå€¼

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [JUnit 5 å®˜æ–¹æ–‡æ¡£](https://junit.org/junit5/docs/current/user-guide/)
- [Mockito å®˜æ–¹æ–‡æ¡£](https://javadoc.io/doc/org.mockito/mockito-core/latest/org/mockito/Mockito.html)
- [Vitest å®˜æ–¹æ–‡æ¡£](https://vitest.dev/)
- [Vue Test Utils å®˜æ–¹æ–‡æ¡£](https://test-utils.vuejs.org/)

---

**åˆ›å»ºæ—¶é—´**: 2025å¹´10æœˆ28æ—¥  
**ä½œè€…**: GitHub Copilot  
**çŠ¶æ€**: æŒ‡å—å®Œæˆï¼Œå¾…è¡¥å……æµ‹è¯•ç”¨ä¾‹
