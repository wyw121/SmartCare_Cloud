# é˜¶æ®µ4: æµ‹è¯•å’Œä¸Šçº¿å·¥ä½œè®¡åˆ’

**é¡¹ç›®**: æ™ºæ…§åŒ»å…»å¹³å°æƒé™ç³»ç»Ÿ  
**é˜¶æ®µ**: é˜¶æ®µ4 - æµ‹è¯•å’Œä¸Šçº¿  
**é¢„è®¡æ—¶é—´**: 2å‘¨ (ç¬¬9-10å‘¨)  
**å¼€å§‹æ—¥æœŸ**: 2025-11-01  
**ç›®æ ‡**: å…¨é¢æµ‹è¯•æƒé™ç³»ç»Ÿ,ä¼˜åŒ–æ€§èƒ½,å®Œæˆç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

---

## ğŸ“… ç¬¬9å‘¨: åŠŸèƒ½æµ‹è¯• (2025-11-01 ~ 2025-11-07)

### 1ï¸âƒ£ è§’è‰²æƒé™æµ‹è¯• (2å¤©)

**æµ‹è¯•ç›®æ ‡**: éªŒè¯6ç§è§’è‰²çš„è·¯ç”±è®¿é—®ã€èœå•æ˜¾ç¤ºã€æŒ‰é’®æƒé™æ§åˆ¶

**æµ‹è¯•è§’è‰²**:
- `system_admin` - ç³»ç»Ÿç®¡ç†å‘˜
- `business_admin` - ä¸šåŠ¡ç®¡ç†å‘˜
- `doctor` - åŒ»ç”Ÿ
- `nurse` - æŠ¤å·¥
- `social_worker` - ç¤¾å·¥
- `family` - å®¶å±

**æµ‹è¯•ç”¨ä¾‹æ¸…å•**:

#### 1.1 è·¯ç”±è®¿é—®æƒé™æµ‹è¯•
```
æµ‹è¯•æ­¥éª¤:
1. ä½¿ç”¨ä¸åŒè§’è‰²è´¦å·ç™»å½•ç³»ç»Ÿ
2. å°è¯•è®¿é—®å„ä¸ªè·¯ç”±URL
3. è®°å½•å®é™…è®¿é—®ç»“æœ

é¢„æœŸç»“æœ:
- âœ… æœ‰æƒé™çš„è·¯ç”±æ­£å¸¸æ˜¾ç¤º
- âœ… æ— æƒé™çš„è·¯ç”±è‡ªåŠ¨è·³è½¬åˆ°403é¡µé¢æˆ–é¦–é¡µ
- âœ… è·¯ç”±å®ˆå«æ‹¦æˆªç”Ÿæ•ˆ

æµ‹è¯•çŸ©é˜µ:
| è·¯ç”±                    | system_admin | business_admin | doctor | nurse | social_worker | family |
|------------------------|--------------|----------------|--------|-------|---------------|--------|
| /dashboard             | âœ…           | âœ…             | âœ…     | âœ…    | âœ…            | âœ…     |
| /system/users          | âœ…           | âŒ             | âŒ     | âŒ    | âŒ            | âŒ     |
| /elderly/list          | âŒ           | âœ…             | âœ…     | âŒ    | âŒ            | âŒ     |
| /elderly/family-view   | âŒ           | âŒ             | âŒ     | âŒ    | âŒ            | âœ…     |
| /doctor/list           | âŒ           | âœ…             | âŒ     | âŒ    | âŒ            | âŒ     |
| /doctor/workbench      | âŒ           | âŒ             | âœ…     | âŒ    | âŒ            | âŒ     |
| /nurse/workbench       | âŒ           | âŒ             | âŒ     | âœ…    | âŒ            | âŒ     |
```

#### 1.2 èœå•æ˜¾ç¤ºæµ‹è¯•
```
æµ‹è¯•æ­¥éª¤:
1. ä½¿ç”¨ä¸åŒè§’è‰²ç™»å½•
2. æ£€æŸ¥ä¾§è¾¹æ èœå•é¡¹
3. å¯¹æ¯”role-config.jsä¸­çš„é…ç½®

é¢„æœŸç»“æœ:
- âœ… åªæ˜¾ç¤ºæœ‰æƒé™çš„èœå•
- âœ… æ— æƒé™èœå•å®Œå…¨éšè—
- âœ… èœå•å±‚çº§ç»“æ„æ­£ç¡®

åŒ»ç”Ÿè§’è‰²åº”çœ‹åˆ°çš„èœå•:
- é¦–é¡µä»ªè¡¨æ¿
- åŒ»ç”Ÿå·¥ä½œå°
- è€äººç®¡ç† > æˆ‘è´Ÿè´£çš„è€äºº
- å¥åº·ç®¡ç† > å¥åº·é¢„è­¦/å¥åº·è®°å½•/è¯„ä¼°æŠ¥å‘Š
- åŒ»ç–—è®°å½• > ç”¨è¯è®°å½•/å·¡è¯Šè®°å½•
- ä¸ªäººç»Ÿè®¡
- ä¸ªäººä¸­å¿ƒ
```

#### 1.3 æŒ‰é’®çº§æƒé™æµ‹è¯•
```
æµ‹è¯•é¡µé¢: /elderly/list (è€äººåˆ—è¡¨é¡µ)

æµ‹è¯•æ­¥éª¤:
1. åŒ»ç”Ÿè§’è‰²ç™»å½•
2. è¿›å…¥è€äººåˆ—è¡¨é¡µ
3. æ£€æŸ¥æ“ä½œæŒ‰é’®å¯è§æ€§

é¢„æœŸç»“æœ:
åŒ»ç”Ÿè§’è‰²åº”è¯¥:
- âœ… çœ‹åˆ° "æŸ¥çœ‹" æŒ‰é’®
- âœ… çœ‹åˆ° "å¥åº·" æŒ‰é’®
- âœ… çœ‹åˆ° "è¯„ä¼°" æŒ‰é’®
- âŒ çœ‹ä¸åˆ° "ç¼–è¾‘" æŒ‰é’®
- âŒ çœ‹ä¸åˆ° "åˆ é™¤" æŒ‰é’®
- âŒ çœ‹ä¸åˆ° "æ–°å¢è€äººæ¡£æ¡ˆ" æŒ‰é’®
- âŒ çœ‹ä¸åˆ° "æ‰¹é‡åˆ é™¤" æŒ‰é’®

ä¸šåŠ¡ç®¡ç†å‘˜åº”è¯¥:
- âœ… çœ‹åˆ°æ‰€æœ‰æŒ‰é’®
```

**æµ‹è¯•å·¥å…·**:
- æ‰‹åŠ¨æµ‹è¯• (Chrome DevTools)
- æˆªå›¾è®°å½•
- æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿: `docs/testing/role-permission-test-report.md`

**äº¤ä»˜ç‰©**:
- [ ] è§’è‰²æƒé™æµ‹è¯•æŠ¥å‘Š
- [ ] æƒé™é—®é¢˜åˆ—è¡¨ (å¦‚æœ‰)
- [ ] ä¿®å¤éªŒè¯è®°å½•

---

### 2ï¸âƒ£ æ•°æ®éš”ç¦»æµ‹è¯• (2å¤©)

**æµ‹è¯•ç›®æ ‡**: éªŒè¯@DataPermissionæ³¨è§£çš„SQLè¿‡æ»¤æ•ˆæœ,ç¡®ä¿è§’è‰²åªèƒ½çœ‹åˆ°è‡ªå·±æƒé™èŒƒå›´å†…çš„æ•°æ®

**æ ¸å¿ƒæµ‹è¯•åœºæ™¯**:

#### 2.1 åŒ»ç”Ÿæ•°æ®éš”ç¦»æµ‹è¯•
```
æµ‹è¯•API: GET /api/elderly/my-patients

æµ‹è¯•æ­¥éª¤:
1. åœ¨æ•°æ®åº“ä¸­å‡†å¤‡æµ‹è¯•æ•°æ®:
   - è€äººA (id=1): ç”±åŒ»ç”Ÿå¼ ä¸‰(doctor_id=1)è´Ÿè´£
   - è€äººB (id=2): ç”±åŒ»ç”Ÿæå››(doctor_id=2)è´Ÿè´£
   - è€äººC (id=3): æ— åŒ»ç”Ÿè´Ÿè´£

2. ä½¿ç”¨åŒ»ç”Ÿå¼ ä¸‰(id=1)çš„tokenè°ƒç”¨API

3. æ£€æŸ¥è¿”å›ç»“æœå’Œæ•°æ®åº“SQLæ—¥å¿—

é¢„æœŸç»“æœ:
- âœ… åªè¿”å›è€äººAçš„æ•°æ®
- âœ… SQLä¸­åŒ…å«doctor_elderly_relationå…³è”æŸ¥è¯¢
- âœ… WHEREæ¡ä»¶åŒ…å« doctor_id = 1
- âŒ ä¸è¿”å›è€äººBå’Œè€äººC

SQLç¤ºä¾‹:
SELECT * FROM elderly_info e
WHERE EXISTS (
  SELECT 1 FROM doctor_elderly_relation der
  WHERE der.doctor_id = 1 
  AND der.elderly_id = e.id
)
```

#### 2.2 æŠ¤å·¥æ•°æ®éš”ç¦»æµ‹è¯•
```
æµ‹è¯•API: GET /api/elderly/my-patients (æŠ¤å·¥è§’è‰²)

æµ‹è¯•æ­¥éª¤:
1. å‡†å¤‡æµ‹è¯•æ•°æ®:
   - è€äººA: ç”±æŠ¤å·¥ç‹äº”(nurse_id=1)è´Ÿè´£
   - è€äººB: ç”±æŠ¤å·¥èµµå…­(nurse_id=2)è´Ÿè´£

2. ä½¿ç”¨æŠ¤å·¥ç‹äº”çš„tokenè°ƒç”¨API

3. éªŒè¯SQLè¿‡æ»¤æ¡ä»¶

é¢„æœŸç»“æœ:
- âœ… åªè¿”å›è€äººA
- âœ… SQLå…³è”nurse_elderly_relationè¡¨
- âœ… WHEREæ¡ä»¶: nurse_id = 1
```

#### 2.3 å®¶å±æ•°æ®éš”ç¦»æµ‹è¯•
```
æµ‹è¯•åœºæ™¯: å®¶å±æŸ¥çœ‹è€äººåˆ—è¡¨

æµ‹è¯•æ­¥éª¤:
1. å‡†å¤‡æ•°æ®:
   - å®¶å±å¼ ä¸‰(family_id=1): å…³è”è€äººAã€è€äººB
   - å®¶å±æå››(family_id=2): å…³è”è€äººC

2. å®¶å±å¼ ä¸‰ç™»å½•,è®¿é—® /elderly/family-view

3. æ£€æŸ¥APIè¿”å›æ•°æ®

é¢„æœŸç»“æœ:
- âœ… åªè¿”å›è€äººAå’Œè€äººB
- âœ… SQLå…³è”family_elderly_relationè¡¨
- âŒ ä¸è¿”å›è€äººC
```

#### 2.4 è¶Šæƒè®¿é—®æµ‹è¯•
```
æµ‹è¯•åœºæ™¯: å°è¯•è¶Šæƒè®¿é—®ä»–äººæ•°æ®

æµ‹è¯•æ­¥éª¤:
1. åŒ»ç”Ÿå¼ ä¸‰(id=1)å°è¯•è®¿é—®: /api/elderly/detail?id=2 (è€äººB,ç”±åŒ»ç”Ÿæå››è´Ÿè´£)

2. è®°å½•å“åº”ç»“æœ

é¢„æœŸç»“æœ:
- âœ… è¿”å›403 Forbiddené”™è¯¯
- âœ… å‰ç«¯è·³è½¬åˆ°403é”™è¯¯é¡µé¢
- âœ… åå°è®°å½•è¶Šæƒè®¿é—®æ—¥å¿—
```

**æµ‹è¯•å·¥å…·**:
- Postman / Insomnia (APIæµ‹è¯•)
- MySQL Workbench (SQLæ—¥å¿—æŸ¥çœ‹)
- Chrome DevTools (Networké¢æ¿)

**äº¤ä»˜ç‰©**:
- [ ] æ•°æ®éš”ç¦»æµ‹è¯•æŠ¥å‘Š
- [ ] SQLæ‰§è¡Œæ—¥å¿—æˆªå›¾
- [ ] è¶Šæƒè®¿é—®æµ‹è¯•è®°å½•

---

### 3ï¸âƒ£ å®¶å±æƒé™è¾¹ç•Œæµ‹è¯• (1å¤©)

**æµ‹è¯•ç›®æ ‡**: éªŒè¯å®¶å±ä¸‰çº§è®¿é—®æƒé™(basic/health/full)çš„åŠŸèƒ½æ­£ç¡®æ€§

**æµ‹è¯•åœºæ™¯**:

#### 3.1 åŸºç¡€æƒé™(basic)æµ‹è¯•
```
æµ‹è¯•æ­¥éª¤:
1. åœ¨family_elderly_relationè¡¨è®¾ç½®:
   INSERT INTO family_elderly_relation 
   VALUES (family_id=1, elderly_id=1, access_level='basic')

2. å®¶å±ç™»å½•,è®¿é—® /elderly/family-detail/1

é¢„æœŸç»“æœ:
- âœ… å¯ä»¥çœ‹åˆ°: å§“åã€æ€§åˆ«ã€å¹´é¾„ã€æˆ¿é—´å·ã€åœ°å€
- âœ… æ˜¾ç¤º"æƒé™æç¤º": æ‚¨å½“å‰æ‹¥æœ‰åŸºç¡€ä¿¡æ¯è®¿é—®æƒé™
- âŒ çœ‹ä¸åˆ°: å¥åº·çŠ¶æ€ã€ç—…å²ã€ç”¨è¯å²
- âŒ "æŸ¥çœ‹å¥åº·è®°å½•"æŒ‰é’®ç¦ç”¨
- âŒ "æŸ¥çœ‹å¥åº·é¢„è­¦"æŒ‰é’®ç¦ç”¨
```

#### 3.2 å¥åº·æƒé™(health)æµ‹è¯•
```
æµ‹è¯•æ­¥éª¤:
1. è®¾ç½®access_level='health'
2. åˆ·æ–°é¡µé¢

é¢„æœŸç»“æœ:
- âœ… å¯ä»¥çœ‹åˆ°æ‰€æœ‰åŸºç¡€ä¿¡æ¯
- âœ… å¯ä»¥çœ‹åˆ°: å¥åº·çŠ¶æ€ã€ç…§æŠ¤ç­‰çº§ã€BMIã€ç—…å²ã€ç”¨è¯å²
- âœ… "æŸ¥çœ‹å¥åº·è®°å½•"æŒ‰é’®å¯ç”¨
- âœ… "æŸ¥çœ‹å¥åº·é¢„è­¦"æŒ‰é’®å¯ç”¨
- âœ… æƒé™æç¤ºæ˜¾ç¤º"å¥åº·ä¿¡æ¯è®¿é—®æƒé™"
```

#### 3.3 å®Œå…¨æƒé™(full)æµ‹è¯•
```
æµ‹è¯•æ­¥éª¤:
1. è®¾ç½®access_level='full'
2. åˆ·æ–°é¡µé¢

é¢„æœŸç»“æœ:
- âœ… æ˜¾ç¤ºæ‰€æœ‰ä¿¡æ¯
- âœ… æ‰€æœ‰å¿«æ·æ“ä½œå¯ç”¨
- âœ… æƒé™æ ‡ç­¾æ˜¾ç¤º"å®Œå…¨è®¿é—®æƒé™"(ç»¿è‰²)
```

#### 3.4 æƒé™åŠ¨æ€åˆ‡æ¢æµ‹è¯•
```
æµ‹è¯•æ­¥éª¤:
1. ç®¡ç†å‘˜ä¿®æ”¹å®¶å±æƒé™: basic -> health
2. å®¶å±ç«¯ä¸åˆ·æ–°é¡µé¢,å¯¼èˆªåˆ°å…¶ä»–é¡µé¢å†è¿”å›

é¢„æœŸç»“æœ:
- âœ… æƒé™ç«‹å³ç”Ÿæ•ˆ
- âœ… é¡µé¢å†…å®¹è‡ªåŠ¨æ›´æ–°
- âœ… æŒ‰é’®çŠ¶æ€æ­£ç¡®åˆ‡æ¢
```

**äº¤ä»˜ç‰©**:
- [ ] å®¶å±æƒé™æµ‹è¯•çŸ©é˜µ
- [ ] æƒé™åˆ‡æ¢æµ‹è¯•è§†é¢‘

---

### 4ï¸âƒ£ æ“ä½œå®¡è®¡æ—¥å¿—æµ‹è¯• (1å¤©)

**æµ‹è¯•ç›®æ ‡**: éªŒè¯@AuditLogæ³¨è§£è®°å½•å…³é”®æ“ä½œ,ç¡®ä¿å®¡è®¡æ—¥å¿—å®Œæ•´å‡†ç¡®

**æµ‹è¯•æ“ä½œæ¸…å•**:

#### 4.1 è€äººæ¡£æ¡ˆæ“ä½œæ—¥å¿—
```
æµ‹è¯•æ“ä½œ:
1. æ–°å¢è€äººæ¡£æ¡ˆ
2. ç¼–è¾‘è€äººä¿¡æ¯
3. åˆ é™¤è€äººæ¡£æ¡ˆ
4. æ‰¹é‡åˆ é™¤

é¢„æœŸaudit_logè®°å½•:
- âœ… operation: "æ–°å¢è€äººæ¡£æ¡ˆ" / "ç¼–è¾‘è€äººä¿¡æ¯" / "åˆ é™¤è€äººæ¡£æ¡ˆ"
- âœ… operator_id: å½“å‰ç™»å½•ç”¨æˆ·ID
- âœ… operator_name: å½“å‰ç™»å½•ç”¨æˆ·å§“å
- âœ… module: "elderly"
- âœ… target_id: è€äººID
- âœ… target_name: è€äººå§“å
- âœ… ip_address: å®¢æˆ·ç«¯IP
- âœ… create_time: æ“ä½œæ—¶é—´
- âœ… details: JSONæ ¼å¼è¯¦ç»†ä¿¡æ¯
```

#### 4.2 å¥åº·è®°å½•æ“ä½œæ—¥å¿—
```
æµ‹è¯•æ“ä½œ:
1. åŒ»ç”Ÿæ·»åŠ å¥åº·è®°å½•
2. åŒ»ç”Ÿå¤„ç†å¥åº·é¢„è­¦

é¢„æœŸè®°å½•:
- âœ… module: "health"
- âœ… operation: "æ·»åŠ å¥åº·è®°å½•" / "å¤„ç†å¥åº·é¢„è­¦"
- âœ… è®°å½•ä¿®æ”¹å‰åçš„æ•°æ®å¯¹æ¯”
```

#### 4.3 æƒé™æ“ä½œæ—¥å¿—
```
æµ‹è¯•æ“ä½œ:
1. ç®¡ç†å‘˜ä¿®æ”¹å®¶å±è®¿é—®æƒé™
2. ç®¡ç†å‘˜åˆ†é…åŒ»ç”Ÿ-è€äººå…³è”å…³ç³»

é¢„æœŸè®°å½•:
- âœ… module: "permission"
- âœ… è®°å½•æƒé™å˜æ›´è¯¦æƒ…
- âœ… before/afteræ•°æ®å¯¹æ¯”
```

#### 4.4 æ—¥å¿—æŸ¥è¯¢æµ‹è¯•
```
æµ‹è¯•åœºæ™¯:
1. ç®¡ç†å‘˜è®¿é—®æ“ä½œæ—¥å¿—é¡µé¢
2. æŒ‰æ—¶é—´èŒƒå›´ç­›é€‰
3. æŒ‰æ“ä½œäººç­›é€‰
4. æŒ‰æ¨¡å—ç­›é€‰
5. å¯¼å‡ºæ—¥å¿—

é¢„æœŸç»“æœ:
- âœ… ç­›é€‰æ¡ä»¶ç”Ÿæ•ˆ
- âœ… åˆ†é¡µæ­£å¸¸
- âœ… å¯¼å‡ºExcelæ ¼å¼æ­£ç¡®
```

**äº¤ä»˜ç‰©**:
- [ ] å®¡è®¡æ—¥å¿—æµ‹è¯•æŠ¥å‘Š
- [ ] audit_logè¡¨æ•°æ®æ ·æœ¬
- [ ] æ—¥å¿—å¯¼å‡ºæ–‡ä»¶æ ·æœ¬

---

## ğŸ“… ç¬¬10å‘¨: æ€§èƒ½ä¼˜åŒ–å’Œä¸Šçº¿ (2025-11-08 ~ 2025-11-14)

### 1ï¸âƒ£ æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ– (2å¤©)

**ä¼˜åŒ–ç›®æ ‡**: å‡å°‘æ…¢æŸ¥è¯¢,æå‡å…³è”æŸ¥è¯¢æ€§èƒ½,ä¼˜åŒ–æ•°æ®æƒé™è¿‡æ»¤SQL

#### 1.1 æ…¢æŸ¥è¯¢åˆ†æ
```sql
-- å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 1; -- è¶…è¿‡1ç§’è®°å½•ä¸ºæ…¢æŸ¥è¯¢

-- åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—
-- æ£€æŸ¥/var/lib/mysql/slow-query.log
```

**é‡ç‚¹ä¼˜åŒ–SQL**:

1. **åŒ»ç”Ÿè´Ÿè´£è€äººæŸ¥è¯¢**
```sql
-- ä¼˜åŒ–å‰ (å¯èƒ½çš„å…¨è¡¨æ‰«æ)
SELECT * FROM elderly_info e
WHERE EXISTS (
  SELECT 1 FROM doctor_elderly_relation der
  WHERE der.doctor_id = ?
  AND der.elderly_id = e.id
)

-- ä¼˜åŒ–å (æ·»åŠ ç´¢å¼•)
CREATE INDEX idx_doctor_elderly ON doctor_elderly_relation(doctor_id, elderly_id);
CREATE INDEX idx_elderly_id ON elderly_info(id);

-- ä½¿ç”¨INNER JOINæ›¿ä»£EXISTS
SELECT e.* FROM elderly_info e
INNER JOIN doctor_elderly_relation der ON e.id = der.elderly_id
WHERE der.doctor_id = ?
```

2. **å®¶å±å…³è”è€äººæŸ¥è¯¢**
```sql
-- æ·»åŠ å¤åˆç´¢å¼•
CREATE INDEX idx_family_elderly ON family_elderly_relation(
  family_member_id, 
  elderly_id, 
  access_level
);
```

3. **å¥åº·é¢„è­¦æŸ¥è¯¢ä¼˜åŒ–**
```sql
-- æ·»åŠ çŠ¶æ€å’Œæ—¶é—´ç´¢å¼•
CREATE INDEX idx_warning_status_time ON health_warning(
  status, 
  warning_level, 
  create_time DESC
);
```

#### 1.2 ç´¢å¼•ä¼˜åŒ–å»ºè®®
```sql
-- elderly_infoè¡¨
ALTER TABLE elderly_info ADD INDEX idx_health_status(health_status);
ALTER TABLE elderly_info ADD INDEX idx_care_level(care_level);
ALTER TABLE elderly_info ADD INDEX idx_room_number(room_number);

-- health_recordsè¡¨
ALTER TABLE health_records ADD INDEX idx_elderly_record_time(
  elderly_id, 
  record_time DESC
);

-- audit_logè¡¨
ALTER TABLE audit_log ADD INDEX idx_operator_time(
  operator_id, 
  create_time DESC
);
ALTER TABLE audit_log ADD INDEX idx_module_time(
  module, 
  create_time DESC
);
```

#### 1.3 æŸ¥è¯¢æ€§èƒ½åŸºå‡†æµ‹è¯•
```
æµ‹è¯•åœºæ™¯:
1. åŒ»ç”ŸæŸ¥è¯¢500ä¸ªè€äºº (æœ‰å…³è”å…³ç³»)
2. æŠ¤å·¥æŸ¥è¯¢200ä¸ªæŠ¤ç†ä»»åŠ¡
3. å®¶å±æŸ¥è¯¢3ä¸ªå…³è”é•¿è¾ˆ
4. ç®¡ç†å‘˜æŸ¥è¯¢æ‰€æœ‰è€äºº(10000æ¡)

ä¼˜åŒ–ç›®æ ‡:
- åŒ»ç”ŸæŸ¥è¯¢: < 200ms
- æŠ¤å·¥æŸ¥è¯¢: < 150ms
- å®¶å±æŸ¥è¯¢: < 100ms
- ç®¡ç†å‘˜æŸ¥è¯¢: < 500ms (åˆ†é¡µ20æ¡/é¡µ)
```

**äº¤ä»˜ç‰©**:
- [ ] æ…¢æŸ¥è¯¢åˆ†ææŠ¥å‘Š
- [ ] ç´¢å¼•ä¼˜åŒ–SQLè„šæœ¬
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•æŠ¥å‘Š

---

### 2ï¸âƒ£ å‰ç«¯åŠ è½½æ€§èƒ½ä¼˜åŒ– (2å¤©)

**ä¼˜åŒ–ç›®æ ‡**: å‡å°‘é¦–å±åŠ è½½æ—¶é—´,ä¼˜åŒ–è·¯ç”±æ‡’åŠ è½½,æå‡ç”¨æˆ·ä½“éªŒ

#### 2.1 è·¯ç”±æ‡’åŠ è½½ä¼˜åŒ–
```javascript
// frontend/src/router/index.js

// ä¼˜åŒ–å‰: æ‰€æœ‰ç»„ä»¶éƒ½åœ¨é¦–æ¬¡åŠ è½½
import ElderlyList from '@/views/elderly/List.vue'

// ä¼˜åŒ–å: æŒ‰éœ€åŠ è½½,ä½¿ç”¨é­”æ³•æ³¨é‡Šåˆ†ç»„
const ElderlyList = () => import(
  /* webpackChunkName: "elderly" */
  '@/views/elderly/List.vue'
)

// åˆ†ç»„ç­–ç•¥:
// - common: é¦–é¡µã€ç™»å½•ã€403/404ç­‰å¸¸ç”¨é¡µé¢
// - elderly: è€äººç®¡ç†ç›¸å…³é¡µé¢
// - doctor: åŒ»ç”Ÿå·¥ä½œå°ç›¸å…³
// - nurse: æŠ¤å·¥å·¥ä½œå°ç›¸å…³
// - family: å®¶å±ä¸“ç”¨é¡µé¢
// - system: ç³»ç»Ÿç®¡ç†é¡µé¢
```

#### 2.2 æƒé™é…ç½®ç¼“å­˜ä¼˜åŒ–
```javascript
// frontend/src/store/permission.js

export const usePermissionStore = defineStore('permission', {
  state: () => ({
    rolePermissions: null,
    cacheTime: null,
    CACHE_DURATION: 5 * 60 * 1000 // 5åˆ†é’Ÿç¼“å­˜
  }),
  
  actions: {
    async loadPermissions(force = false) {
      const now = Date.now()
      
      // å¦‚æœæœ‰ç¼“å­˜ä¸”æœªè¿‡æœŸ,ç›´æ¥ä½¿ç”¨
      if (!force && this.rolePermissions && 
          this.cacheTime && 
          (now - this.cacheTime) < this.CACHE_DURATION) {
        return this.rolePermissions
      }
      
      // é‡æ–°åŠ è½½æƒé™
      const userRole = useUserStore().role
      this.rolePermissions = ROLE_PERMISSIONS[userRole]
      this.cacheTime = now
      
      return this.rolePermissions
    }
  }
})
```

#### 2.3 ç»„ä»¶çº§æ€§èƒ½ä¼˜åŒ–
```vue
<!-- ä½¿ç”¨v-memoä¼˜åŒ–åˆ—è¡¨æ¸²æŸ“ -->
<template>
  <div v-for="elderly in elderlyList" 
       :key="elderly.id"
       v-memo="[elderly.id, elderly.healthStatus]">
    <!-- ä»…åœ¨idæˆ–healthStatuså˜åŒ–æ—¶é‡æ–°æ¸²æŸ“ -->
  </div>
</template>

<!-- è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–é•¿åˆ—è¡¨ -->
<script setup>
import { useVirtualList } from '@vueuse/core'

const { list, containerProps, wrapperProps } = useVirtualList(
  elderlyList,
  { itemHeight: 80 }
)
</script>
```

#### 2.4 é¦–å±åŠ è½½ä¼˜åŒ–æ£€æŸ¥æ¸…å•
```
- [ ] å¯ç”¨gzipå‹ç¼©
- [ ] é…ç½®CDNåŠ é€Ÿ
- [ ] å›¾ç‰‡æ‡’åŠ è½½
- [ ] å­—ä½“å­é›†åŒ–
- [ ] CSSæŒ‰éœ€å¼•å…¥
- [ ] Tree Shaking (ç§»é™¤æœªä½¿ç”¨ä»£ç )
- [ ] Code Splitting (ä»£ç åˆ†å‰²)
- [ ] Prefetch/Preloadå…³é”®èµ„æº
```

**æ€§èƒ½æŒ‡æ ‡ç›®æ ‡**:
- FCP (é¦–æ¬¡å†…å®¹ç»˜åˆ¶): < 1.5s
- LCP (æœ€å¤§å†…å®¹ç»˜åˆ¶): < 2.5s
- TTI (å¯äº¤äº’æ—¶é—´): < 3.5s
- é¦–å±Bundleå¤§å°: < 500KB

**äº¤ä»˜ç‰©**:
- [ ] Lighthouseæ€§èƒ½æŠ¥å‘Š
- [ ] å‰ç«¯æ€§èƒ½ä¼˜åŒ–æ¸…å•
- [ ] æ‰“åŒ…ä½“ç§¯åˆ†ææŠ¥å‘Š

---

### 3ï¸âƒ£ ç¼–å†™ç”¨æˆ·æ“ä½œæ‰‹å†Œ (1å¤©)

**æ–‡æ¡£ç»“æ„**: `docs/user-manual.md`

```markdown
# æ™ºæ…§åŒ»å…»å¹³å°ç”¨æˆ·æ“ä½œæ‰‹å†Œ

## ç¬¬1ç« : ç³»ç»Ÿæ¦‚è¿°
- 1.1 ç³»ç»Ÿç®€ä»‹
- 1.2 è§’è‰²è¯´æ˜
- 1.3 åŠŸèƒ½æ¨¡å—æ€»è§ˆ

## ç¬¬2ç« : ç™»å½•ä¸è´¦æˆ·
- 2.1 é¦–æ¬¡ç™»å½•
- 2.2 å¯†ç ä¿®æ”¹
- 2.3 ä¸ªäººä¿¡æ¯ç»´æŠ¤

## ç¬¬3ç« : è§’è‰²åŠŸèƒ½æŒ‡å—

### 3.1 ç³»ç»Ÿç®¡ç†å‘˜
- ç”¨æˆ·ç®¡ç†
- è§’è‰²é…ç½®
- æƒé™åˆ†é…

### 3.2 ä¸šåŠ¡ç®¡ç†å‘˜
- è€äººæ¡£æ¡ˆç®¡ç†
- åŒ»ç”Ÿè´¦æˆ·ç®¡ç†
- æ•°æ®ç»Ÿè®¡åˆ†æ

### 3.3 åŒ»ç”Ÿ
- å·¥ä½œå°ä½¿ç”¨
- æˆ‘è´Ÿè´£çš„è€äºº
- å¥åº·è®°å½•å½•å…¥
- è¯„ä¼°æŠ¥å‘Šç¼–å†™
- å·¡è¯Šè®°å½•ç®¡ç†

### 3.4 æŠ¤å·¥
- æŠ¤ç†ä»»åŠ¡æŸ¥çœ‹
- æŠ¤ç†è®°å½•å½•å…¥
- ç”¨è¯æ‰§è¡Œç¡®è®¤

### 3.5 ç¤¾å·¥
- æ´»åŠ¨è®¡åˆ’ç®¡ç†
- è®¿è°ˆè®°å½•

### 3.6 å®¶å±
- å…³è”é•¿è¾ˆæŸ¥çœ‹
- å¥åº·é¢„è­¦æŸ¥çœ‹
- æƒé™ç”³è¯·æµç¨‹

## ç¬¬4ç« : æƒé™è¯´æ˜
- 4.1 è®¿é—®æƒé™
- 4.2 æ•°æ®æƒé™
- 4.3 æ“ä½œæƒé™
- 4.4 æƒé™ç”³è¯·

## ç¬¬5ç« : å¸¸è§é—®é¢˜
- 5.1 æ— æ³•è®¿é—®æŸä¸ªé¡µé¢?
- 5.2 çœ‹ä¸åˆ°æŸä¸ªè€äººçš„ä¿¡æ¯?
- 5.3 æŒ‰é’®æ˜¾ç¤ºä¸ºç°è‰²?
- 5.4 å¦‚ä½•ç”³è¯·æ›´é«˜æƒé™?

## ç¬¬6ç« : è”ç³»æ”¯æŒ
- æŠ€æœ¯æ”¯æŒç”µè¯
- é‚®ç®±
- åœ¨çº¿å®¢æœ
```

**ç¼–å†™è¦æ±‚**:
- é…å›¾è¯´æ˜ (æˆªå›¾ + æ ‡æ³¨)
- æ“ä½œæ­¥éª¤æ¸…æ™°
- å¸¸è§é”™è¯¯å¤„ç†
- æœ€ä½³å®è·µå»ºè®®

**äº¤ä»˜ç‰©**:
- [ ] ç”¨æˆ·æ“ä½œæ‰‹å†Œ (Markdown)
- [ ] PDFç‰ˆæœ¬
- [ ] æ“ä½œè§†é¢‘ (å¯é€‰)

---

### 4ï¸âƒ£ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² (2å¤©)

**éƒ¨ç½²æ¶æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Nginx     â”‚ (åå‘ä»£ç† + SSL)
â”‚   80/443    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
    â”Œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                  â”‚              â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ Vue3   â”‚      â”‚ Spring     â”‚  â”‚  MySQL   â”‚
â”‚ å‰ç«¯   â”‚      â”‚ Bootåç«¯   â”‚  â”‚  æ•°æ®åº“  â”‚
â”‚ :5173  â”‚      â”‚ :8080      â”‚  â”‚  :3306   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.1 ç¯å¢ƒå‡†å¤‡
```bash
# æœåŠ¡å™¨é…ç½®å»ºè®®
CPU: 4æ ¸å¿ƒ
å†…å­˜: 8GB
ç£ç›˜: 100GB SSD
æ“ä½œç³»ç»Ÿ: Ubuntu 22.04 LTS

# å®‰è£…ä¾èµ–
sudo apt update
sudo apt install -y nginx mysql-server openjdk-17-jdk nodejs npm
```

#### 4.2 æ•°æ®åº“éƒ¨ç½²
```bash
# 1. æ‰§è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬
mysql -u root -p < backend/sql/create_all_tables.sql

# 2. åˆå§‹åŒ–æƒé™æ•°æ®
mysql -u root -p smartcare < backend/sql/init_roles_and_permissions.sql

# 3. åˆ›å»ºç´¢å¼•
mysql -u root -p smartcare < backend/sql/create_performance_indexes.sql

# 4. å¯¼å…¥æµ‹è¯•æ•°æ® (å¯é€‰)
mysql -u root -p smartcare < backend/test-data/sample_data.sql
```

#### 4.3 åç«¯éƒ¨ç½²
```bash
# 1. ç¼–è¯‘æ‰“åŒ…
cd backend
mvn clean package -DskipTests

# 2. é…ç½®ç”Ÿäº§ç¯å¢ƒ
vim src/main/resources/application-prod.yml

# ä¿®æ”¹:
# - æ•°æ®åº“è¿æ¥
# - JWTå¯†é’¥
# - æ—¥å¿—çº§åˆ«
# - è·¨åŸŸé…ç½®

# 3. å¯åŠ¨åç«¯æœåŠ¡
nohup java -jar target/smartcare-cloud-0.0.1.jar \
  --spring.profiles.active=prod \
  > /var/log/smartcare/backend.log 2>&1 &

# 4. é…ç½®systemdæœåŠ¡
sudo vim /etc/systemd/system/smartcare-backend.service

[Unit]
Description=SmartCare Backend Service
After=network.target mysql.service

[Service]
Type=simple
User=smartcare
WorkingDirectory=/opt/smartcare/backend
ExecStart=/usr/bin/java -jar smartcare-cloud-0.0.1.jar --spring.profiles.active=prod
Restart=on-failure

[Install]
WantedBy=multi-user.target

# å¯åŠ¨æœåŠ¡
sudo systemctl enable smartcare-backend
sudo systemctl start smartcare-backend
```

#### 4.4 å‰ç«¯éƒ¨ç½²
```bash
# 1. æ„å»ºç”Ÿäº§ç‰ˆæœ¬
cd frontend
npm run build

# 2. é…ç½®Nginx
sudo vim /etc/nginx/sites-available/smartcare

server {
    listen 80;
    server_name smartcare.example.com;
    
    # é‡å®šå‘åˆ°HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name smartcare.example.com;
    
    # SSLè¯ä¹¦
    ssl_certificate /etc/ssl/certs/smartcare.crt;
    ssl_certificate_key /etc/ssl/private/smartcare.key;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    root /opt/smartcare/frontend/dist;
    index index.html;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # åç«¯APIä»£ç†
    location /api {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # Gzipå‹ç¼©
    gzip on;
    gzip_types text/plain text/css application/json application/javascript;
    gzip_min_length 1000;
}

# å¯ç”¨ç«™ç‚¹
sudo ln -s /etc/nginx/sites-available/smartcare /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

#### 4.5 SSLè¯ä¹¦é…ç½®
```bash
# ä½¿ç”¨Let's Encryptå…è´¹è¯ä¹¦
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d smartcare.example.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

#### 4.6 ç›‘æ§é…ç½®
```bash
# å®‰è£…Prometheus + Grafana (å¯é€‰)
# é…ç½®Spring Boot Actuator
# ç›‘æ§æŒ‡æ ‡:
# - CPU/å†…å­˜ä½¿ç”¨ç‡
# - æ¥å£å“åº”æ—¶é—´
# - æ•°æ®åº“è¿æ¥æ•°
# - é”™è¯¯ç‡
# - åœ¨çº¿ç”¨æˆ·æ•°
```

#### 4.7 éƒ¨ç½²æ£€æŸ¥æ¸…å•
```
ç¯å¢ƒé…ç½®:
- [ ] æ•°æ®åº“è¿æ¥æµ‹è¯•
- [ ] Redisè¿æ¥æµ‹è¯• (å¦‚ä½¿ç”¨)
- [ ] é˜²ç«å¢™è§„åˆ™é…ç½®
- [ ] SSLè¯ä¹¦æœ‰æ•ˆæœŸæ£€æŸ¥

åŠŸèƒ½éªŒè¯:
- [ ] ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] å„è§’è‰²æƒé™æ­£ç¡®
- [ ] APIæ¥å£å“åº”æ­£å¸¸
- [ ] é™æ€èµ„æºåŠ è½½æ­£å¸¸
- [ ] 403/404é¡µé¢æ­£å¸¸

æ€§èƒ½éªŒè¯:
- [ ] é¦–é¡µåŠ è½½ < 3ç§’
- [ ] æ¥å£å“åº” < 500ms
- [ ] å¹¶å‘100ç”¨æˆ·æ— å¼‚å¸¸

å®‰å…¨éªŒè¯:
- [ ] HTTPSå¼ºåˆ¶è·³è½¬
- [ ] SQLæ³¨å…¥é˜²æŠ¤
- [ ] XSSé˜²æŠ¤
- [ ] CSRFé˜²æŠ¤
- [ ] æ•æ„Ÿæ•°æ®åŠ å¯†

å¤‡ä»½ç­–ç•¥:
- [ ] æ•°æ®åº“æ¯æ—¥å¤‡ä»½
- [ ] åº”ç”¨æ—¥å¿—ä¿ç•™30å¤©
- [ ] ä»£ç ç‰ˆæœ¬ç®¡ç†
```

**äº¤ä»˜ç‰©**:
- [ ] éƒ¨ç½²æ–‡æ¡£
- [ ] ç¯å¢ƒé…ç½®æ¸…å•
- [ ] è¿ç»´æ‰‹å†Œ
- [ ] åº”æ€¥é¢„æ¡ˆ

---

## ğŸ“Š éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [x] 6ç§è§’è‰²æƒé™æ­£å¸¸è¿è¡Œ
- [x] æ•°æ®éš”ç¦»æœ‰æ•ˆ
- [x] å®¶å±ä¸‰çº§æƒé™ç”Ÿæ•ˆ
- [x] å®¡è®¡æ—¥å¿—å®Œæ•´

### æ€§èƒ½éªŒæ”¶
- [ ] æ•°æ®åº“æŸ¥è¯¢ < 500ms
- [ ] é¦–å±åŠ è½½ < 3s
- [ ] å¹¶å‘100ç”¨æˆ·ç¨³å®š

### å®‰å…¨éªŒæ”¶
- [ ] è¶Šæƒè®¿é—®è¢«æ‹¦æˆª
- [ ] HTTPSåŠ å¯†ä¼ è¾“
- [ ] æ•æ„Ÿæ•°æ®åŠ å¯†
- [ ] å®¡è®¡æ—¥å¿—è®°å½•

### æ–‡æ¡£éªŒæ”¶
- [ ] ç”¨æˆ·æ‰‹å†Œå®Œæ•´
- [ ] éƒ¨ç½²æ–‡æ¡£æ¸…æ™°
- [ ] æµ‹è¯•æŠ¥å‘Šé½å…¨

---

## ğŸ“ é£é™©ç®¡ç†

### é«˜é£é™©é¡¹
1. **ç”Ÿäº§ç¯å¢ƒæ•°æ®è¿ç§»å¤±è´¥**
   - ç¼“è§£æªæ–½: æå‰å¤‡ä»½,åˆ†æ­¥è¿ç§»,å›æ»šæ–¹æ¡ˆ
   
2. **æ€§èƒ½ä¸è¾¾æ ‡**
   - ç¼“è§£æªæ–½: é¢„å…ˆå‹æµ‹,é€æ­¥ä¼˜åŒ–,ç›‘æ§å‘Šè­¦

3. **æƒé™é…ç½®é”™è¯¯**
   - ç¼“è§£æªæ–½: å……åˆ†æµ‹è¯•,ç°åº¦å‘å¸ƒ,å¿«é€Ÿä¿®å¤

### åº”æ€¥é¢„æ¡ˆ
- æ•°æ®åº“å¤‡ä»½æ¢å¤æµç¨‹
- åº”ç”¨å¿«é€Ÿå›æ»šæ–¹æ¡ˆ
- ç´§æ€¥è”ç³»äººåå•
- æ•…éšœå¤„ç†SOP

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

1. âœ… æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡
2. âœ… æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
3. âœ… ç”Ÿäº§ç¯å¢ƒç¨³å®šè¿è¡Œ7å¤©
4. âœ… ç”¨æˆ·åŸ¹è®­å®Œæˆ
5. âœ… æ–‡æ¡£äº¤ä»˜é½å…¨

---

**è®¡åˆ’åˆ¶å®š**: 2025-10-29  
**è®¡åˆ’æ‰§è¡Œ**: 2025-11-01 ~ 2025-11-14  
**é¢„è®¡äº¤ä»˜**: 2025-11-15
