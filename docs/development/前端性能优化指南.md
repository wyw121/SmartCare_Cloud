# å‰ç«¯æ€§èƒ½ä¼˜åŒ–æŒ‡å—

æ™ºæ…§åŒ»å…»å¹³å°å‰ç«¯æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µå’Œå®æ–½æŒ‡å—ã€‚

## ğŸ“‹ ç›®å½•
- [è·¯ç”±æ‡’åŠ è½½](#è·¯ç”±æ‡’åŠ è½½)
- [ç»„ä»¶æ‡’åŠ è½½](#ç»„ä»¶æ‡’åŠ è½½)
- [è™šæ‹Ÿæ»šåŠ¨](#è™šæ‹Ÿæ»šåŠ¨)
- [å›¾ç‰‡ä¼˜åŒ–](#å›¾ç‰‡ä¼˜åŒ–)
- [çŠ¶æ€ç®¡ç†ä¼˜åŒ–](#çŠ¶æ€ç®¡ç†ä¼˜åŒ–)
- [è¯·æ±‚ä¼˜åŒ–](#è¯·æ±‚ä¼˜åŒ–)

---

## ğŸš€ è·¯ç”±æ‡’åŠ è½½

### âœ… å·²å®ç°
é¡¹ç›®å·²ç»ä½¿ç”¨åŠ¨æ€å¯¼å…¥å®ç°äº†è·¯ç”±æ‡’åŠ è½½ï¼š

```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨åŠ¨æ€import
{
  path: 'list',
  name: 'ElderlyList',
  component: () => import('@/views/elderly/list.vue'),
  meta: { title: 'è€äººæ¡£æ¡ˆåˆ—è¡¨', icon: 'list' }
}
```

### âš ï¸ é¿å…
```javascript
// âŒ é”™è¯¯ï¼šé™æ€å¯¼å…¥ä¼šæ‰“åŒ…åˆ°ä¸»bundle
import ElderlyList from '@/views/elderly/list.vue'

{
  path: 'list',
  component: ElderlyList
}
```

### ğŸ“¦ ä»£ç åˆ†å‰²ä¼˜åŒ–
ä½¿ç”¨é­”æ³•æ³¨é‡Šä¸ºè·¯ç”±æ¨¡å—åˆ†ç»„ï¼š

```javascript
// å°†ç›¸å…³è·¯ç”±æ‰“åŒ…åˆ°åŒä¸€ä¸ªchunk
{
  path: 'list',
  component: () => import(/* webpackChunkName: "elderly" */ '@/views/elderly/list.vue')
},
{
  path: 'detail/:id',
  component: () => import(/* webpackChunkName: "elderly" */ '@/views/elderly/Detail.vue')
}
```

---

## ğŸ¯ ç»„ä»¶æ‡’åŠ è½½

### 1. å¤§å‹ç»„ä»¶æŒ‰éœ€åŠ è½½

```vue
<script setup>
import { defineAsyncComponent } from 'vue'

// æ‡’åŠ è½½å¤§å‹å›¾è¡¨ç»„ä»¶
const HealthStatisticsDialog = defineAsyncComponent(() => 
  import('@/components/HealthStatisticsDialog.vue')
)

const CareStatisticsDialog = defineAsyncComponent(() => 
  import('@/components/CareStatisticsDialog.vue')
)

const AssessmentReportDialog = defineAsyncComponent({
  loader: () => import('@/components/elderly/AssessmentReportDialog.vue'),
  loadingComponent: LoadingComponent, // å¯é€‰ï¼šåŠ è½½æ—¶æ˜¾ç¤ºçš„ç»„ä»¶
  errorComponent: ErrorComponent, // å¯é€‰ï¼šåŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºçš„ç»„ä»¶
  delay: 200, // å»¶è¿Ÿæ˜¾ç¤ºloadingç»„ä»¶çš„æ—¶é—´
  timeout: 3000 // è¶…æ—¶æ—¶é—´
})
</script>

<template>
  <!-- åªæœ‰åœ¨æ‰“å¼€å¯¹è¯æ¡†æ—¶æ‰åŠ è½½ç»„ä»¶ -->
  <AssessmentReportDialog v-if="showDialog" />
</template>
```

### 2. æ ‡ç­¾é¡µå†…å®¹æ‡’åŠ è½½

```vue
<script setup>
import { ref, defineAsyncComponent } from 'vue'

const activeTab = ref('basic')

// æŒ‰æ ‡ç­¾é¡µæ‡’åŠ è½½
const tabs = {
  basic: defineAsyncComponent(() => import('./tabs/BasicInfo.vue')),
  health: defineAsyncComponent(() => import('./tabs/HealthInfo.vue')),
  records: defineAsyncComponent(() => import('./tabs/HealthRecords.vue'))
}
</script>

<template>
  <el-tabs v-model="activeTab">
    <el-tab-pane label="åŸºæœ¬ä¿¡æ¯" name="basic">
      <component :is="tabs.basic" />
    </el-tab-pane>
    <el-tab-pane label="å¥åº·ä¿¡æ¯" name="health">
      <component :is="tabs.health" />
    </el-tab-pane>
    <el-tab-pane label="å¥åº·è®°å½•" name="records">
      <component :is="tabs.records" />
    </el-tab-pane>
  </el-tabs>
</template>
```

---

## ğŸ“œ è™šæ‹Ÿæ»šåŠ¨å®ç°

### æ–¹æ¡ˆ1: ä½¿ç”¨ el-table çš„è™šæ‹Ÿæ»šåŠ¨ï¼ˆElement Plus 2.4+ï¼‰

```vue
<template>
  <el-table-v2
    :columns="columns"
    :data="tableData"
    :width="700"
    :height="400"
    fixed
  />
</template>

<script setup>
import { ref } from 'vue'

const columns = [
  { key: 'name', dataKey: 'name', title: 'å§“å', width: 150 },
  { key: 'age', dataKey: 'age', title: 'å¹´é¾„', width: 100 },
  { key: 'phone', dataKey: 'phone', title: 'ç”µè¯', width: 150 }
]

// å¤§é‡æ•°æ®
const tableData = ref([/* ...thousands of rows */])
</script>
```

### æ–¹æ¡ˆ2: ä½¿ç”¨ vue-virtual-scroller

```bash
npm install vue-virtual-scroller
```

```vue
<template>
  <RecycleScroller
    class="elderly-scroller"
    :items="elderlyList"
    :item-size="80"
    key-field="id"
    v-slot="{ item }"
  >
    <div class="elderly-item">
      <h3>{{ item.name }}</h3>
      <p>{{ item.healthStatus }}</p>
    </div>
  </RecycleScroller>
</template>

<script setup>
import { RecycleScroller } from 'vue-virtual-scroller'
import 'vue-virtual-scroller/dist/vue-virtual-scroller.css'
import { ref } from 'vue'

const elderlyList = ref([]) // å¤§é‡æ•°æ®
</script>

<style>
.elderly-scroller {
  height: 600px;
}

.elderly-item {
  height: 80px;
  padding: 10px;
  border-bottom: 1px solid #eee;
}
</style>
```

### æ–¹æ¡ˆ3: ç®€å•çš„åˆ†é¡µåŠ è½½ï¼ˆæ¨èç°é˜¶æ®µä½¿ç”¨ï¼‰

```vue
<script setup>
import { ref, onMounted } from 'vue'
import { getElderlyPage } from '@/api/elderly'

const loading = ref(false)
const elderlyList = ref([])
const pagination = ref({
  current: 1,
  size: 20,
  total: 0
})

// åŠ è½½æ•°æ®
const loadData = async () => {
  loading.value = true
  try {
    const res = await getElderlyPage({
      pageNum: pagination.value.current,
      pageSize: pagination.value.size
    })
    elderlyList.value = res.data.records
    pagination.value.total = res.data.total
  } finally {
    loading.value = false
  }
}

// æ»šåŠ¨åŠ è½½æ›´å¤šï¼ˆæ— é™æ»šåŠ¨ï¼‰
const handleScroll = (e) => {
  const { scrollTop, scrollHeight, clientHeight } = e.target
  if (scrollTop + clientHeight >= scrollHeight - 10 && !loading.value) {
    if (elderlyList.value.length < pagination.value.total) {
      pagination.value.current++
      loadMore()
    }
  }
}

const loadMore = async () => {
  loading.value = true
  try {
    const res = await getElderlyPage({
      pageNum: pagination.value.current,
      pageSize: pagination.value.size
    })
    // è¿½åŠ æ•°æ®
    elderlyList.value.push(...res.data.records)
  } finally {
    loading.value = false
  }
}

onMounted(loadData)
</script>

<template>
  <div class="elderly-container" @scroll="handleScroll">
    <div v-for="item in elderlyList" :key="item.id" class="elderly-item">
      <!-- è€äººä¿¡æ¯å¡ç‰‡ -->
    </div>
    <div v-if="loading" class="loading">åŠ è½½ä¸­...</div>
  </div>
</template>
```

---

## ğŸ–¼ï¸ å›¾ç‰‡ä¼˜åŒ–

### 1. å›¾ç‰‡æ‡’åŠ è½½

```vue
<template>
  <!-- ä½¿ç”¨ v-lazy æŒ‡ä»¤ï¼ˆéœ€å®‰è£… vue-lazyloadï¼‰ -->
  <img v-lazy="item.avatar" alt="å¤´åƒ" />
  
  <!-- æˆ–ä½¿ç”¨åŸç”Ÿ loading å±æ€§ -->
  <img :src="item.avatar" loading="lazy" alt="å¤´åƒ" />
</template>
```

### 2. å“åº”å¼å›¾ç‰‡

```vue
<template>
  <img
    :srcset="`
      ${item.avatar}-small.jpg 300w,
      ${item.avatar}-medium.jpg 600w,
      ${item.avatar}-large.jpg 1200w
    `"
    sizes="(max-width: 600px) 300px, 
           (max-width: 1200px) 600px, 
           1200px"
    :src="item.avatar"
    alt="å¤´åƒ"
  />
</template>
```

### 3. å›¾ç‰‡å ä½ç¬¦

```vue
<script setup>
const defaultAvatar = '/images/default-avatar.png'
const handleImageError = (e) => {
  e.target.src = defaultAvatar
}
</script>

<template>
  <img 
    :src="item.avatar || defaultAvatar" 
    @error="handleImageError"
    alt="å¤´åƒ"
  />
</template>
```

---

## ğŸ’¾ çŠ¶æ€ç®¡ç†ä¼˜åŒ–

### âœ… æœ€ä½³å®è·µ

#### 1. é¿å…åœ¨ç»„ä»¶ä¸­å­˜å‚¨é‡å¤æ•°æ®

```javascript
// âŒ ä¸å¥½ï¼šåœ¨å¤šä¸ªç»„ä»¶ä¸­å­˜å‚¨åŒä¸€ä»½æ•°æ®
// Component A
const elderlyList = ref([...])

// Component B
const elderlyList = ref([...]) // é‡å¤æ•°æ®

// âœ… å¥½ï¼šä½¿ç”¨ Pinia Store ç»Ÿä¸€ç®¡ç†
// stores/elderly.js
export const useElderlyStore = defineStore('elderly', {
  state: () => ({
    list: [],
    currentElderly: null
  }),
  actions: {
    async fetchList() {
      const res = await getElderlyPage()
      this.list = res.data.records
    }
  }
})
```

#### 2. åˆç†ä½¿ç”¨è®¡ç®—å±æ€§

```javascript
// âœ… åœ¨ Store ä¸­ä½¿ç”¨ getters
export const useElderlyStore = defineStore('elderly', {
  state: () => ({
    list: []
  }),
  getters: {
    // è‡ªåŠ¨ç¼“å­˜ï¼Œåªæœ‰ä¾èµ–å˜åŒ–æ—¶æ‰é‡æ–°è®¡ç®—
    healthyCount: (state) => state.list.filter(e => e.healthStatus === 'HEALTHY').length,
    sickCount: (state) => state.list.filter(e => e.healthStatus === 'SICK').length,
    
    // å¸¦å‚æ•°çš„ getter
    getElderlyById: (state) => (id) => state.list.find(e => e.id === id)
  }
})
```

#### 3. é¿å…å­˜å‚¨å†—ä½™æ•°æ®

```javascript
// âŒ ä¸å¥½ï¼šå­˜å‚¨æ´¾ç”Ÿæ•°æ®
{
  state: () => ({
    elderlyList: [],
    healthyList: [],  // å†—ä½™
    sickList: []      // å†—ä½™
  })
}

// âœ… å¥½ï¼šä½¿ç”¨ getters è®¡ç®—æ´¾ç”Ÿæ•°æ®
{
  state: () => ({
    list: []
  }),
  getters: {
    healthyList: (state) => state.list.filter(e => e.healthStatus === 'HEALTHY'),
    sickList: (state) => state.list.filter(e => e.healthStatus === 'SICK')
  }
}
```

---

## ğŸŒ è¯·æ±‚ä¼˜åŒ–

### 1. è¯·æ±‚é˜²æŠ–

```javascript
import { debounce } from 'lodash-es'

// æœç´¢æ¡†é˜²æŠ–
const searchElderly = debounce(async (keyword) => {
  const res = await getElderlyPage({ name: keyword })
  elderlyList.value = res.data.records
}, 300)
```

### 2. è¯·æ±‚å–æ¶ˆ

```javascript
import { ref } from 'vue'
import axios from 'axios'

const controller = ref(null)

const searchElderly = async (keyword) => {
  // å–æ¶ˆä¸Šä¸€æ¬¡æœªå®Œæˆçš„è¯·æ±‚
  if (controller.value) {
    controller.value.abort()
  }
  
  controller.value = new AbortController()
  
  try {
    const res = await axios.get('/api/elderly/search', {
      params: { keyword },
      signal: controller.value.signal
    })
    return res.data
  } catch (error) {
    if (axios.isCancel(error)) {
      console.log('è¯·æ±‚å·²å–æ¶ˆ')
    }
  }
}
```

### 3. è¯·æ±‚ç¼“å­˜

```javascript
// utils/cache.js
const cache = new Map()
const CACHE_TIME = 5 * 60 * 1000 // 5åˆ†é’Ÿ

export function cacheRequest(key, fetcher, ttl = CACHE_TIME) {
  const cached = cache.get(key)
  
  if (cached && Date.now() - cached.timestamp < ttl) {
    return Promise.resolve(cached.data)
  }
  
  return fetcher().then(data => {
    cache.set(key, {
      data,
      timestamp: Date.now()
    })
    return data
  })
}

// ä½¿ç”¨
import { cacheRequest } from '@/utils/cache'

const loadElderlyList = () => {
  return cacheRequest('elderlyList', () => getElderlyPage())
}
```

### 4. å¹¶å‘è¯·æ±‚ä¼˜åŒ–

```javascript
// âŒ ä¸å¥½ï¼šä¸²è¡Œè¯·æ±‚
const elderly = await getElderlyById(id)
const healthRecords = await getHealthRecords(id)
const warnings = await getWarnings(id)

// âœ… å¥½ï¼šå¹¶è¡Œè¯·æ±‚
const [elderly, healthRecords, warnings] = await Promise.all([
  getElderlyById(id),
  getHealthRecords(id),
  getWarnings(id)
])
```

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### ä½¿ç”¨ Performance API

```javascript
// utils/performance.js
export function measurePageLoad() {
  window.addEventListener('load', () => {
    const perfData = performance.getEntriesByType('navigation')[0]
    
    console.table({
      'DNSæŸ¥è¯¢': perfData.domainLookupEnd - perfData.domainLookupStart,
      'TCPè¿æ¥': perfData.connectEnd - perfData.connectStart,
      'è¯·æ±‚å“åº”': perfData.responseEnd - perfData.requestStart,
      'DOMè§£æ': perfData.domInteractive - perfData.domLoading,
      'é¡µé¢åŠ è½½': perfData.loadEventEnd - perfData.loadEventStart,
      'æ€»æ—¶é—´': perfData.loadEventEnd - perfData.fetchStart
    })
  })
}
```

### Vue DevTools æ€§èƒ½åˆ†æ

1. æ‰“å¼€ Vue DevTools
2. åˆ‡æ¢åˆ° "Performance" æ ‡ç­¾
3. ç‚¹å‡» "Start recording"
4. æ‰§è¡Œéœ€è¦åˆ†æçš„æ“ä½œ
5. ç‚¹å‡» "Stop recording"
6. æŸ¥çœ‹ç»„ä»¶æ¸²æŸ“æ—¶é—´å’Œæ€§èƒ½ç“¶é¢ˆ

---

## âœ… ä¼˜åŒ–æ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰è·¯ç”±éƒ½ä½¿ç”¨æ‡’åŠ è½½
- [ ] å¤§å‹ç»„ä»¶ä½¿ç”¨å¼‚æ­¥ç»„ä»¶
- [ ] é•¿åˆ—è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨æˆ–åˆ†é¡µ
- [ ] å›¾ç‰‡ä½¿ç”¨æ‡’åŠ è½½
- [ ] åˆç†ä½¿ç”¨ Pinia Store
- [ ] é¿å…ç»„ä»¶å†…éƒ¨è¿‡å¤šä¸šåŠ¡é€»è¾‘
- [ ] æœç´¢æ¡†ä½¿ç”¨é˜²æŠ–
- [ ] å–æ¶ˆæœªå®Œæˆçš„è¯·æ±‚
- [ ] ä½¿ç”¨è¯·æ±‚ç¼“å­˜
- [ ] å¹¶è¡Œå‘èµ·ç‹¬ç«‹è¯·æ±‚
- [ ] ä½¿ç”¨ keep-alive ç¼“å­˜ç»„ä»¶
- [ ] é¿å…ä¸å¿…è¦çš„å“åº”å¼æ•°æ®
- [ ] ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒæ„å»º
- [ ] å¯ç”¨ Gzip å‹ç¼©
- [ ] ä½¿ç”¨ CDN åŠ è½½ç¬¬ä¸‰æ–¹åº“

---

## ğŸš€ ä¸‹ä¸€æ­¥

å»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºå®æ–½ä¼˜åŒ–ï¼š

1. **ç«‹å³æ‰§è¡Œ**ï¼š
   - æ£€æŸ¥è·¯ç”±æ‡’åŠ è½½æ˜¯å¦å®Œæ•´
   - ä¸ºæœç´¢æ¡†æ·»åŠ é˜²æŠ–

2. **çŸ­æœŸä¼˜åŒ–**ï¼ˆ1-2å‘¨ï¼‰ï¼š
   - å®ç°å…³é”®åˆ—è¡¨çš„è™šæ‹Ÿæ»šåŠ¨
   - ä¼˜åŒ–å›¾ç‰‡åŠ è½½

3. **ä¸­æœŸä¼˜åŒ–**ï¼ˆ1ä¸ªæœˆï¼‰ï¼š
   - å®Œå–„çŠ¶æ€ç®¡ç†
   - æ·»åŠ è¯·æ±‚ç¼“å­˜

4. **é•¿æœŸä¼˜åŒ–**ï¼ˆæŒç»­ï¼‰ï¼š
   - æ€§èƒ½ç›‘æ§å’Œåˆ†æ
   - æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ä¼˜åŒ–ç­–ç•¥
