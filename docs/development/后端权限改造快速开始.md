# åç«¯æƒé™æ”¹é€  - å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### 1. æ‰§è¡Œæ•°æ®åº“è„šæœ¬

```bash
# è¿æ¥æ•°æ®åº“
mysql -u root -p

# é€‰æ‹©æ•°æ®åº“
USE smartcare_cloud;

# æ‰§è¡Œè„šæœ¬
SOURCE D:/repositories/SmartCare_Cloud/backend/sql/permission_enhancement.sql;
```

### 2. ç¼–è¯‘é¡¹ç›®

```bash
cd backend
mvn clean compile
```

### 3. å¯åŠ¨åç«¯æœåŠ¡

```bash
mvn spring-boot:run -Dspring-boot.run.profiles=dev
```

### 4. è®¿é—®APIæ–‡æ¡£

æ‰“å¼€æµè§ˆå™¨è®¿é—®: `http://localhost:8080/swagger-ui.html`

---

## ğŸ“– æ ¸å¿ƒåŠŸèƒ½ä½¿ç”¨

### åŠŸèƒ½1: ä¸ºåŒ»ç”Ÿåˆ†é…è€äºº

**API**: `POST /api/doctor-elderly-relation/assign`

```json
{
  "doctorId": 1,
  "elderlyIds": [1, 2, 3],
  "relationshipType": "primary"
}
```

### åŠŸèƒ½2: æŸ¥è¯¢åŒ»ç”Ÿè´Ÿè´£çš„è€äºº

**API**: `GET /api/doctor-elderly-relation/doctor/{doctorId}/elderly-list`

### åŠŸèƒ½3: è½¬ç§»ä¸»æ²»åŒ»ç”Ÿ

**API**: `POST /api/doctor-elderly-relation/transfer`

```json
{
  "elderlyId": 1,
  "oldDoctorId": 1,
  "newDoctorId": 2
}
```

### åŠŸèƒ½4: æƒé™æ ¡éªŒç¤ºä¾‹

è®¿é—®è€äººè¯¦æƒ…æ—¶è‡ªåŠ¨æ ¡éªŒæƒé™:

```bash
# åŒ»ç”ŸToken (åªèƒ½è®¿é—®è´Ÿè´£çš„è€äºº)
curl -H "Authorization: Bearer <doctor_token>" \
     http://localhost:8080/api/elderly/1

# è¿”å›: 200 OK (æœ‰æƒé™)
# æˆ–: 403 Forbidden (æ— æƒé™)
```

---

## ğŸ”§ Controllerä¸­ä½¿ç”¨æƒé™æ³¨è§£

```java
@RestController
@RequestMapping("/api/elderly")
public class ElderlyController {
    
    // æ·»åŠ @DataPermissionæ³¨è§£å³å¯å¯ç”¨æƒé™æ ¡éªŒ
    @DataPermission(elderlyIdParam = "id")
    @GetMapping("/{id}")
    public ResponseResult<Elderly> getElderlyById(@PathVariable Long id) {
        // æ‰§è¡Œå‰ä¼šè‡ªåŠ¨æ ¡éªŒæƒé™
        return elderlyService.getElderlyById(id);
    }
}
```

---

## ğŸ“Š æµ‹è¯•æ•°æ®

### æµ‹è¯•ç”¨æˆ·

| è§’è‰² | ç”¨æˆ·å | å¯†ç  | è¯´æ˜ |
|------|--------|------|------|
| ç®¡ç†å‘˜ | admin | 123456 | è®¿é—®æ‰€æœ‰æ•°æ® |
| åŒ»ç”Ÿ1 | doctor1 | 123456 | åªèƒ½è®¿é—®è´Ÿè´£çš„è€äºº |
| åŒ»ç”Ÿ2 | doctor2 | 123456 | åªèƒ½è®¿é—®è´Ÿè´£çš„è€äºº |
| å®¶å± | family1 | 123456 | åªèƒ½è®¿é—®å…³è”çš„è€äºº |

### æµ‹è¯•å…³è”å…³ç³»

```sql
-- åŒ»ç”Ÿ1è´Ÿè´£è€äºº1å’Œè€äºº2
INSERT INTO doctor_elderly_relation (doctor_id, elderly_id, relationship_type, start_date, status)
VALUES (1, 1, 'primary', CURDATE(), 1),
       (1, 2, 'primary', CURDATE(), 1);

-- åŒ»ç”Ÿ2è´Ÿè´£è€äºº3
INSERT INTO doctor_elderly_relation (doctor_id, elderly_id, relationship_type, start_date, status)
VALUES (2, 3, 'primary', CURDATE(), 1);
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **JWTé…ç½®**: ç¡®ä¿`application.yml`ä¸­é…ç½®äº†æ­£ç¡®çš„JWTå¯†é’¥
2. **æ•°æ®åº“æƒé™**: æ‰§è¡ŒSQLè„šæœ¬éœ€è¦CREATE TABLEæƒé™
3. **ç«¯å£å ç”¨**: é»˜è®¤ç«¯å£8080,å¦‚æœ‰å†²çªè¯·ä¿®æ”¹é…ç½®
4. **Redis**: å¦‚æœå¯ç”¨ç¼“å­˜,éœ€è¦å¯åŠ¨RedisæœåŠ¡
5. **æ—¥å¿—çº§åˆ«**: å¼€å‘ç¯å¢ƒå»ºè®®è®¾ç½®DEBUGçº§åˆ«æŸ¥çœ‹æƒé™æ ¡éªŒæ—¥å¿—

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æƒé™æ ¡éªŒä¸ç”Ÿæ•ˆ?

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹:
1. æ˜¯å¦æ·»åŠ äº†`@DataPermission`æ³¨è§£
2. JWT Tokenæ˜¯å¦æ­£ç¡®ä¼ é€’
3. åˆ‡é¢æ˜¯å¦æ­£ç¡®é…ç½® (æ£€æŸ¥@Aspectå’Œ@Componentæ³¨è§£)

### Q2: åŒ»ç”Ÿæ— æ³•è®¿é—®è‡ªå·±è´Ÿè´£çš„è€äºº?

**A**: æ£€æŸ¥:
1. `doctor_elderly_relation`è¡¨ä¸­æ˜¯å¦æœ‰å¯¹åº”è®°å½•
2. è®°å½•çš„`status`å­—æ®µæ˜¯å¦ä¸º1
3. `end_date`æ˜¯å¦ä¸ºnullæˆ–æœªè¿‡æœŸ

### Q3: ç¼–è¯‘é”™è¯¯?

**A**: ç¡®ä¿:
1. Mavenç‰ˆæœ¬ â‰¥ 3.8
2. JDKç‰ˆæœ¬ = 11
3. ä¾èµ–ä¸‹è½½å®Œæ•´: `mvn clean install`

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜,è¯·æŸ¥çœ‹:
- è¯¦ç»†æ–‡æ¡£: `docs/reports/åç«¯æƒé™æ”¹é€ å®ŒæˆæŠ¥å‘Š.md`
- APIæ–‡æ¡£: `http://localhost:8080/swagger-ui.html`
- æ—¥å¿—æ–‡ä»¶: `backend/logs/smartcare.log`

---

**æœ€åæ›´æ–°**: 2025-10-29  
**ç‰ˆæœ¬**: v1.0.0
