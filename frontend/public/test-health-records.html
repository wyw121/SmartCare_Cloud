<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>健康档案功能测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .result {
            background-color: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            white-space: pre-wrap;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .success {
            color: #28a745;
        }
        .error {
            color: #dc3545;
        }
        .info {
            color: #17a2b8;
        }
    </style>
</head>
<body>
    <h1>健康档案功能测试</h1>
    
    <div class="test-section">
        <h3>1. 测试后端健康档案API</h3>
        <p>测试后端是否能正确返回健康档案数据：</p>
        <button onclick="testHealthRecordsAPI(1)">测试老人ID:1的健康档案</button>
        <button onclick="testHealthRecordsAPI(2)">测试老人ID:2的健康档案</button>
        <button onclick="testHealthRecordsAPI(3)">测试老人ID:3的健康档案</button>
        <div id="apiResult" class="result">等待测试...</div>
    </div>

    <div class="test-section">
        <h3>2. 测试前端路由跳转</h3>
        <p>测试健康档案页面路由是否正常：</p>
        <a href="/elderly/health-records/1" target="_blank">打开老人ID:1的健康档案页面</a><br><br>
        <a href="/elderly/health-records/2" target="_blank">打开老人ID:2的健康档案页面</a><br><br>
        <a href="/elderly/health-records/3" target="_blank">打开老人ID:3的健康档案页面</a><br><br>
        
        <h4>从老人列表页面访问：</h4>
        <a href="/elderly/list" target="_blank">打开老人列表页面，然后点击"健康档案"按钮</a>
    </div>

    <div class="test-section">
        <h3>3. 功能特性说明</h3>
        <div class="info">
            <h4>新的健康档案页面包含以下功能：</h4>
            <ul>
                <li><strong>患者基本信息展示</strong>：头像、姓名、性别、年龄、健康状态等</li>
                <li><strong>统计数据</strong>：总记录数、近30天记录、异常记录、就诊医生数量</li>
                <li><strong>健康记录时间线</strong>：按时间顺序展示所有健康记录</li>
                <li><strong>记录类型过滤</strong>：可按体检、就诊、用药、监测记录进行筛选</li>
                <li><strong>最新生命体征</strong>：显示最新的血压、心率、体温、血糖等数据</li>
                <li><strong>健康趋势分析</strong>：健康状况、照护等级、最近就诊时间</li>
                <li><strong>紧急联系人</strong>：显示紧急联系人信息</li>
                <li><strong>添加/编辑记录</strong>：支持添加新的健康记录和编辑现有记录</li>
                <li><strong>记录详情查看</strong>：查看完整的健康记录详细信息</li>
                <li><strong>导出功能</strong>：支持导出健康档案数据</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h3>4. 测试添加健康记录</h3>
        <p>测试添加健康记录的API:</p>
        <button onclick="testAddHealthRecord(1)">为老人ID:1添加测试记录</button>
        <button onclick="testAddHealthRecord(2)">为老人ID:2添加测试记录</button>
        <div id="addResult" class="result">等待测试...</div>
    </div>

    <script>
        async function testHealthRecordsAPI(elderlyId) {
            try {
                document.getElementById('apiResult').innerHTML = '正在测试...';
                
                const response = await fetch(`/api/elderly/${elderlyId}/health-records`);
                const result = await response.json();
                
                let output = `<div class="success">✅ API调用成功</div>`;
                output += `<strong>老人ID:</strong> ${elderlyId}\n`;
                output += `<strong>响应状态:</strong> ${response.status}\n`;
                output += `<strong>响应数据:</strong>\n${JSON.stringify(result, null, 2)}`;
                
                document.getElementById('apiResult').innerHTML = output;
            } catch (error) {
                document.getElementById('apiResult').innerHTML = `<div class="error">❌ API调用失败</div>\n错误信息: ${error.message}`;
            }
        }

        async function testAddHealthRecord(elderlyId) {
            try {
                document.getElementById('addResult').innerHTML = '正在测试添加记录...';
                
                const testRecord = {
                    recordType: 4,  // 监测记录
                    recordDate: new Date().toISOString().slice(0, 19),
                    title: '日常监测',
                    bloodPressureHigh: 120,
                    bloodPressureLow: 80,
                    heartRate: 72,
                    temperature: 36.5,
                    bloodSugar: 5.5,
                    description: '日常健康监测，各项指标正常',
                    riskLevel: 0,
                    isAbnormal: false
                };
                
                const response = await fetch(`/api/elderly/${elderlyId}/health-records`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testRecord)
                });
                
                const result = await response.json();
                
                let output = '';
                if (response.ok) {
                    output = `<div class="success">✅ 添加记录成功</div>`;
                } else {
                    output = `<div class="error">❌ 添加记录失败</div>`;
                }
                
                output += `<strong>老人ID:</strong> ${elderlyId}\n`;
                output += `<strong>响应状态:</strong> ${response.status}\n`;
                output += `<strong>响应数据:</strong>\n${JSON.stringify(result, null, 2)}`;
                
                document.getElementById('addResult').innerHTML = output;
            } catch (error) {
                document.getElementById('addResult').innerHTML = `<div class="error">❌ 添加记录失败</div>\n错误信息: ${error.message}`;
            }
        }

        // 页面加载完成后显示说明
        window.addEventListener('DOMContentLoaded', function() {
            console.log('健康档案功能测试页面已加载');
        });
    </script>
</body>
</html>
