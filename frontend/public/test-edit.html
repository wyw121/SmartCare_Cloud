<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>编辑功能测试</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        .result { 
            background: #f5f5f5; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px; 
        }
        button { 
            background: #409eff; 
            color: white; 
            border: none; 
            padding: 8px 16px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px; 
        }
        button:hover { 
            background: #66b1ff; 
        }
        .error { 
            color: red; 
        }
        .success { 
            color: green; 
        }
    </style>
</head>
<body>
    <h1>老人档案编辑功能测试</h1>
    
    <h2>测试获取老人信息</h2>
    <button onclick="getElderlyInfo(1)">获取ID为1的老人信息</button>
    <button onclick="getElderlyInfo(2)">获取ID为2的老人信息</button>
    <div id="getResult" class="result"></div>
    
    <h2>测试更新老人信息</h2>
    <button onclick="updateElderlyInfo()">更新老人信息测试</button>
    <div id="updateResult" class="result"></div>

    <script>
        const API_BASE = '/api';
        
        async function request(url, options = {}) {
            try {
                const response = await fetch(API_BASE + url, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('API调用失败:', error);
                throw error;
            }
        }
        
        async function getElderlyInfo(id) {
            const resultDiv = document.getElementById('getResult');
            resultDiv.innerHTML = '正在获取数据...';
            
            try {
                const result = await request(`/elderly/${id}`);
                if (result.success) {
                    resultDiv.innerHTML = `
                        <div class="success">✓ 获取成功</div>
                        <pre>${JSON.stringify(result.data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">✗ 获取失败: ${result.message}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">✗ 网络错误: ${error.message}</div>`;
            }
        }
        
        async function updateElderlyInfo() {
            const resultDiv = document.getElementById('updateResult');
            resultDiv.innerHTML = '正在更新数据...';
            
            // 先获取现有数据
            try {
                const getResult = await request('/elderly/1');
                if (!getResult.success) {
                    resultDiv.innerHTML = `<div class="error">✗ 无法获取现有数据: ${getResult.message}</div>`;
                    return;
                }
                
                // 修改一些字段进行测试
                const updateData = {
                    ...getResult.data,
                    phone: '13900139999', // 修改电话号码
                    address: '测试地址修改 - ' + new Date().toLocaleTimeString(), // 修改地址
                    remarks: '这是通过编辑功能测试页面更新的备注 - ' + new Date().toLocaleString()
                };
                
                const updateResult = await request('/elderly', {
                    method: 'PUT',
                    body: JSON.stringify(updateData)
                });
                
                if (updateResult.success) {
                    resultDiv.innerHTML = `
                        <div class="success">✓ 更新成功</div>
                        <p>更新的数据:</p>
                        <pre>${JSON.stringify(updateData, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">✗ 更新失败: ${updateResult.message}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">✗ 更新错误: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
