<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>老人档案编辑功能全面测试</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .result {
            background-color: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            white-space: pre-wrap;
        }
        .gender-highlight {
            font-weight: bold;
            color: #d63384;
            background-color: #fff3cd;
            padding: 2px 6px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div id="app">
        <h1>老人档案编辑功能全面测试</h1>
        
        <div class="test-section">
            <h3>1. 后端API数据测试</h3>
            <p>测试后端API是否正确返回性别数据：</p>
            <el-button @click="testAPI(1)" type="primary">测试男性用户(ID:1)</el-button>
            <el-button @click="testAPI(2)" type="success">测试女性用户(ID:2)</el-button>
            <el-button @click="testAPI(3)" type="success">测试女性用户(ID:3)</el-button>
            <el-button @click="testAPI(6)" type="success">测试女性用户(ID:6)</el-button>
            <div class="result">{{ apiResult }}</div>
        </div>

        <div class="test-section">
            <h3>2. 性别选择组件测试</h3>
            <p>模拟前端表单的性别选择组件：</p>
            
            <el-form :model="testForm" label-width="100px">
                <el-form-item label="姓名:">
                    <el-input v-model="testForm.name" style="width: 200px;"></el-input>
                </el-form-item>
                <el-form-item label="性别:">
                    <el-radio-group v-model="testForm.gender">
                        <el-radio :label="1">男</el-radio>
                        <el-radio :label="0">女</el-radio>
                    </el-radio-group>
                </el-form-item>
            </el-form>
            
            <div style="margin: 15px 0;">
                <el-button @click="setGender(1)" type="primary">设置为男性</el-button>
                <el-button @click="setGender(0)" type="danger">设置为女性</el-button>
                <el-button @click="loadUserData(2)" type="success">加载女性用户数据</el-button>
                <el-button @click="loadUserData(1)" type="info">加载男性用户数据</el-button>
            </div>
            
            <div class="result">
当前表单数据:
姓名: {{ testForm.name }}
性别: <span class="gender-highlight">{{ testForm.gender }} ({{ testForm.gender === 0 ? '女' : testForm.gender === 1 ? '男' : '未知' }})</span>
            </div>
        </div>

        <div class="test-section">
            <h3>3. 数据回显测试</h3>
            <p>模拟编辑页面的数据回显过程：</p>
            <el-button @click="simulateEdit(1)" type="primary">模拟编辑男性用户</el-button>
            <el-button @click="simulateEdit(2)" type="danger">模拟编辑女性用户</el-button>
            <div class="result">{{ editResult }}</div>
        </div>

        <div class="test-section">
            <h3>4. 真实编辑页面链接</h3>
            <p>点击以下链接进入真实的编辑页面：</p>
            <el-button @click="openEditPage(1)" type="primary">编辑男性用户(ID:1)</el-button>
            <el-button @click="openEditPage(2)" type="danger">编辑女性用户(ID:2)</el-button>
            <el-button @click="openEditPage(3)" type="danger">编辑女性用户(ID:3)</el-button>
            <el-button @click="openEditPage(6)" type="danger">编辑女性用户(ID:6)</el-button>
        </div>
    </div>

    <script>
        const { createApp, reactive, ref } = Vue;
        const { ElButton, ElForm, ElFormItem, ElInput, ElRadio, ElRadioGroup } = ElementPlus;

        createApp({
            components: {
                ElButton,
                ElForm,
                ElFormItem,
                ElInput,
                ElRadio,
                ElRadioGroup
            },
            setup() {
                const apiResult = ref('等待测试...');
                const editResult = ref('等待测试...');
                
                const testForm = reactive({
                    name: '',
                    gender: 1
                });

                const testAPI = async (id) => {
                    try {
                        const response = await fetch(`/api/elderly/${id}`);
                        const result = await response.json();
                        
                        if (result.success) {
                            const data = result.data;
                            const genderText = data.gender === 0 ? '女性' : '男性';
                            apiResult.value = `用户ID: ${id}
姓名: ${data.name}
性别: ${data.gender} (${genderText})
身份证: ${data.idCard}
电话: ${data.phone}
地址: ${data.address}

完整数据:
${JSON.stringify(data, null, 2)}`;
                        } else {
                            apiResult.value = `获取数据失败: ${result.message}`;
                        }
                    } catch (error) {
                        apiResult.value = `请求失败: ${error.message}`;
                    }
                };

                const setGender = (value) => {
                    testForm.gender = value;
                };

                const loadUserData = async (id) => {
                    try {
                        const response = await fetch(`/api/elderly/${id}`);
                        const result = await response.json();
                        
                        if (result.success) {
                            const data = result.data;
                            // 模拟前端数据回显逻辑
                            testForm.name = data.name || '';
                            testForm.gender = data.gender !== undefined ? data.gender : 1;
                        }
                    } catch (error) {
                        console.error('加载用户数据失败:', error);
                    }
                };

                const simulateEdit = async (id) => {
                    try {
                        editResult.value = '正在加载数据...';
                        
                        const response = await fetch(`/api/elderly/${id}`);
                        const result = await response.json();
                        
                        if (result.success) {
                            const data = result.data;
                            
                            // 模拟前端编辑页面的数据处理逻辑
                            const form = {
                                name: data.name || '',
                                gender: data.gender !== undefined ? data.gender : 1,
                                idCard: data.idCard || '',
                                phone: data.phone || '',
                                address: data.address || ''
                            };
                            
                            const genderText = form.gender === 0 ? '女性' : '男性';
                            editResult.value = `模拟编辑用户ID: ${id}

原始数据:
- gender: ${data.gender}

处理后的表单数据:
- name: ${form.name}
- gender: ${form.gender} (${genderText})
- idCard: ${form.idCard}
- phone: ${form.phone}
- address: ${form.address}

性别回显检查:
- 后端返回的gender: ${data.gender}
- 表单中的gender: ${form.gender}
- 显示文本: ${genderText}
- 回显是否正确: ${data.gender === form.gender ? '✅ 正确' : '❌ 错误'}`;
                        } else {
                            editResult.value = `获取数据失败: ${result.message}`;
                        }
                    } catch (error) {
                        editResult.value = `请求失败: ${error.message}`;
                    }
                };

                const openEditPage = (id) => {
                    window.open(`/elderly/edit/${id}`, '_blank');
                };

                return {
                    apiResult,
                    editResult,
                    testForm,
                    testAPI,
                    setGender,
                    loadUserData,
                    simulateEdit,
                    openEditPage
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
