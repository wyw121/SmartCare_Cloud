<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>照护统计测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        .test-section h3 {
            color: #409eff;
            margin-top: 0;
        }
        .btn {
            background-color: #409eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .btn:hover {
            background-color: #66b1ff;
        }
        .result {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            border-color: #67c23a;
            background-color: #f0f9ff;
        }
        .error {
            border-color: #f56c6c;
            background-color: #fef0f0;
            color: #f56c6c;
        }
        .loading {
            color: #909399;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="header">🏥 智慧医养平台 - 照护统计功能测试</h1>
        
        <div class="test-section">
            <h3>📊 照护统计API测试</h3>
            <p>测试后端照护统计接口，验证数据统计功能</p>
            <button class="btn" onclick="testCareStatistics()">测试照护统计API</button>
            <button class="btn" onclick="testHealthStatistics()">测试健康统计API</button>
            <button class="btn" onclick="testElderlyList()">测试老人列表API</button>
            <div id="apiResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>🔗 前端页面链接</h3>
            <p>直接访问相关页面进行功能测试</p>
            <button class="btn" onclick="openElderlyList()">打开老人管理页面</button>
            <button class="btn" onclick="openDashboard()">打开仪表盘页面</button>
            <div id="linkResult" class="result" style="display: none;">
                页面链接已在新标签页中打开，请查看相关功能是否正常。
            </div>
        </div>

        <div class="test-section">
            <h3>📝 功能验证清单</h3>
            <div id="checklistResult" class="result">
照护统计功能验证清单：

✅ 后端功能验证：
  □ 照护等级分布统计（自理、半自理、不能自理）
  □ 年龄段照护需求分析（60-70岁、70-80岁、80-90岁、90岁以上）
  □ 照护服务统计（服务次数、完成率、平均时长）
  □ 照护质量评估（评分、满意度、趋势分析）
  □ 费用统计分析（总费用、人均费用、费用趋势）
  □ 护理人员工作量统计（负责人数、服务次数、评分）
  □ 总体汇总信息（各类统计汇总数据）

✅ 前端功能验证：
  □ 照护统计按钮能正常打开对话框
  □ 照护等级分布饼图正确显示
  □ 年龄段照护需求柱状图正确显示
  □ 服务质量趋势线图正确显示
  □ 费用趋势分析图正确显示
  □ 护理人员工作量表格正确显示
  □ 服务统计详情正确显示
  □ 图表数据刷新功能正常
  □ 导出报告功能正常

✅ 数据准确性验证：
  □ 统计数据与数据库实际数据一致
  □ 百分比计算正确
  □ 趋势数据合理
  □ 图表颜色区分明显
  □ 标签显示清晰

使用说明：
1. 点击"测试照护统计API"按钮，验证后端接口返回数据
2. 点击"打开老人管理页面"，在老人列表页面点击"照护统计"按钮
3. 检查照护统计对话框中的各个图表和数据是否正确显示
4. 验证数据是否与数据库中的实际照护相关数据匹配
            </div>
        </div>
    </div>

    <script>
        // 基础配置
        const API_BASE = 'http://localhost:8080/api';
        const FRONTEND_BASE = 'http://localhost:3000';

        // 显示结果
        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${type}`;
            element.textContent = content;
        }

        // 测试照护统计API
        async function testCareStatistics() {
            showResult('apiResult', '正在测试照护统计API...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/elderly/care-level-statistics`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                let resultText = '✅ 照护统计API测试成功！\n\n';
                resultText += JSON.stringify(data, null, 2);
                
                // 验证数据结构
                if (data.code === 200 && data.data) {
                    resultText += '\n\n📊 数据结构验证：\n';
                    const stats = data.data;
                    resultText += `- 照护等级分布: ${stats.careLevelDistribution ? '✅' : '❌'}\n`;
                    resultText += `- 年龄段照护需求: ${stats.ageCareNeeds ? '✅' : '❌'}\n`;
                    resultText += `- 照护服务统计: ${stats.careServiceStats ? '✅' : '❌'}\n`;
                    resultText += `- 照护质量统计: ${stats.careQualityStats ? '✅' : '❌'}\n`;
                    resultText += `- 费用统计: ${stats.careCostStats ? '✅' : '❌'}\n`;
                    resultText += `- 护理人员工作量: ${stats.caregiverWorkloads ? '✅' : '❌'}\n`;
                    resultText += `- 汇总信息: ${stats.summary ? '✅' : '❌'}\n`;
                }
                
                showResult('apiResult', resultText, 'success');
            } catch (error) {
                showResult('apiResult', `❌ 照护统计API测试失败：\n${error.message}`, 'error');
            }
        }

        // 测试健康统计API
        async function testHealthStatistics() {
            showResult('apiResult', '正在测试健康统计API...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/elderly/health-statistics`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                let resultText = '✅ 健康统计API测试成功！\n\n';
                resultText += JSON.stringify(data, null, 2);
                
                showResult('apiResult', resultText, 'success');
            } catch (error) {
                showResult('apiResult', `❌ 健康统计API测试失败：\n${error.message}`, 'error');
            }
        }

        // 测试老人列表API
        async function testElderlyList() {
            showResult('apiResult', '正在测试老人列表API...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/elderly/page?pageNum=1&pageSize=10`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                let resultText = '✅ 老人列表API测试成功！\n\n';
                resultText += `总记录数: ${data.data?.total || 0}\n`;
                resultText += `当前页记录数: ${data.data?.records?.length || 0}\n\n`;
                
                if (data.data?.records?.length > 0) {
                    resultText += '前5条记录的照护等级分布：\n';
                    data.data.records.slice(0, 5).forEach((elderly, index) => {
                        const careLevel = elderly.careLevel || 1;
                        const careLevelName = careLevel === 1 ? '自理' : careLevel === 2 ? '半自理' : '不能自理';
                        resultText += `${index + 1}. ${elderly.name} - ${careLevelName}\n`;
                    });
                }
                
                showResult('apiResult', resultText, 'success');
            } catch (error) {
                showResult('apiResult', `❌ 老人列表API测试失败：\n${error.message}`, 'error');
            }
        }

        // 打开老人管理页面
        function openElderlyList() {
            window.open(`${FRONTEND_BASE}/elderly/list`, '_blank');
            showResult('linkResult', '老人管理页面已在新标签页中打开，请在该页面点击"照护统计"按钮测试功能。', 'success');
        }

        // 打开仪表盘页面
        function openDashboard() {
            window.open(`${FRONTEND_BASE}/dashboard`, '_blank');
            showResult('linkResult', '仪表盘页面已在新标签页中打开。', 'success');
        }

        // 页面加载完成后自动测试API连通性
        window.onload = function() {
            setTimeout(() => {
                console.log('页面加载完成，自动测试API连通性...');
            }, 1000);
        };
    </script>
</body>
</html>
