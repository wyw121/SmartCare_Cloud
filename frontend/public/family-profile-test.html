<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶å±ä¸ªäººä¸­å¿ƒæµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        .btn {
            background: #409EFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px;
            font-size: 14px;
        }
        .btn:hover {
            background: #337ecc;
        }
        .btn.success {
            background: #67C23A;
        }
        .btn.warning {
            background: #E6A23C;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        .status.info {
            background: #e1f3ff;
            border: 1px solid #b3d8ff;
        }
        .status.error {
            background: #fef0f0;
            border: 1px solid #fbc4c4;
        }
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>ğŸ¥ å®¶å±ä¸ªäººä¸­å¿ƒæµ‹è¯•é¡µé¢</h1>
        <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•å®¶å±è§’è‰²çš„ä¸ªäººä¸­å¿ƒåŠŸèƒ½</p>
    </div>

    <div class="card">
        <h2>ğŸ”„ è§’è‰²åˆ‡æ¢</h2>
        <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®åˆ‡æ¢åˆ°ä¸åŒçš„ç”¨æˆ·è§’è‰²ï¼š</p>
        <button class="btn" onclick="switchToFamily()">åˆ‡æ¢åˆ°å®¶å±è§’è‰²</button>
        <button class="btn warning" onclick="switchToDoctor()">åˆ‡æ¢åˆ°åŒ»ç”Ÿè§’è‰²</button>
        <button class="btn success" onclick="switchToAdmin()">åˆ‡æ¢åˆ°ç®¡ç†å‘˜è§’è‰²</button>
        
        <div id="switchStatus" class="status info" style="display: none;"></div>
    </div>

    <div class="card">
        <h2>ğŸ” å½“å‰çŠ¶æ€æ£€æŸ¥</h2>
        <button class="btn" onclick="checkCurrentState()">æ£€æŸ¥å½“å‰ç™»å½•çŠ¶æ€</button>
        <button class="btn" onclick="openProfilePage()">æ‰“å¼€ä¸ªäººä¸­å¿ƒé¡µé¢</button>
        
        <div id="stateInfo" class="debug-info" style="display: none;"></div>
    </div>

    <div class="card">
        <h2>ğŸš€ å¿«é€Ÿæµ‹è¯•</h2>
        <p>ä¸€é”®æµ‹è¯•å®¶å±ä¸ªäººä¸­å¿ƒåŠŸèƒ½ï¼š</p>
        <button class="btn success" onclick="quickTestFamily()">å¿«é€Ÿæµ‹è¯•å®¶å±ä¸ªäººä¸­å¿ƒ</button>
        
        <div id="testResult" class="status info" style="display: none;"></div>
    </div>

    <script>
        // åˆ‡æ¢åˆ°å®¶å±è§’è‰²
        function switchToFamily() {
            console.log('åˆ‡æ¢åˆ°å®¶å±è§’è‰²...')
            
            const familyData = {
                id: 3,
                username: 'family',
                password: '123456',
                name: 'æå®¶å±',
                role: 'family',
                roleText: 'å®¶å±',
                permissions: [
                    'dashboard:view',
                    'elderly:view',
                    'health:view',
                    'health-warning:view',
                    'report:view'
                ],
                avatar: '',
                relationship: 'å„¿å­',
                elderlyIds: [1, 2],
                phone: '13800138002',
                email: 'family@smartcare.com',
                description: 'å®¶å±ç”¨æˆ·ï¼Œå¯æŸ¥çœ‹å…³è”è€äººçš„å¥åº·ä¿¡æ¯å’Œé¢„è­¦',
                features: {
                    elderly: ['view'],
                    health: ['view'],
                    report: ['view']
                }
            }
            
            const token = `dev_switch_token_family_${Date.now()}`
            
            // å­˜å‚¨åˆ°localStorage
            localStorage.setItem('token', token)
            localStorage.setItem('userInfo', JSON.stringify(familyData))
            
            showStatus('switchStatus', `å·²åˆ‡æ¢åˆ°å®¶å±è§’è‰²: ${familyData.name}`, 'info')
            
            console.log('å®¶å±è§’è‰²åˆ‡æ¢å®Œæˆ:', familyData)
        }

        // åˆ‡æ¢åˆ°åŒ»ç”Ÿè§’è‰²
        function switchToDoctor() {
            console.log('åˆ‡æ¢åˆ°åŒ»ç”Ÿè§’è‰²...')
            
            const doctorData = {
                id: 2,
                username: 'doctor',
                password: '123456',
                name: 'å¼ åŒ»ç”Ÿ',
                role: 'doctor',
                roleText: 'åŒ»ç”Ÿ',
                permissions: [
                    'dashboard:view',
                    'elderly:view', 'elderly:add', 'elderly:edit', 'elderly:export',
                    'health:view', 'health:add', 'health:edit', 'health:manage',
                    'health-warning:view', 'health-warning:handle', 'health-warning:export',
                    'assessment:view', 'assessment:add', 'assessment:edit', 'assessment:export',
                    'equipment:view', 'equipment:monitor',
                    'report:view', 'report:export',
                    'analysis:view'
                ],
                avatar: '',
                department: 'å†…ç§‘',
                title: 'ä¸»æ²»åŒ»å¸ˆ',
                phone: '13800138001',
                email: 'doctor@smartcare.com',
                description: 'è´Ÿè´£è€äººåŒ»ç–—å¥åº·ç®¡ç†ï¼Œå¤„ç†å¥åº·é¢„è­¦å’Œè¯„ä¼°'
            }
            
            const token = `dev_switch_token_doctor_${Date.now()}`
            
            localStorage.setItem('token', token)
            localStorage.setItem('userInfo', JSON.stringify(doctorData))
            
            showStatus('switchStatus', `å·²åˆ‡æ¢åˆ°åŒ»ç”Ÿè§’è‰²: ${doctorData.name}`, 'info')
        }

        // åˆ‡æ¢åˆ°ç®¡ç†å‘˜è§’è‰²
        function switchToAdmin() {
            console.log('åˆ‡æ¢åˆ°ç®¡ç†å‘˜è§’è‰²...')
            
            const adminData = {
                id: 1,
                username: 'admin',
                password: '123456',
                name: 'ç³»ç»Ÿç®¡ç†å‘˜',
                role: 'admin',
                roleText: 'ç³»ç»Ÿç®¡ç†å‘˜',
                permissions: ['*'],
                avatar: '',
                department: 'ç³»ç»Ÿç®¡ç†éƒ¨',
                phone: '13800138000',
                email: 'admin@smartcare.com',
                description: 'æ‹¥æœ‰ç³»ç»Ÿå…¨éƒ¨ç®¡ç†æƒé™ï¼Œè´Ÿè´£å¹³å°æ•´ä½“è¿è¥ç®¡ç†'
            }
            
            const token = `dev_switch_token_admin_${Date.now()}`
            
            localStorage.setItem('token', token)
            localStorage.setItem('userInfo', JSON.stringify(adminData))
            
            showStatus('switchStatus', `å·²åˆ‡æ¢åˆ°ç®¡ç†å‘˜è§’è‰²: ${adminData.name}`, 'info')
        }

        // æ£€æŸ¥å½“å‰çŠ¶æ€
        function checkCurrentState() {
            const token = localStorage.getItem('token')
            const userInfo = localStorage.getItem('userInfo')
            
            let info = '=== å½“å‰ç™»å½•çŠ¶æ€ ===\n'
            info += `Token: ${token || 'æ— '}\n`
            
            if (userInfo) {
                try {
                    const user = JSON.parse(userInfo)
                    info += `ç”¨æˆ·ID: ${user.id}\n`
                    info += `ç”¨æˆ·å: ${user.username}\n`
                    info += `å§“å: ${user.name}\n`
                    info += `è§’è‰²: ${user.role} (${user.roleText})\n`
                    info += `æƒé™: ${user.permissions ? user.permissions.join(', ') : 'æ— '}\n`
                    
                    if (user.role === 'family') {
                        info += `å…³ç³»: ${user.relationship || 'æœªè®¾ç½®'}\n`
                        info += `å…³è”é•¿è¾ˆ: ${user.elderlyIds ? user.elderlyIds.join(', ') : 'æ— '}\n`
                    }
                } catch (e) {
                    info += `ç”¨æˆ·ä¿¡æ¯è§£æé”™è¯¯: ${e.message}\n`
                }
            } else {
                info += 'ç”¨æˆ·ä¿¡æ¯: æ— \n'
            }
            
            info += '====================='
            
            document.getElementById('stateInfo').textContent = info
            document.getElementById('stateInfo').style.display = 'block'
        }

        // æ‰“å¼€ä¸ªäººä¸­å¿ƒé¡µé¢
        function openProfilePage() {
            window.open('http://localhost:3000/profile/index', '_blank')
        }

        // å¿«é€Ÿæµ‹è¯•å®¶å±ä¸ªäººä¸­å¿ƒ
        function quickTestFamily() {
            console.log('å¼€å§‹å¿«é€Ÿæµ‹è¯•å®¶å±ä¸ªäººä¸­å¿ƒ...')
            
            // 1. åˆ‡æ¢åˆ°å®¶å±è§’è‰²
            switchToFamily()
            
            // 2. ç­‰å¾…ä¸€ä¸‹å†æ‰“å¼€é¡µé¢
            setTimeout(() => {
                openProfilePage()
                showStatus('testResult', 'å·²åˆ‡æ¢åˆ°å®¶å±è§’è‰²å¹¶æ‰“å¼€ä¸ªäººä¸­å¿ƒé¡µé¢ï¼Œè¯·æ£€æŸ¥é¡µé¢æ˜¯å¦æ­£å¸¸æ˜¾ç¤º', 'info')
            }, 500)
        }

        // æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId)
            element.textContent = message
            element.className = `status ${type}`
            element.style.display = 'block'
            
            // 3ç§’åéšè—
            setTimeout(() => {
                element.style.display = 'none'
            }, 3000)
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥å½“å‰çŠ¶æ€
        window.onload = function() {
            checkCurrentState()
        }
    </script>
</body>
</html>
