<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>家属个人中心测试页面</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        .btn {
            background: #409EFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px;
            font-size: 14px;
        }
        .btn:hover {
            background: #337ecc;
        }
        .btn.success {
            background: #67C23A;
        }
        .btn.warning {
            background: #E6A23C;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        .status.info {
            background: #e1f3ff;
            border: 1px solid #b3d8ff;
        }
        .status.error {
            background: #fef0f0;
            border: 1px solid #fbc4c4;
        }
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>🏥 家属个人中心测试页面</h1>
        <p>此页面用于测试家属角色的个人中心功能</p>
    </div>

    <div class="card">
        <h2>🔄 角色切换</h2>
        <p>点击下面的按钮切换到不同的用户角色：</p>
        <button class="btn" onclick="switchToFamily()">切换到家属角色</button>
        <button class="btn warning" onclick="switchToDoctor()">切换到医生角色</button>
        <button class="btn success" onclick="switchToAdmin()">切换到管理员角色</button>
        
        <div id="switchStatus" class="status info" style="display: none;"></div>
    </div>

    <div class="card">
        <h2>🔍 当前状态检查</h2>
        <button class="btn" onclick="checkCurrentState()">检查当前登录状态</button>
        <button class="btn" onclick="openProfilePage()">打开个人中心页面</button>
        
        <div id="stateInfo" class="debug-info" style="display: none;"></div>
    </div>

    <div class="card">
        <h2>🚀 快速测试</h2>
        <p>一键测试家属个人中心功能：</p>
        <button class="btn success" onclick="quickTestFamily()">快速测试家属个人中心</button>
        
        <div id="testResult" class="status info" style="display: none;"></div>
    </div>

    <script>
        // 切换到家属角色
        function switchToFamily() {
            console.log('切换到家属角色...')
            
            const familyData = {
                id: 3,
                username: 'family',
                password: '123456',
                name: '李家属',
                role: 'family',
                roleText: '家属',
                permissions: [
                    'dashboard:view',
                    'elderly:view',
                    'health:view',
                    'health-warning:view',
                    'report:view'
                ],
                avatar: '',
                relationship: '儿子',
                elderlyIds: [1, 2],
                phone: '13800138002',
                email: 'family@smartcare.com',
                description: '家属用户，可查看关联老人的健康信息和预警',
                features: {
                    elderly: ['view'],
                    health: ['view'],
                    report: ['view']
                }
            }
            
            const token = `dev_switch_token_family_${Date.now()}`
            
            // 存储到localStorage
            localStorage.setItem('token', token)
            localStorage.setItem('userInfo', JSON.stringify(familyData))
            
            showStatus('switchStatus', `已切换到家属角色: ${familyData.name}`, 'info')
            
            console.log('家属角色切换完成:', familyData)
        }

        // 切换到医生角色
        function switchToDoctor() {
            console.log('切换到医生角色...')
            
            const doctorData = {
                id: 2,
                username: 'doctor',
                password: '123456',
                name: '张医生',
                role: 'doctor',
                roleText: '医生',
                permissions: [
                    'dashboard:view',
                    'elderly:view', 'elderly:add', 'elderly:edit', 'elderly:export',
                    'health:view', 'health:add', 'health:edit', 'health:manage',
                    'health-warning:view', 'health-warning:handle', 'health-warning:export',
                    'assessment:view', 'assessment:add', 'assessment:edit', 'assessment:export',
                    'equipment:view', 'equipment:monitor',
                    'report:view', 'report:export',
                    'analysis:view'
                ],
                avatar: '',
                department: '内科',
                title: '主治医师',
                phone: '13800138001',
                email: 'doctor@smartcare.com',
                description: '负责老人医疗健康管理，处理健康预警和评估'
            }
            
            const token = `dev_switch_token_doctor_${Date.now()}`
            
            localStorage.setItem('token', token)
            localStorage.setItem('userInfo', JSON.stringify(doctorData))
            
            showStatus('switchStatus', `已切换到医生角色: ${doctorData.name}`, 'info')
        }

        // 切换到管理员角色
        function switchToAdmin() {
            console.log('切换到管理员角色...')
            
            const adminData = {
                id: 1,
                username: 'admin',
                password: '123456',
                name: '系统管理员',
                role: 'admin',
                roleText: '系统管理员',
                permissions: ['*'],
                avatar: '',
                department: '系统管理部',
                phone: '13800138000',
                email: 'admin@smartcare.com',
                description: '拥有系统全部管理权限，负责平台整体运营管理'
            }
            
            const token = `dev_switch_token_admin_${Date.now()}`
            
            localStorage.setItem('token', token)
            localStorage.setItem('userInfo', JSON.stringify(adminData))
            
            showStatus('switchStatus', `已切换到管理员角色: ${adminData.name}`, 'info')
        }

        // 检查当前状态
        function checkCurrentState() {
            const token = localStorage.getItem('token')
            const userInfo = localStorage.getItem('userInfo')
            
            let info = '=== 当前登录状态 ===\n'
            info += `Token: ${token || '无'}\n`
            
            if (userInfo) {
                try {
                    const user = JSON.parse(userInfo)
                    info += `用户ID: ${user.id}\n`
                    info += `用户名: ${user.username}\n`
                    info += `姓名: ${user.name}\n`
                    info += `角色: ${user.role} (${user.roleText})\n`
                    info += `权限: ${user.permissions ? user.permissions.join(', ') : '无'}\n`
                    
                    if (user.role === 'family') {
                        info += `关系: ${user.relationship || '未设置'}\n`
                        info += `关联长辈: ${user.elderlyIds ? user.elderlyIds.join(', ') : '无'}\n`
                    }
                } catch (e) {
                    info += `用户信息解析错误: ${e.message}\n`
                }
            } else {
                info += '用户信息: 无\n'
            }
            
            info += '====================='
            
            document.getElementById('stateInfo').textContent = info
            document.getElementById('stateInfo').style.display = 'block'
        }

        // 打开个人中心页面
        function openProfilePage() {
            window.open('http://localhost:3000/profile/index', '_blank')
        }

        // 快速测试家属个人中心
        function quickTestFamily() {
            console.log('开始快速测试家属个人中心...')
            
            // 1. 切换到家属角色
            switchToFamily()
            
            // 2. 等待一下再打开页面
            setTimeout(() => {
                openProfilePage()
                showStatus('testResult', '已切换到家属角色并打开个人中心页面，请检查页面是否正常显示', 'info')
            }, 500)
        }

        // 显示状态信息
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId)
            element.textContent = message
            element.className = `status ${type}`
            element.style.display = 'block'
            
            // 3秒后隐藏
            setTimeout(() => {
                element.style.display = 'none'
            }, 3000)
        }

        // 页面加载时检查当前状态
        window.onload = function() {
            checkCurrentState()
        }
    </script>
</body>
</html>
