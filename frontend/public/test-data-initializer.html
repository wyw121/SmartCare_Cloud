<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•æ•°æ®åˆå§‹åŒ–</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #409eff;
            text-align: center;
        }
        button {
            background: #409eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #66b1ff;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #409eff;
            border-radius: 4px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            border-left-color: #67c23a;
            background: #f0f9ff;
            color: #67c23a;
        }
        .error {
            border-left-color: #f56c6c;
            background: #fef0f0;
            color: #f56c6c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¥ æ™ºæ…§åŒ»å…»å¹³å° - æµ‹è¯•æ•°æ®åˆå§‹åŒ–</h1>
        
        <button onclick="initializeTestData()">åˆå§‹åŒ–å¤šæ ·åŒ–æµ‹è¯•æ•°æ®</button>
        <button onclick="verifyData()">éªŒè¯æ•°æ®</button>
        <button onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
        
        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080';
        
        // æµ‹è¯•æ•°æ®
        const testElderlyData = [
            // 60-70å²å¹´é¾„æ®µ
            {
                name: 'å¼ ä¸‰',
                gender: 'ç”·',
                birthDate: '1955-03-15',
                phone: '13800138001',
                address: 'åŒ—äº¬å¸‚æœé˜³åŒº',
                healthStatus: 'NORMAL',
                careLevel: 1,
                emergencyContact: 'å¼ å°æ˜',
                emergencyPhone: '13900139001'
            },
            {
                name: 'æå››',
                gender: 'å¥³',
                birthDate: '1958-07-20',
                phone: '13800138002',
                address: 'åŒ—äº¬å¸‚æµ·æ·€åŒº',
                healthStatus: 'ATTENTION',
                careLevel: 1,
                emergencyContact: 'æå°çº¢',
                emergencyPhone: '13900139002'
            },
            {
                name: 'ç‹äº”',
                gender: 'ç”·',
                birthDate: '1960-12-05',
                phone: '13800138003',
                address: 'åŒ—äº¬å¸‚è¥¿åŸåŒº',
                healthStatus: 'WARNING',
                careLevel: 2,
                emergencyContact: 'ç‹å°å†›',
                emergencyPhone: '13900139003'
            },
            {
                name: 'èµµå…­',
                gender: 'å¥³',
                birthDate: '1962-04-18',
                phone: '13800138004',
                address: 'åŒ—äº¬å¸‚ä¸œåŸåŒº',
                healthStatus: 'å¥åº·',
                careLevel: 1,
                emergencyContact: 'èµµå°å',
                emergencyPhone: '13900139004'
            },
            {
                name: 'å­™ä¸ƒ',
                gender: 'ç”·',
                birthDate: '1959-09-25',
                phone: '13800138005',
                address: 'åŒ—äº¬å¸‚ä¸°å°åŒº',
                healthStatus: 'äºšå¥åº·',
                careLevel: 1,
                emergencyContact: 'å­™å°åˆš',
                emergencyPhone: '13900139005'
            },
            {
                name: 'å‘¨å…«',
                gender: 'å¥³',
                birthDate: '1961-11-30',
                phone: '13800138006',
                address: 'åŒ—äº¬å¸‚çŸ³æ™¯å±±åŒº',
                healthStatus: 'æ…¢æ€§ç—…',
                careLevel: 2,
                emergencyContact: 'å‘¨å°ä¸½',
                emergencyPhone: '13900139006'
            },
            
            // 70-80å²å¹´é¾„æ®µ
            {
                name: 'é™ˆä¸€',
                gender: 'ç”·',
                birthDate: '1945-01-10',
                phone: '13800138009',
                address: 'åŒ—äº¬å¸‚é¡ºä¹‰åŒº',
                healthStatus: 'NORMAL',
                careLevel: 1,
                emergencyContact: 'é™ˆå°ä¼Ÿ',
                emergencyPhone: '13900139009'
            },
            {
                name: 'æ—äºŒ',
                gender: 'å¥³',
                birthDate: '1948-05-22',
                phone: '13800138010',
                address: 'åŒ—äº¬å¸‚æ˜Œå¹³åŒº',
                healthStatus: 'ATTENTION',
                careLevel: 2,
                emergencyContact: 'æ—å°èŠ³',
                emergencyPhone: '13900139010'
            },
            {
                name: 'é»„ä¸‰',
                gender: 'ç”·',
                birthDate: '1950-08-15',
                phone: '13800138011',
                address: 'åŒ—äº¬å¸‚å¤§å…´åŒº',
                healthStatus: 'WARNING',
                careLevel: 2,
                emergencyContact: 'é»„å°å‹‡',
                emergencyPhone: '13900139011'
            },
            {
                name: 'åˆ˜å››',
                gender: 'å¥³',
                birthDate: '1952-12-03',
                phone: '13800138012',
                address: 'åŒ—äº¬å¸‚é—¨å¤´æ²ŸåŒº',
                healthStatus: 'å¥åº·',
                careLevel: 1,
                emergencyContact: 'åˆ˜å°ç²',
                emergencyPhone: '13900139012'
            },
            {
                name: 'æ¨äº”',
                gender: 'ç”·',
                birthDate: '1946-03-28',
                phone: '13800138013',
                address: 'åŒ—äº¬å¸‚å¹³è°·åŒº',
                healthStatus: 'é«˜è¡€å‹',
                careLevel: 2,
                emergencyContact: 'æ¨å°å†›',
                emergencyPhone: '13900139013'
            },
            
            // 80-90å²å¹´é¾„æ®µ
            {
                name: 'æ¢ä¹',
                gender: 'ç”·',
                birthDate: '1935-02-28',
                phone: '13800138017',
                address: 'ä¸Šæµ·å¸‚é»„æµ¦åŒº',
                healthStatus: 'NORMAL',
                careLevel: 2,
                emergencyContact: 'æ¢å°å¼º',
                emergencyPhone: '13900139017'
            },
            {
                name: 'è”¡å',
                gender: 'å¥³',
                birthDate: '1938-06-14',
                phone: '13800138018',
                address: 'ä¸Šæµ·å¸‚å¾æ±‡åŒº',
                healthStatus: 'WARNING',
                careLevel: 3,
                emergencyContact: 'è”¡å°æ•',
                emergencyPhone: '13900139018'
            },
            {
                name: 'å®‹ä¸€',
                gender: 'ç”·',
                birthDate: '1940-09-08',
                phone: '13800138019',
                address: 'ä¸Šæµ·å¸‚é•¿å®åŒº',
                healthStatus: 'æ…¢æ€§ç—…',
                careLevel: 3,
                emergencyContact: 'å®‹å°åˆš',
                emergencyPhone: '13900139019'
            },
            
            // 90å²ä»¥ä¸Šå¹´é¾„æ®µ
            {
                name: 'æœ±ä¸ƒ',
                gender: 'ç”·',
                birthDate: '1925-07-12',
                phone: '13800138025',
                address: 'å¹¿å·å¸‚å¤©æ²³åŒº',
                healthStatus: 'äºšå¥åº·',
                careLevel: 3,
                emergencyContact: 'æœ±å°å†›',
                emergencyPhone: '13900139025'
            },
            {
                name: 'é©¬å…«',
                gender: 'å¥³',
                birthDate: '1928-10-30',
                phone: '13800138026',
                address: 'å¹¿å·å¸‚è¶Šç§€åŒº',
                healthStatus: 'WARNING',
                careLevel: 3,
                emergencyContact: 'é©¬å°ç²',
                emergencyPhone: '13900139026'
            }
        ];

        async function initializeTestData() {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'å¼€å§‹åˆå§‹åŒ–æµ‹è¯•æ•°æ®...\n\n';
            
            let successCount = 0;
            let errorCount = 0;
            
            for (let i = 0; i < testElderlyData.length; i++) {
                const elderly = testElderlyData[i];
                try {
                    const response = await fetch(`${API_BASE}/elderly`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(elderly)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        successCount++;
                        resultDiv.textContent += `âœ… ${elderly.name} (${elderly.healthStatus}) - æ·»åŠ æˆåŠŸ\n`;
                    } else {
                        errorCount++;
                        resultDiv.textContent += `âŒ ${elderly.name} - æ·»åŠ å¤±è´¥: ${result.message}\n`;
                    }
                } catch (error) {
                    errorCount++;
                    resultDiv.textContent += `âŒ ${elderly.name} - ç½‘ç»œé”™è¯¯: ${error.message}\n`;
                }
                
                // æ›´æ–°è¿›åº¦
                resultDiv.textContent += `è¿›åº¦: ${i + 1}/${testElderlyData.length}\n\n`;
                
                // æ»šåŠ¨åˆ°åº•éƒ¨
                resultDiv.scrollTop = resultDiv.scrollHeight;
                
                // ç¨ä½œå»¶è¿Ÿé¿å…è¯·æ±‚è¿‡å¿«
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            resultDiv.textContent += `\nğŸ“Š åˆå§‹åŒ–å®Œæˆï¼\n`;
            resultDiv.textContent += `âœ… æˆåŠŸ: ${successCount}æ¡\n`;
            resultDiv.textContent += `âŒ å¤±è´¥: ${errorCount}æ¡\n`;
            
            if (errorCount === 0) {
                resultDiv.className = 'result success';
            } else {
                resultDiv.className = 'result error';
            }
        }

        async function verifyData() {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'æ­£åœ¨éªŒè¯æ•°æ®...\n\n';
            
            try {
                // è·å–è€äººæ•°æ®
                const elderlyResponse = await fetch(`${API_BASE}/elderly/page`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        pageNum: 1,
                        pageSize: 100
                    })
                });
                
                const elderlyData = await elderlyResponse.json();
                
                if (!elderlyData.success) {
                    throw new Error('è·å–è€äººæ•°æ®å¤±è´¥');
                }
                
                // è·å–å¥åº·ç»Ÿè®¡
                const statsResponse = await fetch(`${API_BASE}/elderly/health-statistics`);
                const statsData = await statsResponse.json();
                
                if (!statsData.success) {
                    throw new Error('è·å–å¥åº·ç»Ÿè®¡å¤±è´¥');
                }
                
                let output = 'ğŸ“Š æ•°æ®éªŒè¯ç»“æœ:\n\n';
                output += `æ€»äººæ•°: ${elderlyData.data.total}\n`;
                output += `ç»Ÿè®¡æ€»æ•°: ${statsData.data.summary.totalCount}\n`;
                output += `æ•°æ®ä¸€è‡´æ€§: ${elderlyData.data.total === statsData.data.summary.totalCount ? 'âœ…' : 'âŒ'}\n\n`;
                
                // å¥åº·çŠ¶æ€åˆ†å¸ƒ
                output += 'ğŸ¥ å¥åº·çŠ¶æ€åˆ†å¸ƒ:\n';
                statsData.data.healthStatusDistribution.forEach(item => {
                    output += `  ${item.status}: ${item.count}äºº (${item.percentage}%)\n`;
                });
                
                // å¹´é¾„æ®µåˆ†å¸ƒ
                output += '\nğŸ‘¥ å¹´é¾„æ®µå¥åº·åˆ†å¸ƒ:\n';
                statsData.data.ageHealthDistribution.forEach(item => {
                    const total = item.healthy + item.subHealth + item.chronic + item.risk;
                    output += `  ${item.ageRange}: æ€»è®¡${total}äºº\n`;
                    output += `    å¥åº·: ${item.healthy}äºº\n`;
                    output += `    äºšå¥åº·: ${item.subHealth}äºº\n`;
                    output += `    æ…¢æ€§ç—…: ${item.chronic}äºº\n`;
                    output += `    é«˜é£é™©: ${item.risk}äºº\n`;
                });
                
                // æ£€æŸ¥æ˜¯å¦è§£å†³äº†"åªæ˜¾ç¤ºå¥åº·äººæ•°"çš„é—®é¢˜
                const hasVariedDistribution = statsData.data.ageHealthDistribution.some(item => 
                    item.subHealth > 0 || item.chronic > 0 || item.risk > 0
                );
                
                output += `\nğŸ¯ é—®é¢˜ä¿®å¤éªŒè¯:\n`;
                output += `å¹´é¾„æ®µåˆ†å¸ƒå¤šæ ·æ€§: ${hasVariedDistribution ? 'âœ… å·²ä¿®å¤' : 'âŒ ä»æœ‰é—®é¢˜'}\n`;
                
                resultDiv.textContent = output;
                resultDiv.className = hasVariedDistribution ? 'result success' : 'result error';
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ éªŒè¯å¤±è´¥: ${error.message}`;
            }
        }

        function clearLogs() {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'none';
            resultDiv.textContent = '';
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        window.onload = function() {
            console.log('æµ‹è¯•æ•°æ®åˆå§‹åŒ–é¡µé¢å·²åŠ è½½');
        };
    </script>
</body>
</html>
