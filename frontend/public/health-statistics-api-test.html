<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥åº·ç»Ÿè®¡APIæµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #409eff;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e4e7ed;
            border-radius: 6px;
        }
        .test-section h3 {
            color: #303133;
            margin-top: 0;
        }
        button {
            background: #409eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #66b1ff;
        }
        .success {
            background: #67c23a;
        }
        .success:hover {
            background: #85ce61;
        }
        .warning {
            background: #e6a23c;
        }
        .warning:hover {
            background: #ebb563;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #409eff;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .error {
            border-left-color: #f56c6c;
            background: #fef0f0;
            color: #f56c6c;
        }
        .success-result {
            border-left-color: #67c23a;
            background: #f0f9ff;
            color: #67c23a;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ™ºæ…§åŒ»å…»å¹³å° - å¥åº·ç»Ÿè®¡APIæµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>ğŸ¥ å¥åº·ç»Ÿè®¡APIæµ‹è¯•</h3>
            <button onclick="testHealthStatistics()">è·å–å¥åº·ç»Ÿè®¡æ•°æ®</button>
            <button onclick="testElderlyList()" class="success">è·å–è€äººåˆ—è¡¨</button>
            <button onclick="testAgeDistribution()" class="warning">å¹´é¾„åˆ†å¸ƒæµ‹è¯•</button>
            <div id="healthStatsResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š æ•°æ®åˆ†ææµ‹è¯•</h3>
            <button onclick="analyzeHealthData()">åˆ†æå¥åº·çŠ¶æ€åˆ†å¸ƒ</button>
            <button onclick="simulateDatabase()" class="success">æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢</button>
            <div id="analysisResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ åç«¯è¿æ¥æµ‹è¯•</h3>
            <button onclick="testBackendConnection()">æµ‹è¯•åç«¯è¿æ¥</button>
            <button onclick="testDatabaseConnection()" class="warning">æµ‹è¯•æ•°æ®åº“è¿æ¥</button>
            <div id="connectionResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080';
        
        // å¥åº·ç»Ÿè®¡APIæµ‹è¯•
        async function testHealthStatistics() {
            const resultDiv = document.getElementById('healthStatsResult');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ­£åœ¨è¯·æ±‚å¥åº·ç»Ÿè®¡æ•°æ®...';
            
            try {
                const response = await fetch(`${API_BASE}/elderly/health-statistics`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                resultDiv.className = 'result success-result';
                resultDiv.textContent = `è¯·æ±‚æˆåŠŸï¼\n\nå“åº”æ•°æ®ï¼š\n${JSON.stringify(data, null, 2)}`;
                
                // åˆ†æè¿”å›çš„æ•°æ®
                if (data.data) {
                    const analysis = analyzeStatistics(data.data);
                    resultDiv.textContent += `\n\næ•°æ®åˆ†æï¼š\n${analysis}`;
                }
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `è¯·æ±‚å¤±è´¥ï¼š${error.message}`;
                console.error('å¥åº·ç»Ÿè®¡APIæµ‹è¯•å¤±è´¥:', error);
            }
        }
        
        // è€äººåˆ—è¡¨APIæµ‹è¯•
        async function testElderlyList() {
            const resultDiv = document.getElementById('healthStatsResult');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ­£åœ¨è·å–è€äººåˆ—è¡¨...';
            
            try {
                const response = await fetch(`${API_BASE}/elderly/list?pageNum=1&pageSize=10`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                resultDiv.className = 'result success-result';
                
                let analysisText = `è€äººåˆ—è¡¨è·å–æˆåŠŸï¼\n\n`;
                if (data.data && data.data.records) {
                    analysisText += `æ€»è®°å½•æ•°: ${data.data.total}\n`;
                    analysisText += `å½“å‰é¡µè®°å½•æ•°: ${data.data.records.length}\n\n`;
                    
                    // åˆ†æå¥åº·çŠ¶æ€åˆ†å¸ƒ
                    const healthStatusMap = {};
                    data.data.records.forEach(elderly => {
                        const status = elderly.healthStatus || 'æœªçŸ¥';
                        healthStatusMap[status] = (healthStatusMap[status] || 0) + 1;
                    });
                    
                    analysisText += `å½“å‰é¡µå¥åº·çŠ¶æ€åˆ†å¸ƒï¼š\n`;
                    Object.entries(healthStatusMap).forEach(([status, count]) => {
                        analysisText += `  ${status}: ${count}äºº\n`;
                    });
                    
                    analysisText += `\nåŸå§‹æ•°æ®ï¼š\n${JSON.stringify(data, null, 2)}`;
                }
                
                resultDiv.textContent = analysisText;
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `è·å–è€äººåˆ—è¡¨å¤±è´¥ï¼š${error.message}`;
                console.error('è€äººåˆ—è¡¨APIæµ‹è¯•å¤±è´¥:', error);
            }
        }
        
        // å¹´é¾„åˆ†å¸ƒæµ‹è¯•
        async function testAgeDistribution() {
            const resultDiv = document.getElementById('healthStatsResult');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•å¹´é¾„åˆ†å¸ƒè®¡ç®—...';
            
            // æ¨¡æ‹Ÿä¸€äº›æµ‹è¯•æ•°æ®
            const testData = [
                {birthDate: '1945-05-20', healthStatus: 'NORMAL'},
                {birthDate: '1950-08-15', healthStatus: 'ATTENTION'},
                {birthDate: '1960-12-10', healthStatus: 'WARNING'},
                {birthDate: '1965-03-25', healthStatus: 'å¥åº·'},
                {birthDate: '1955-07-18', healthStatus: 'äºšå¥åº·'},
                {birthDate: '1940-11-30', healthStatus: ''},
                {birthDate: '1948-02-14', healthStatus: null}
            ];
            
            try {
                // è®¡ç®—å¹´é¾„åˆ†å¸ƒ
                const ageDistribution = calculateAgeDistribution(testData);
                
                resultDiv.className = 'result success-result';
                resultDiv.textContent = `å¹´é¾„åˆ†å¸ƒè®¡ç®—æµ‹è¯•ï¼š\n\n${JSON.stringify(ageDistribution, null, 2)}`;
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `å¹´é¾„åˆ†å¸ƒæµ‹è¯•å¤±è´¥ï¼š${error.message}`;
            }
        }
        
        // åˆ†æå¥åº·æ•°æ®
        function analyzeHealthData() {
            const resultDiv = document.getElementById('analysisResult');
            resultDiv.style.display = 'block';
            
            const analysis = `
å¥åº·çŠ¶æ€æ˜ å°„åˆ†æï¼š

åç«¯æ˜ å°„é€»è¾‘åº”è¯¥åŒ…å«ï¼š
1. æ ‡å‡†æšä¸¾å€¼ï¼šNORMAL(æ­£å¸¸), ATTENTION(å…³æ³¨), WARNING(é¢„è­¦)
2. ä¸­æ–‡æè¿°ï¼šå¥åº·, äºšå¥åº·, ç–¾ç—…, æ…¢æ€§ç—…, é‡ç—‡
3. è‹±æ–‡æè¿°ï¼šhealthy, unhealthy, sick, chronic, critical
4. æ•°å­—ç¼–ç ï¼š1(å¥åº·), 2(äºšå¥åº·), 3(ç–¾ç—…)
5. ç©ºå€¼/æœªçŸ¥ï¼šé»˜è®¤å½’ç±»ä¸ºäºšå¥åº·

å‰ç«¯å®¹é”™å¤„ç†ï¼š
- å½“åç«¯æ— æ•°æ®æ—¶ï¼Œç”Ÿæˆæ¨¡æ‹Ÿåˆ†å¸ƒ
- å¯¹æœªçŸ¥çŠ¶æ€è¿›è¡Œå‹å¥½æ˜¾ç¤º
- æä¾›æ•°æ®åˆ·æ–°å’Œé‡è¯•æœºåˆ¶

æ•°æ®åº“å­—æ®µæ£€æŸ¥è¦ç‚¹ï¼š
- health_statuså­—æ®µç±»å‹å’Œé•¿åº¦
- æ˜¯å¦æœ‰ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- æ•°æ®ä¸€è‡´æ€§å’Œè§„èŒƒæ€§
            `;
            
            resultDiv.className = 'result';
            resultDiv.textContent = analysis;
        }
        
        // æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢
        function simulateDatabase() {
            const resultDiv = document.getElementById('analysisResult');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ¨¡æ‹Ÿæ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢...';
            
            // æ¨¡æ‹ŸSQLæŸ¥è¯¢ç»“æœ
            setTimeout(() => {
                const mockResult = `
æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢ç»“æœï¼š

SELECT health_status, COUNT(*) FROM elderly GROUP BY health_status;

ç»“æœï¼š
+----------------+----------+
| health_status  | count    |
+----------------+----------+
| NORMAL         |       25 |
| ATTENTION      |       18 |
| WARNING        |       12 |
| å¥åº·           |        8 |
| äºšå¥åº·         |        6 |
| NULL           |        3 |
| æ…¢æ€§ç—…         |        2 |
+----------------+----------+

é—®é¢˜åˆ†æï¼š
1. å­˜åœ¨å¤šç§å¥åº·çŠ¶æ€è¡¨ç¤ºæ–¹å¼
2. æœ‰NULLå€¼éœ€è¦å¤„ç†
3. éœ€è¦ç»Ÿä¸€æ ‡å‡†åŒ–æ˜ å°„
4. å»ºè®®å»ºç«‹å¥åº·çŠ¶æ€å­—å…¸è¡¨
                `;
                
                resultDiv.className = 'result success-result';
                resultDiv.textContent = mockResult;
            }, 1000);
        }
        
        // æµ‹è¯•åç«¯è¿æ¥
        async function testBackendConnection() {
            const resultDiv = document.getElementById('connectionResult');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•åç«¯è¿æ¥...';
            
            try {
                const response = await fetch(`${API_BASE}/actuator/health`, {
                    method: 'GET'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.className = 'result success-result';
                    resultDiv.textContent = `åç«¯è¿æ¥æˆåŠŸï¼\n\nå¥åº·æ£€æŸ¥ç»“æœï¼š\n${JSON.stringify(data, null, 2)}`;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                // å°è¯•è®¿é—®å…¶ä»–ç«¯ç‚¹
                try {
                    const response = await fetch(`${API_BASE}/elderly/list?pageNum=1&pageSize=1`);
                    if (response.ok) {
                        resultDiv.className = 'result success-result';
                        resultDiv.textContent = 'åç«¯è¿æ¥æˆåŠŸï¼ï¼ˆé€šè¿‡è€äººåˆ—è¡¨APIéªŒè¯ï¼‰';
                    } else {
                        throw new Error('åç«¯æœåŠ¡å¯èƒ½æœªå¯åŠ¨');
                    }
                } catch (fallbackError) {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `åç«¯è¿æ¥å¤±è´¥ï¼š${error.message}\n\nè¯·ç¡®è®¤ï¼š\n1. åç«¯æœåŠ¡æ˜¯å¦å·²å¯åŠ¨ï¼ˆç«¯å£8080ï¼‰\n2. æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸\n3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸`;
                }
            }
        }
        
        // æµ‹è¯•æ•°æ®åº“è¿æ¥
        function testDatabaseConnection() {
            const resultDiv = document.getElementById('connectionResult');
            resultDiv.style.display = 'block';
            
            const dbInfo = `
æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼š

é…ç½®ï¼š
- æ•°æ®åº“ï¼šMySQL 8.0
- åœ°å€ï¼šlocalhost:3306
- æ•°æ®åº“åï¼šsmartcare_cloud
- ç”¨æˆ·åï¼šroot
- å¯†ç ï¼š123456

æ£€æŸ¥è¦ç‚¹ï¼š
1. MySQLæœåŠ¡æ˜¯å¦å¯åŠ¨
2. æ•°æ®åº“smartcare_cloudæ˜¯å¦å­˜åœ¨
3. elderlyè¡¨æ˜¯å¦å­˜åœ¨ä¸”æœ‰æ•°æ®
4. health_statuså­—æ®µæ˜¯å¦æ­£ç¡®å®šä¹‰

å»ºè®®æ‰§è¡Œçš„SQLæ£€æŸ¥ï¼š
SHOW DATABASES;
USE smartcare_cloud;
SHOW TABLES;
DESCRIBE elderly;
SELECT COUNT(*) FROM elderly;
SELECT DISTINCT health_status FROM elderly;
            `;
            
            resultDiv.className = 'result';
            resultDiv.textContent = dbInfo;
        }
        
        // åˆ†æç»Ÿè®¡æ•°æ®
        function analyzeStatistics(stats) {
            let analysis = '';
            
            if (stats.ageDistribution) {
                analysis += `å¹´é¾„åˆ†å¸ƒåˆ†æï¼š\n`;
                stats.ageDistribution.forEach(item => {
                    analysis += `  ${item.ageRange}: ${item.healthyCount}å¥åº· + ${item.unhealthyCount}éå¥åº· = ${item.totalCount}æ€»è®¡\n`;
                });
                analysis += '\n';
            }
            
            if (stats.healthStatusDistribution) {
                analysis += `å¥åº·çŠ¶æ€åˆ†å¸ƒï¼š\n`;
                stats.healthStatusDistribution.forEach(item => {
                    analysis += `  ${item.status}: ${item.count}äºº (${item.percentage}%)\n`;
                });
                analysis += '\n';
            }
            
            if (stats.totalCount) {
                analysis += `æ€»è€äººæ•°ï¼š${stats.totalCount}\n`;
            }
            
            return analysis || 'æ•°æ®æ ¼å¼è§£æä¸­...';
        }
        
        // è®¡ç®—å¹´é¾„åˆ†å¸ƒ
        function calculateAgeDistribution(data) {
            const currentYear = new Date().getFullYear();
            const ageGroups = {
                '60-70å²': {healthy: 0, unhealthy: 0},
                '70-80å²': {healthy: 0, unhealthy: 0},
                '80-90å²': {healthy: 0, unhealthy: 0},
                '90å²ä»¥ä¸Š': {healthy: 0, unhealthy: 0}
            };
            
            data.forEach(item => {
                if (!item.birthDate) return;
                
                const birthYear = new Date(item.birthDate).getFullYear();
                const age = currentYear - birthYear;
                
                let ageGroup;
                if (age >= 60 && age < 70) ageGroup = '60-70å²';
                else if (age >= 70 && age < 80) ageGroup = '70-80å²';
                else if (age >= 80 && age < 90) ageGroup = '80-90å²';
                else if (age >= 90) ageGroup = '90å²ä»¥ä¸Š';
                else return;
                
                const isHealthy = isHealthyStatus(item.healthStatus);
                if (isHealthy) {
                    ageGroups[ageGroup].healthy++;
                } else {
                    ageGroups[ageGroup].unhealthy++;
                }
            });
            
            return ageGroups;
        }
        
        // åˆ¤æ–­æ˜¯å¦ä¸ºå¥åº·çŠ¶æ€
        function isHealthyStatus(status) {
            if (!status) return false;
            const healthyKeywords = ['NORMAL', 'healthy', 'å¥åº·', 'æ­£å¸¸', '1'];
            return healthyKeywords.some(keyword => 
                status.toString().toLowerCase().includes(keyword.toLowerCase())
            );
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºè¯´æ˜
        window.onload = function() {
            console.log('å¥åº·ç»Ÿè®¡APIæµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            console.log('è¯·ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨ï¼ˆç«¯å£8080ï¼‰');
        };
    </script>
</body>
</html>
