<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»Ÿè®¡æŠ¥è¡¨APIæµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; }
        .api-test { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .result { margin: 10px 0; padding: 15px; border-radius: 4px; background: #f5f5f5; }
        .success { background: #e8f5e8; border-left: 4px solid #52c41a; }
        .error { background: #ffe6e6; border-left: 4px solid #ff4d4f; }
        button { margin: 5px; padding: 10px 20px; background: #1890ff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #40a9ff; }
        .data-display { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .card h3 { margin-top: 0; color: #333; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¥ æ™ºæ…§åŒ»å…»ç»Ÿè®¡æŠ¥è¡¨APIæµ‹è¯•</h1>
        
        <div class="api-test">
            <h2>ğŸ“Š APIæ¥å£æµ‹è¯•</h2>
            <button onclick="testAllAPIs()">æµ‹è¯•æ‰€æœ‰API</button>
            <button onclick="testOverview()">æ•°æ®æ¦‚è§ˆ</button>
            <button onclick="testHealthStatus()">å¥åº·çŠ¶å†µ</button>
            <button onclick="testWarningAnalysis()">é¢„è­¦åˆ†æ</button>
            <button onclick="testMedicalService()">åŒ»ç–—æœåŠ¡</button>
            <button onclick="testCareLevel()">ç…§æŠ¤ç­‰çº§</button>
            <button onclick="testTrendAnalysis()">è¶‹åŠ¿åˆ†æ</button>
            <button onclick="testEquipmentUsage()">è®¾å¤‡ç»Ÿè®¡</button>
            <div id="api-results"></div>
        </div>
        
        <div class="data-display" id="data-display"></div>
    </div>

    <script>
        const BASE_URL = 'http://localhost:8080/api/reports';
        
        function addResult(containerId, title, data, isError = false) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `result ${isError ? 'error' : 'success'}`;
            div.innerHTML = `
                <h4>${title}</h4>
                <pre>${typeof data === 'object' ? JSON.stringify(data, null, 2) : data}</pre>
            `;
            container.appendChild(div);
        }
        
        function addDataCard(title, data) {
            const container = document.getElementById('data-display');
            const card = document.createElement('div');
            card.className = 'card';
            
            let content = `<h3>${title}</h3>`;
            
            if (title === 'æ•°æ®æ¦‚è§ˆ' && data.code === 200) {
                content += `
                    <p><strong>è€äººæ€»æ•°:</strong> ${data.data.elderlyTotal}</p>
                    <p><strong>åŒ»ç”Ÿæ€»æ•°:</strong> ${data.data.doctorTotal}</p>
                    <p><strong>å¥åº·é¢„è­¦æ•°:</strong> ${data.data.warningTotal}</p>
                    <p><strong>ä»Šæ—¥æ–°å¢è€äºº:</strong> ${data.data.todayElderlyCount}</p>
                    <p><strong>å¥åº·è¦†ç›–ç‡:</strong> ${data.data.healthCoverageRate}%</p>
                    <p><strong>é¢„è­¦å¤„ç†ç‡:</strong> ${data.data.warningHandlingRate}%</p>
                `;
            } else if (title === 'å¥åº·çŠ¶å†µç»Ÿè®¡' && data.code === 200) {
                content += '<h4>å¥åº·çŠ¶å†µåˆ†å¸ƒ:</h4><ul>';
                data.data.healthStatusDistribution?.forEach(item => {
                    content += `<li>${item.status}: ${item.count}äºº (${item.percentage}%)</li>`;
                });
                content += '</ul><h4>å¸¸è§ç–¾ç—…:</h4><ul>';
                data.data.commonDiseases?.forEach(item => {
                    content += `<li>${item.name}: ${item.count}äºº</li>`;
                });
                content += '</ul>';
            } else if (title === 'é¢„è­¦åˆ†æ' && data.code === 200) {
                content += '<h4>é¢„è­¦çº§åˆ«ç»Ÿè®¡:</h4><ul>';
                data.data.levelStatistics?.forEach(item => {
                    const levelName = ['', 'ä½é£é™©', 'ä¸­é£é™©', 'é«˜é£é™©', 'ç´§æ€¥'][item.level] || 'æœªçŸ¥';
                    content += `<li>${levelName}: ${item.count}æ¡</li>`;
                });
                content += '</ul><h4>é¢„è­¦ç±»å‹:</h4><ul>';
                data.data.typeStatistics?.forEach(item => {
                    content += `<li>${item.type}: ${item.count}æ¡</li>`;
                });
                content += '</ul>';
            } else {
                content += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            }
            
            card.innerHTML = content;
            container.appendChild(card);
        }
        
        async function testAPI(endpoint, title) {
            try {
                const response = await fetch(`${BASE_URL}${endpoint}`);
                const data = await response.json();
                
                if (response.ok && data.code === 200) {
                    addResult('api-results', `âœ… ${title}`, `çŠ¶æ€: æˆåŠŸ, æ•°æ®: ${JSON.stringify(data.data).substring(0, 100)}...`);
                    addDataCard(title, data);
                } else {
                    addResult('api-results', `âŒ ${title}`, `é”™è¯¯: ${data.message || 'æœªçŸ¥é”™è¯¯'}`, true);
                }
                
                return data;
            } catch (error) {
                addResult('api-results', `âŒ ${title}`, `ç½‘ç»œé”™è¯¯: ${error.message}`, true);
                return null;
            }
        }
        
        async function testOverview() {
            await testAPI('/overview', 'æ•°æ®æ¦‚è§ˆ');
        }
        
        async function testHealthStatus() {
            await testAPI('/health-status', 'å¥åº·çŠ¶å†µç»Ÿè®¡');
        }
        
        async function testWarningAnalysis() {
            await testAPI('/warning-analysis', 'é¢„è­¦åˆ†æ');
        }
        
        async function testMedicalService() {
            await testAPI('/medical-service', 'åŒ»ç–—æœåŠ¡ç»Ÿè®¡');
        }
        
        async function testCareLevel() {
            await testAPI('/care-level', 'ç…§æŠ¤ç­‰çº§ç»Ÿè®¡');
        }
        
        async function testTrendAnalysis() {
            await testAPI('/trend-analysis?timeRange=30', 'è¶‹åŠ¿åˆ†æ');
        }
        
        async function testEquipmentUsage() {
            await testAPI('/equipment-usage', 'è®¾å¤‡ä½¿ç”¨ç»Ÿè®¡');
        }
        
        async function testAllAPIs() {
            // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
            document.getElementById('api-results').innerHTML = '<h3>å¼€å§‹æµ‹è¯•æ‰€æœ‰API...</h3>';
            document.getElementById('data-display').innerHTML = '';
            
            await testOverview();
            await testHealthStatus();
            await testWarningAnalysis();
            await testMedicalService();
            await testCareLevel();
            await testTrendAnalysis();
            await testEquipmentUsage();
            
            addResult('api-results', 'ğŸ‰ æµ‹è¯•å®Œæˆ', 'æ‰€æœ‰APIæµ‹è¯•å®Œæˆï¼Œè¯·æŸ¥çœ‹ä¸Šé¢çš„ç»“æœ');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æµ‹è¯•
        window.onload = function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨æµ‹è¯•...');
            setTimeout(() => {
                testAllAPIs();
            }, 1000);
        };
    </script>
</body>
</html>
