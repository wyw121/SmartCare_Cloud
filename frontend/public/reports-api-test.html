<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>统计报表API测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; }
        .api-test { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .result { margin: 10px 0; padding: 15px; border-radius: 4px; background: #f5f5f5; }
        .success { background: #e8f5e8; border-left: 4px solid #52c41a; }
        .error { background: #ffe6e6; border-left: 4px solid #ff4d4f; }
        button { margin: 5px; padding: 10px 20px; background: #1890ff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #40a9ff; }
        .data-display { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .card h3 { margin-top: 0; color: #333; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🏥 智慧医养统计报表API测试</h1>
        
        <div class="api-test">
            <h2>📊 API接口测试</h2>
            <button onclick="testAllAPIs()">测试所有API</button>
            <button onclick="testOverview()">数据概览</button>
            <button onclick="testHealthStatus()">健康状况</button>
            <button onclick="testWarningAnalysis()">预警分析</button>
            <button onclick="testMedicalService()">医疗服务</button>
            <button onclick="testCareLevel()">照护等级</button>
            <button onclick="testTrendAnalysis()">趋势分析</button>
            <button onclick="testEquipmentUsage()">设备统计</button>
            <div id="api-results"></div>
        </div>
        
        <div class="data-display" id="data-display"></div>
    </div>

    <script>
        const BASE_URL = 'http://localhost:8080/api/reports';
        
        function addResult(containerId, title, data, isError = false) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `result ${isError ? 'error' : 'success'}`;
            div.innerHTML = `
                <h4>${title}</h4>
                <pre>${typeof data === 'object' ? JSON.stringify(data, null, 2) : data}</pre>
            `;
            container.appendChild(div);
        }
        
        function addDataCard(title, data) {
            const container = document.getElementById('data-display');
            const card = document.createElement('div');
            card.className = 'card';
            
            let content = `<h3>${title}</h3>`;
            
            if (title === '数据概览' && data.code === 200) {
                content += `
                    <p><strong>老人总数:</strong> ${data.data.elderlyTotal}</p>
                    <p><strong>医生总数:</strong> ${data.data.doctorTotal}</p>
                    <p><strong>健康预警数:</strong> ${data.data.warningTotal}</p>
                    <p><strong>今日新增老人:</strong> ${data.data.todayElderlyCount}</p>
                    <p><strong>健康覆盖率:</strong> ${data.data.healthCoverageRate}%</p>
                    <p><strong>预警处理率:</strong> ${data.data.warningHandlingRate}%</p>
                `;
            } else if (title === '健康状况统计' && data.code === 200) {
                content += '<h4>健康状况分布:</h4><ul>';
                data.data.healthStatusDistribution?.forEach(item => {
                    content += `<li>${item.status}: ${item.count}人 (${item.percentage}%)</li>`;
                });
                content += '</ul><h4>常见疾病:</h4><ul>';
                data.data.commonDiseases?.forEach(item => {
                    content += `<li>${item.name}: ${item.count}人</li>`;
                });
                content += '</ul>';
            } else if (title === '预警分析' && data.code === 200) {
                content += '<h4>预警级别统计:</h4><ul>';
                data.data.levelStatistics?.forEach(item => {
                    const levelName = ['', '低风险', '中风险', '高风险', '紧急'][item.level] || '未知';
                    content += `<li>${levelName}: ${item.count}条</li>`;
                });
                content += '</ul><h4>预警类型:</h4><ul>';
                data.data.typeStatistics?.forEach(item => {
                    content += `<li>${item.type}: ${item.count}条</li>`;
                });
                content += '</ul>';
            } else {
                content += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            }
            
            card.innerHTML = content;
            container.appendChild(card);
        }
        
        async function testAPI(endpoint, title) {
            try {
                const response = await fetch(`${BASE_URL}${endpoint}`);
                const data = await response.json();
                
                if (response.ok && data.code === 200) {
                    addResult('api-results', `✅ ${title}`, `状态: 成功, 数据: ${JSON.stringify(data.data).substring(0, 100)}...`);
                    addDataCard(title, data);
                } else {
                    addResult('api-results', `❌ ${title}`, `错误: ${data.message || '未知错误'}`, true);
                }
                
                return data;
            } catch (error) {
                addResult('api-results', `❌ ${title}`, `网络错误: ${error.message}`, true);
                return null;
            }
        }
        
        async function testOverview() {
            await testAPI('/overview', '数据概览');
        }
        
        async function testHealthStatus() {
            await testAPI('/health-status', '健康状况统计');
        }
        
        async function testWarningAnalysis() {
            await testAPI('/warning-analysis', '预警分析');
        }
        
        async function testMedicalService() {
            await testAPI('/medical-service', '医疗服务统计');
        }
        
        async function testCareLevel() {
            await testAPI('/care-level', '照护等级统计');
        }
        
        async function testTrendAnalysis() {
            await testAPI('/trend-analysis?timeRange=30', '趋势分析');
        }
        
        async function testEquipmentUsage() {
            await testAPI('/equipment-usage', '设备使用统计');
        }
        
        async function testAllAPIs() {
            // 清空之前的结果
            document.getElementById('api-results').innerHTML = '<h3>开始测试所有API...</h3>';
            document.getElementById('data-display').innerHTML = '';
            
            await testOverview();
            await testHealthStatus();
            await testWarningAnalysis();
            await testMedicalService();
            await testCareLevel();
            await testTrendAnalysis();
            await testEquipmentUsage();
            
            addResult('api-results', '🎉 测试完成', '所有API测试完成，请查看上面的结果');
        }
        
        // 页面加载完成后自动测试
        window.onload = function() {
            console.log('页面加载完成，开始自动测试...');
            setTimeout(() => {
                testAllAPIs();
            }, 1000);
        };
    </script>
</body>
</html>
