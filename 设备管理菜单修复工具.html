<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¾å¤‡ç®¡ç†èœå•ä¿®å¤å·¥å…·</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .step {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: background-color 0.3s;
            width: 100%;
        }
        button:hover {
            background: #2980b9;
        }
        .success {
            background: #d5f4e6;
            color: #27ae60;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .error {
            background: #fdf2f2;
            color: #e74c3c;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .info {
            background: #e3f2fd;
            color: #1976d2;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        #status {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ è®¾å¤‡ç®¡ç†èœå•ä¿®å¤å·¥å…·</h1>
        
        <div class="step">
            <h3>æ­¥éª¤1: ä¿®å¤ç™»å½•çŠ¶æ€</h3>
            <p>ç¡®ä¿ç”¨æˆ·ä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•ï¼Œæ‹¥æœ‰è®¾å¤‡ç®¡ç†è®¿é—®æƒé™ã€‚</p>
            <button onclick="fixLoginStatus()">ä¿®å¤ç™»å½•çŠ¶æ€</button>
        </div>
        
        <div class="step">
            <h3>æ­¥éª¤2: æ‰“å¼€å‰ç«¯é¡µé¢</h3>
            <p>åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€å‰ç«¯é¡µé¢ï¼Œæ£€æŸ¥ä¾§è¾¹æ æ˜¯å¦æ˜¾ç¤ºè®¾å¤‡ç®¡ç†èœå•ã€‚</p>
            <button onclick="openFrontend()">æ‰“å¼€å‰ç«¯é¡µé¢</button>
        </div>
        
        <div class="step">
            <h3>æ­¥éª¤3: ç›´æ¥è®¿é—®è®¾å¤‡ç®¡ç†</h3>
            <p>å¦‚æœä¾§è¾¹æ ä»ç„¶æ²¡æœ‰æ˜¾ç¤ºï¼Œç›´æ¥è®¿é—®è®¾å¤‡ç®¡ç†é¡µé¢ã€‚</p>
            <button onclick="openEquipmentPage()">ç›´æ¥è®¿é—®è®¾å¤‡ç®¡ç†</button>
        </div>
        
        <div class="step">
            <h3>æ­¥éª¤4: æ¸…é™¤ç¼“å­˜é‡è¯•</h3>
            <p>å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œæ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶é‡æ–°ç™»å½•ã€‚</p>
            <button onclick="clearCacheAndRetry()">æ¸…é™¤ç¼“å­˜é‡è¯•</button>
        </div>
        
        <div id="status"></div>
    </div>

    <script>
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="${type}">${message}</div>`;
        }

        function fixLoginStatus() {
            try {
                // è®¾ç½®ç®¡ç†å‘˜ç™»å½•çŠ¶æ€
                const adminData = {
                    id: 1,
                    username: 'admin',
                    name: 'ç³»ç»Ÿç®¡ç†å‘˜',
                    role: 'admin',
                    roleText: 'ç³»ç»Ÿç®¡ç†å‘˜',
                    permissions: ['*'],
                    avatar: '',
                    department: 'ç³»ç»Ÿç®¡ç†éƒ¨',
                    phone: '13800138000',
                    email: 'admin@smartcare.com',
                    description: 'æ‹¥æœ‰ç³»ç»Ÿå…¨éƒ¨ç®¡ç†æƒé™ï¼Œè´Ÿè´£å¹³å°æ•´ä½“è¿è¥ç®¡ç†'
                };
                
                const token = `fixed_admin_token_${Date.now()}`;
                
                localStorage.setItem('token', token);
                localStorage.setItem('userInfo', JSON.stringify(adminData));
                
                showStatus('âœ… ç®¡ç†å‘˜ç™»å½•çŠ¶æ€å·²ä¿®å¤ï¼Tokenå’Œç”¨æˆ·ä¿¡æ¯å·²è®¾ç½®ã€‚', 'success');
                
                console.log('ğŸ”§ ç™»å½•çŠ¶æ€ä¿®å¤å®Œæˆ:');
                console.log('Token:', token);
                console.log('User Info:', adminData);
                
            } catch (error) {
                showStatus('âŒ ä¿®å¤å¤±è´¥: ' + error.message, 'error');
            }
        }

        function openFrontend() {
            const url = 'http://localhost:3001';
            window.open(url, '_blank');
            showStatus(`ğŸŒ æ­£åœ¨æ‰“å¼€å‰ç«¯é¡µé¢: ${url}`, 'info');
            showStatus('è¯·æ£€æŸ¥ä¾§è¾¹æ æ˜¯å¦æ˜¾ç¤º"è®¾å¤‡ç®¡ç†"èœå•é¡¹ã€‚å¦‚æœæ˜¾ç¤ºï¼Œç‚¹å‡»æµ‹è¯•è·³è½¬åŠŸèƒ½ã€‚', 'info');
        }

        function openEquipmentPage() {
            const equipmentUrls = [
                'http://localhost:3001/equipment',
                'http://localhost:3001/equipment/list'
            ];
            
            equipmentUrls.forEach(url => {
                window.open(url, '_blank');
            });
            
            showStatus('ğŸ”§ å·²æ‰“å¼€è®¾å¤‡ç®¡ç†é¡µé¢çš„å¤šä¸ªURLï¼Œè¯·æ£€æŸ¥å“ªä¸ªèƒ½æ­£å¸¸è®¿é—®ã€‚', 'info');
        }

        function clearCacheAndRetry() {
            try {
                // æ¸…é™¤æ‰€æœ‰æœ¬åœ°å­˜å‚¨
                localStorage.clear();
                sessionStorage.clear();
                
                showStatus('ğŸ§¹ æœ¬åœ°å­˜å‚¨å·²æ¸…é™¤ã€‚', 'info');
                
                // ç­‰å¾…ä¸€ç§’åé‡æ–°è®¾ç½®ç™»å½•çŠ¶æ€
                setTimeout(() => {
                    fixLoginStatus();
                    showStatus('ğŸ”„ è¯·åˆ·æ–°å‰ç«¯é¡µé¢é‡æ–°ç™»å½•ï¼Œæˆ–ä½¿ç”¨ä¸Šæ–¹æŒ‰é’®é‡æ–°æ‰“å¼€å‰ç«¯é¡µé¢ã€‚', 'info');
                }, 1000);
                
            } catch (error) {
                showStatus('âŒ æ¸…é™¤ç¼“å­˜å¤±è´¥: ' + error.message, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥å½“å‰çŠ¶æ€
        window.onload = function() {
            const token = localStorage.getItem('token');
            const userInfo = localStorage.getItem('userInfo');
            
            if (token && userInfo) {
                try {
                    const user = JSON.parse(userInfo);
                    showStatus(`ğŸ“Š æ£€æµ‹åˆ°ç°æœ‰ç™»å½•çŠ¶æ€ - ç”¨æˆ·: ${user.name || user.username} (${user.role})`, 'info');
                } catch (error) {
                    showStatus('âš ï¸ æ£€æµ‹åˆ°ç™»å½•çŠ¶æ€å¼‚å¸¸ï¼Œå»ºè®®é‡æ–°ä¿®å¤ã€‚', 'error');
                }
            } else {
                showStatus('âš ï¸ æœªæ£€æµ‹åˆ°ç™»å½•çŠ¶æ€ï¼Œè¯·ç‚¹å‡»"ä¿®å¤ç™»å½•çŠ¶æ€"æŒ‰é’®ã€‚', 'error');
            }
        };
    </script>
</body>
</html>
